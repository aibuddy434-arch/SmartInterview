{"ast":null,"code":"import _objectSpread from\"D:/ai_avatar/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef,useCallback}from'react';import{useParams,useNavigate}from'react-router-dom';import{Card,CardHeader,CardBody}from'../components/ui/Card';import Button from'../components/ui/Button';import Input from'../components/ui/Input';import{useToast}from'../contexts/ToastContext';import{interviewService}from'../services/interviewService';import{avatarService}from'../services/avatarService';import{safeApiCallWithValidation}from'../utils/errorHandler';import{safeApiCall}from\"../utils/errorHandler\";import{aiService}from'../services/aiService';import{Mic,MicOff,CheckCircle,Clock,AlertCircle,Upload,FileText,Camera}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PublicInterview=()=>{const{interviewId}=useParams();const navigate=useNavigate();const{toast}=useToast();const[step,setStep]=useState('loading');// loading, register, interview, complete\nconst[interview,setInterview]=useState(null);const[candidate,setCandidate]=useState({name:'',email:'',phone:'',resume:null});const[sessionId,setSessionId]=useState(null);const[currentQuestionIndex,setCurrentQuestionIndex]=useState(0);const[isRecording,setIsRecording]=useState(false);const[response,setResponse]=useState('');const[loading,setLoading]=useState(true);const[submitting,setSubmitting]=useState(false);const[avatarElement,setAvatarElement]=useState(null);const[mediaStream,setMediaStream]=useState(null);const[permissionsGranted,setPermissionsGranted]=useState(false);const videoRef=useRef(null);const mediaRecorderRef=useRef(null);const audioChunksRef=useRef([]);const loadInterview=useCallback(async()=>{setLoading(true);const result=await safeApiCallWithValidation(()=>interviewService.getPublicInterview(interviewId),['id','job_role','questions'],'Failed to load interview. Please check the link and try again.');// Safely check result object and properties\nif(result&&result.success===true&&result.data){setInterview(result.data);setStep('register');}else{const errorMessage=(result===null||result===void 0?void 0:result.error)||'Failed to load interview. Please check the link and try again.';toast.error(errorMessage);setStep('error');}setLoading(false);},[interviewId,toast]);const initializeAvatar=useCallback(()=>{if(avatarElement)return;const avatarContainer=document.getElementById('avatar-container');if(avatarContainer){const avatar=avatarService.createAvatarVisuals();avatarContainer.appendChild(avatar);setAvatarElement(avatar);}},[avatarElement]);useEffect(()=>{loadInterview();},[loadInterview]);useEffect(()=>{if(interview&&step==='interview'){initializeAvatar();}},[interview,step,initializeAvatar]);const handleCandidateRegistration=async e=>{e.preventDefault();setSubmitting(true);try{const formData=new FormData();formData.append('name',candidate.name);formData.append('email',candidate.email);formData.append('phone',candidate.phone);if(candidate.resume){formData.append('resume_file',candidate.resume);}const result=await safeApiCallWithValidation(()=>interviewService.registerCandidate(interviewId,formData),['candidate.id','session_id'],'Registration failed. Please try again.');if((result===null||result===void 0?void 0:result.success)===true&&result!==null&&result!==void 0&&result.data){setCandidate(prev=>_objectSpread(_objectSpread({},prev),{},{id:result.data.candidate.id}));setSessionId(result.data.session_id);toast.success('Registration successful! You can now start the interview.');setStep('ready');}else{const errorMessage=(result===null||result===void 0?void 0:result.error)||'Registration failed. Please try again.';toast.error(errorMessage);}}catch(err){console.error(\"Registration error:\",err);toast.error(\"Something went wrong. Please try again.\");}finally{setSubmitting(false);}};const startInterview=async()=>{setSubmitting(true);// Request media permissions\nawait requestMediaPermissions();if(!permissionsGranted){toast.error('Camera and microphone permissions are required for the interview.');setSubmitting(false);return;}// Start the interview session\nconst result=await safeApiCall(()=>interviewService.startInterviewSession(sessionId),'Failed to start interview. Please try again.');// Safely check result object and properties\nif(result&&result.success===true){setStep('interview');toast.success('Interview started! The AI avatar will begin asking questions.');}else{const errorMessage=(result===null||result===void 0?void 0:result.error)||'Failed to start interview. Please try again.';toast.error(errorMessage);}setSubmitting(false);};const requestMediaPermissions=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});setMediaStream(stream);setPermissionsGranted(true);if(videoRef.current){videoRef.current.srcObject=stream;}return true;}catch(error){console.error('Media permission denied:',error);setPermissionsGranted(false);return false;}};const askQuestion=async questionText=>{if(!avatarElement)return;try{// Generate TTS audio for the question\nconst audioBlob=await aiService.generateTTS(questionText);const audioUrl=URL.createObjectURL(audioBlob);const audio=new Audio(audioUrl);// Start lip sync animation\navatarService.startLipSyncAnimation(avatarElement,audio);audio.onended=()=>{URL.revokeObjectURL(audioUrl);};audio.play();}catch(error){console.error('Failed to ask question:',error);}};const startRecording=()=>{if(!mediaStream)return;try{mediaRecorderRef.current=new MediaRecorder(mediaStream);audioChunksRef.current=[];mediaRecorderRef.current.ondataavailable=event=>{audioChunksRef.current.push(event.data);};mediaRecorderRef.current.onstop=()=>{const audioBlob=new Blob(audioChunksRef.current,{type:'audio/wav'});setResponse(audioBlob);};mediaRecorderRef.current.start();setIsRecording(true);}catch(error){console.error('Failed to start recording:',error);}};const stopRecording=()=>{if(mediaRecorderRef.current&&isRecording){mediaRecorderRef.current.stop();setIsRecording(false);}};const submitResponse=async()=>{if(!response)return;setSubmitting(true);const formData=new FormData();formData.append('question_number',currentQuestionIndex);formData.append('response_text',typeof response==='string'?response:'');if(response instanceof Blob){formData.append('audio_file',response,'response.wav');}const result=await safeApiCall(()=>interviewService.submitResponse(sessionId,formData),'Failed to submit response. Please try again.');// Safely check result object and properties\nif(result&&result.success===true){// Move to next question\nconst nextIndex=currentQuestionIndex+1;if(nextIndex<interview.questions.length){setCurrentQuestionIndex(nextIndex);setResponse('');// Ask next question\nsetTimeout(()=>{askQuestion(interview.questions[nextIndex].text);},1000);}else{// Interview completed\nawait completeInterview();}}else{const errorMessage=(result===null||result===void 0?void 0:result.error)||'Failed to submit response. Please try again.';toast.error(errorMessage);}setSubmitting(false);};const completeInterview=async()=>{const result=await safeApiCall(()=>interviewService.completeSession(sessionId),'Failed to complete interview. Please try again.');// Safely check result object and properties\nif(result&&result.success===true){setStep('complete');toast.success('Interview completed successfully! Thank you for your time.');}else{const errorMessage=(result===null||result===void 0?void 0:result.error)||'Failed to complete interview. Please try again.';toast.error(errorMessage);}};const handleResumeChange=e=>{const file=e.target.files[0];if(file&&(file.type==='application/pdf'||file.type==='application/msword'||file.type==='application/vnd.openxmlformats-officedocument.wordprocessingml.document')){setCandidate(prev=>_objectSpread(_objectSpread({},prev),{},{resume:file}));}else{toast.error('Please upload a PDF or Word document.');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Loading interview...\"})]})});}if(step==='error'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-pink-100\",children:/*#__PURE__*/_jsx(Card,{className:\"max-w-md mx-auto\",children:/*#__PURE__*/_jsxs(CardBody,{className:\"text-center\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"h-16 w-16 text-red-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 mb-2\",children:\"Interview Not Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"The interview link you're trying to access is invalid or has expired.\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/'),variant:\"primary\",children:\"Go Home\"})]})})});}if(step==='register'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto px-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"shadow-xl\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-2\",children:\"Interview Registration\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Please provide your details to start the interview\"})]}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCandidateRegistration,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Full Name *\"}),/*#__PURE__*/_jsx(Input,{type:\"text\",value:candidate.name,onChange:e=>setCandidate(prev=>_objectSpread(_objectSpread({},prev),{},{name:e.target.value})),required:true,placeholder:\"Enter your full name\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Email Address *\"}),/*#__PURE__*/_jsx(Input,{type:\"email\",value:candidate.email,onChange:e=>setCandidate(prev=>_objectSpread(_objectSpread({},prev),{},{email:e.target.value})),required:true,placeholder:\"Enter your email\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Phone Number *\"}),/*#__PURE__*/_jsx(Input,{type:\"tel\",value:candidate.phone,onChange:e=>setCandidate(prev=>_objectSpread(_objectSpread({},prev),{},{phone:e.target.value})),required:true,placeholder:\"Enter your phone number\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Resume (Optional)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1 text-center\",children:[/*#__PURE__*/_jsx(Upload,{className:\"mx-auto h-12 w-12 text-gray-400\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex text-sm text-gray-600\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"resume-upload\",className:\"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Upload a file\"}),/*#__PURE__*/_jsx(\"input\",{id:\"resume-upload\",name:\"resume-upload\",type:\"file\",className:\"sr-only\",accept:\".pdf,.doc,.docx\",onChange:handleResumeChange})]}),/*#__PURE__*/_jsx(\"p\",{className:\"pl-1\",children:\"or drag and drop\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"PDF, DOC, DOCX up to 10MB\"})]})}),candidate.resume&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex items-center text-sm text-green-600\",children:[/*#__PURE__*/_jsx(FileText,{className:\"h-4 w-4 mr-2\"}),candidate.resume.name]})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\",size:\"lg\",className:\"w-full\",loading:submitting,children:\"Register for Interview\"})]})})]})})});}if(step==='ready'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto px-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"shadow-xl\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"text-center\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"h-16 w-16 text-green-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-2\",children:\"Ready to Start!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"You're all set to begin the interview. Make sure you have a quiet environment and good internet connection.\"})]}),/*#__PURE__*/_jsxs(CardBody,{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2 text-gray-600\",children:[/*#__PURE__*/_jsx(Camera,{className:\"h-5 w-5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Camera will be used for video recording\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2 text-gray-600\",children:[/*#__PURE__*/_jsx(Mic,{className:\"h-5 w-5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Microphone will be used for audio recording\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2 text-gray-600\",children:[/*#__PURE__*/_jsx(Clock,{className:\"h-5 w-5\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Interview duration: \",(interview===null||interview===void 0?void 0:interview.duration_minutes)||30,\" minutes\"]})]})]}),/*#__PURE__*/_jsx(Button,{onClick:startInterview,variant:\"primary\",size:\"lg\",className:\"w-full\",loading:submitting,children:\"Start Interview\"})]})]})})});}if(step==='interview'){var _interview$questions$,_interview$questions,_interview$questions2,_interview$questions3;return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto px-4 py-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"AI Interviewer\"})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(\"div\",{id:\"avatar-container\",className:\"h-64 bg-gray-100 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500\",children:\"AI Avatar Loading...\"})})})]}),(interview===null||interview===void 0?void 0:interview.questions)&&interview.questions[currentQuestionIndex]&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Current Question\"})}),/*#__PURE__*/_jsxs(CardBody,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700\",children:interview.questions[currentQuestionIndex].text}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 flex flex-wrap gap-2\",children:(_interview$questions$=interview.questions[currentQuestionIndex].tags)===null||_interview$questions$===void 0?void 0:_interview$questions$.map((tag,index)=>/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full\",children:tag},index))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Your Video\"})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,muted:true,className:\"w-full h-48 bg-gray-900 rounded-lg\"})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Record Your Response\"})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center space-x-4\",children:/*#__PURE__*/_jsx(Button,{onClick:isRecording?stopRecording:startRecording,variant:isRecording?\"danger\":\"primary\",size:\"lg\",children:isRecording?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(MicOff,{className:\"h-5 w-5 mr-2\"}),\"Stop Recording\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Mic,{className:\"h-5 w-5 mr-2\"}),\"Start Recording\"]})})}),response&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mb-2\",children:\"Response recorded\"}),/*#__PURE__*/_jsx(Button,{onClick:submitResponse,variant:\"success\",loading:submitting,children:\"Submit Response\"})]})]})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Progress\"})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Question \",currentQuestionIndex+1,\" of \",(interview===null||interview===void 0?void 0:(_interview$questions=interview.questions)===null||_interview$questions===void 0?void 0:_interview$questions.length)||0]}),/*#__PURE__*/_jsxs(\"span\",{children:[Math.round((currentQuestionIndex+1)/((interview===null||interview===void 0?void 0:(_interview$questions2=interview.questions)===null||_interview$questions2===void 0?void 0:_interview$questions2.length)||1)*100),\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-600 h-2 rounded-full transition-all duration-300\",style:{width:\"\".concat((currentQuestionIndex+1)/((interview===null||interview===void 0?void 0:(_interview$questions3=interview.questions)===null||_interview$questions3===void 0?void 0:_interview$questions3.length)||1)*100,\"%\")}})})]})})]})]})]})})});}if(step==='complete'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-2xl mx-auto px-4\",children:/*#__PURE__*/_jsxs(Card,{className:\"shadow-xl\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"text-center\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"h-16 w-16 text-green-500 mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-2\",children:\"Interview Completed!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Thank you for completing the interview. Your responses have been recorded and will be reviewed.\"})]}),/*#__PURE__*/_jsx(CardBody,{className:\"text-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700\",children:\"We'll be in touch soon with the results. Thank you for your time and interest!\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/'),variant:\"primary\",children:\"Return Home\"})]})})]})})});}return null;};export default PublicInterview;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useParams","useNavigate","Card","CardHeader","CardBody","Button","Input","useToast","interviewService","avatarService","safeApiCallWithValidation","safeApiCall","aiService","Mic","MicOff","CheckCircle","Clock","AlertCircle","Upload","FileText","Camera","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PublicInterview","interviewId","navigate","toast","step","setStep","interview","setInterview","candidate","setCandidate","name","email","phone","resume","sessionId","setSessionId","currentQuestionIndex","setCurrentQuestionIndex","isRecording","setIsRecording","response","setResponse","loading","setLoading","submitting","setSubmitting","avatarElement","setAvatarElement","mediaStream","setMediaStream","permissionsGranted","setPermissionsGranted","videoRef","mediaRecorderRef","audioChunksRef","loadInterview","result","getPublicInterview","success","data","errorMessage","error","initializeAvatar","avatarContainer","document","getElementById","avatar","createAvatarVisuals","appendChild","handleCandidateRegistration","e","preventDefault","formData","FormData","append","registerCandidate","prev","_objectSpread","id","session_id","err","console","startInterview","requestMediaPermissions","startInterviewSession","stream","navigator","mediaDevices","getUserMedia","video","audio","current","srcObject","askQuestion","questionText","audioBlob","generateTTS","audioUrl","URL","createObjectURL","Audio","startLipSyncAnimation","onended","revokeObjectURL","play","startRecording","MediaRecorder","ondataavailable","event","push","onstop","Blob","type","start","stopRecording","stop","submitResponse","nextIndex","questions","length","setTimeout","text","completeInterview","completeSession","handleResumeChange","file","target","files","className","children","onClick","variant","onSubmit","value","onChange","required","placeholder","htmlFor","accept","size","duration_minutes","_interview$questions$","_interview$questions","_interview$questions2","_interview$questions3","tags","map","tag","index","ref","autoPlay","muted","Math","round","style","width","concat"],"sources":["D:/ai_avatar/frontend/src/pages/PublicInterview.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Card, CardHeader, CardBody } from '../components/ui/Card';\nimport Button from '../components/ui/Button';\nimport Input from '../components/ui/Input';\nimport { useToast } from '../contexts/ToastContext';\nimport { interviewService } from '../services/interviewService';\nimport { avatarService } from '../services/avatarService';\nimport { safeApiCallWithValidation } from '../utils/errorHandler';\nimport { safeApiCall } from \"../utils/errorHandler\";\nimport { aiService } from '../services/aiService';\nimport { \n  Mic, \n  MicOff, \n  CheckCircle,\n  Clock,\n  AlertCircle,\n  Upload,\n  FileText,\n  Camera\n} from 'lucide-react';\n\nconst PublicInterview = () => {\n  const { interviewId } = useParams();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  \n  const [step, setStep] = useState('loading'); // loading, register, interview, complete\n  const [interview, setInterview] = useState(null);\n  const [candidate, setCandidate] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    resume: null\n  });\n  const [sessionId, setSessionId] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [isRecording, setIsRecording] = useState(false);\n  const [response, setResponse] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [avatarElement, setAvatarElement] = useState(null);\n  const [mediaStream, setMediaStream] = useState(null);\n  const [permissionsGranted, setPermissionsGranted] = useState(false);\n  \n  const videoRef = useRef(null);\n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n\n  const loadInterview = useCallback(async () => {\n    setLoading(true);\n    \n    const result = await safeApiCallWithValidation(\n      () => interviewService.getPublicInterview(interviewId),\n      ['id', 'job_role', 'questions'],\n      'Failed to load interview. Please check the link and try again.'\n    );\n\n    // Safely check result object and properties\n    if (result && result.success === true && result.data) {\n      setInterview(result.data);\n      setStep('register');\n    } else {\n      const errorMessage = result?.error || 'Failed to load interview. Please check the link and try again.';\n      toast.error(errorMessage);\n      setStep('error');\n    }\n    \n    setLoading(false);\n  }, [interviewId, toast]);\n\n  const initializeAvatar = useCallback(() => {\n    if (avatarElement) return;\n    \n    const avatarContainer = document.getElementById('avatar-container');\n    if (avatarContainer) {\n      const avatar = avatarService.createAvatarVisuals();\n      avatarContainer.appendChild(avatar);\n      setAvatarElement(avatar);\n    }\n  }, [avatarElement]);\n\n  useEffect(() => {\n    loadInterview();\n  }, [loadInterview]);\n\n  useEffect(() => {\n    if (interview && step === 'interview') {\n      initializeAvatar();\n    }\n  }, [interview, step, initializeAvatar]);\n\n\n  const handleCandidateRegistration = async (e) => {\n    e.preventDefault();\n    setSubmitting(true);\n\n    try {\n      const formData = new FormData();\n      formData.append('name', candidate.name);\n      formData.append('email', candidate.email);\n      formData.append('phone', candidate.phone);\n      if (candidate.resume) {\n        formData.append('resume_file', candidate.resume);\n      }\n\n      const result = await safeApiCallWithValidation(\n        () => interviewService.registerCandidate(interviewId, formData),\n        ['candidate.id', 'session_id'],\n        'Registration failed. Please try again.'\n      );\n\n      if (result?.success === true && result?.data) {\n        setCandidate(prev => ({ ...prev, id: result.data.candidate.id }));\n        setSessionId(result.data.session_id);\n        toast.success('Registration successful! You can now start the interview.');\n        setStep('ready');\n      } else {\n        const errorMessage = result?.error || 'Registration failed. Please try again.';\n        toast.error(errorMessage);\n      }\n    } catch (err) {\n      console.error(\"Registration error:\", err);\n      toast.error(\"Something went wrong. Please try again.\");\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n\n  const startInterview = async () => {\n    setSubmitting(true);\n    \n    // Request media permissions\n    await requestMediaPermissions();\n    \n    if (!permissionsGranted) {\n      toast.error('Camera and microphone permissions are required for the interview.');\n      setSubmitting(false);\n      return;\n    }\n\n    // Start the interview session\n    const result = await safeApiCall(\n      () => interviewService.startInterviewSession(sessionId),\n      'Failed to start interview. Please try again.'\n    );\n\n    // Safely check result object and properties\n    if (result && result.success === true) {\n      setStep('interview');\n      toast.success('Interview started! The AI avatar will begin asking questions.');\n    } else {\n      const errorMessage = result?.error || 'Failed to start interview. Please try again.';\n      toast.error(errorMessage);\n    }\n    \n    setSubmitting(false);\n  };\n\n  const requestMediaPermissions = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true\n      });\n      \n      setMediaStream(stream);\n      setPermissionsGranted(true);\n      \n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n      \n      return true;\n    } catch (error) {\n      console.error('Media permission denied:', error);\n      setPermissionsGranted(false);\n      return false;\n    }\n  };\n\n\n  const askQuestion = async (questionText) => {\n    if (!avatarElement) return;\n    \n    try {\n      // Generate TTS audio for the question\n      const audioBlob = await aiService.generateTTS(questionText);\n      const audioUrl = URL.createObjectURL(audioBlob);\n      const audio = new Audio(audioUrl);\n      \n      // Start lip sync animation\n      avatarService.startLipSyncAnimation(avatarElement, audio);\n      \n      audio.onended = () => {\n        URL.revokeObjectURL(audioUrl);\n      };\n      \n      audio.play();\n    } catch (error) {\n      console.error('Failed to ask question:', error);\n    }\n  };\n\n  const startRecording = () => {\n    if (!mediaStream) return;\n    \n    try {\n      mediaRecorderRef.current = new MediaRecorder(mediaStream);\n      audioChunksRef.current = [];\n      \n      mediaRecorderRef.current.ondataavailable = (event) => {\n        audioChunksRef.current.push(event.data);\n      };\n      \n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n        setResponse(audioBlob);\n      };\n      \n      mediaRecorderRef.current.start();\n      setIsRecording(true);\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const submitResponse = async () => {\n    if (!response) return;\n    \n    setSubmitting(true);\n    \n    const formData = new FormData();\n    formData.append('question_number', currentQuestionIndex);\n    formData.append('response_text', typeof response === 'string' ? response : '');\n    \n    if (response instanceof Blob) {\n      formData.append('audio_file', response, 'response.wav');\n    }\n    \n    const result = await safeApiCall(\n      () => interviewService.submitResponse(sessionId, formData),\n      'Failed to submit response. Please try again.'\n    );\n\n    // Safely check result object and properties\n    if (result && result.success === true) {\n      // Move to next question\n      const nextIndex = currentQuestionIndex + 1;\n      if (nextIndex < interview.questions.length) {\n        setCurrentQuestionIndex(nextIndex);\n        setResponse('');\n        \n        // Ask next question\n        setTimeout(() => {\n          askQuestion(interview.questions[nextIndex].text);\n        }, 1000);\n      } else {\n        // Interview completed\n        await completeInterview();\n      }\n    } else {\n      const errorMessage = result?.error || 'Failed to submit response. Please try again.';\n      toast.error(errorMessage);\n    }\n    \n    setSubmitting(false);\n  };\n\n  const completeInterview = async () => {\n    const result = await safeApiCall(\n      () => interviewService.completeSession(sessionId),\n      'Failed to complete interview. Please try again.'\n    );\n\n    // Safely check result object and properties\n    if (result && result.success === true) {\n      setStep('complete');\n      toast.success('Interview completed successfully! Thank you for your time.');\n    } else {\n      const errorMessage = result?.error || 'Failed to complete interview. Please try again.';\n      toast.error(errorMessage);\n    }\n  };\n\n  const handleResumeChange = (e) => {\n    const file = e.target.files[0];\n    if (file && (file.type === 'application/pdf' || file.type === 'application/msword' || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document')) {\n      setCandidate(prev => ({ ...prev, resume: file }));\n    } else {\n      toast.error('Please upload a PDF or Word document.');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading interview...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'error') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-pink-100\">\n        <Card className=\"max-w-md mx-auto\">\n          <CardBody className=\"text-center\">\n            <AlertCircle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Interview Not Found</h2>\n            <p className=\"text-gray-600 mb-4\">The interview link you're trying to access is invalid or has expired.</p>\n            <Button onClick={() => navigate('/')} variant=\"primary\">\n              Go Home\n            </Button>\n          </CardBody>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'register') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12\">\n        <div className=\"max-w-2xl mx-auto px-4\">\n          <Card className=\"shadow-xl\">\n            <CardHeader className=\"text-center\">\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Interview Registration</h1>\n              <p className=\"text-gray-600\">Please provide your details to start the interview</p>\n            </CardHeader>\n            <CardBody>\n              <form onSubmit={handleCandidateRegistration} className=\"space-y-6\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Full Name *\n                  </label>\n                  <Input\n                    type=\"text\"\n                    value={candidate.name}\n                    onChange={(e) => setCandidate(prev => ({ ...prev, name: e.target.value }))}\n                    required\n                    placeholder=\"Enter your full name\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Email Address *\n                  </label>\n                  <Input\n                    type=\"email\"\n                    value={candidate.email}\n                    onChange={(e) => setCandidate(prev => ({ ...prev, email: e.target.value }))}\n                    required\n                    placeholder=\"Enter your email\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Phone Number *\n                  </label>\n                  <Input\n                    type=\"tel\"\n                    value={candidate.phone}\n                    onChange={(e) => setCandidate(prev => ({ ...prev, phone: e.target.value }))}\n                    required\n                    placeholder=\"Enter your phone number\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Resume (Optional)\n                  </label>\n                  <div className=\"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors\">\n                    <div className=\"space-y-1 text-center\">\n                      <Upload className=\"mx-auto h-12 w-12 text-gray-400\" />\n                      <div className=\"flex text-sm text-gray-600\">\n                        <label htmlFor=\"resume-upload\" className=\"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500\">\n                          <span>Upload a file</span>\n                          <input\n                            id=\"resume-upload\"\n                            name=\"resume-upload\"\n                            type=\"file\"\n                            className=\"sr-only\"\n                            accept=\".pdf,.doc,.docx\"\n                            onChange={handleResumeChange}\n                          />\n                        </label>\n                        <p className=\"pl-1\">or drag and drop</p>\n                      </div>\n                      <p className=\"text-xs text-gray-500\">PDF, DOC, DOCX up to 10MB</p>\n                    </div>\n                  </div>\n                  {candidate.resume && (\n                    <div className=\"mt-2 flex items-center text-sm text-green-600\">\n                      <FileText className=\"h-4 w-4 mr-2\" />\n                      {candidate.resume.name}\n                    </div>\n                  )}\n                </div>\n                \n                <Button\n                  type=\"submit\"\n                  variant=\"primary\"\n                  size=\"lg\"\n                  className=\"w-full\"\n                  loading={submitting}\n                >\n                  Register for Interview\n                </Button>\n              </form>\n            </CardBody>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'ready') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\">\n        <div className=\"max-w-2xl mx-auto px-4\">\n          <Card className=\"shadow-xl\">\n            <CardHeader className=\"text-center\">\n              <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Ready to Start!</h1>\n              <p className=\"text-gray-600\">You're all set to begin the interview. Make sure you have a quiet environment and good internet connection.</p>\n            </CardHeader>\n            <CardBody className=\"text-center\">\n              <div className=\"space-y-4 mb-6\">\n                <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n                  <Camera className=\"h-5 w-5\" />\n                  <span>Camera will be used for video recording</span>\n                </div>\n                <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n                  <Mic className=\"h-5 w-5\" />\n                  <span>Microphone will be used for audio recording</span>\n                </div>\n                <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n                  <Clock className=\"h-5 w-5\" />\n                  <span>Interview duration: {interview?.duration_minutes || 30} minutes</span>\n                </div>\n              </div>\n              \n              <Button\n                onClick={startInterview}\n                variant=\"primary\"\n                size=\"lg\"\n                className=\"w-full\"\n                loading={submitting}\n              >\n                Start Interview\n              </Button>\n            </CardBody>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'interview') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            {/* AI Avatar */}\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <h3 className=\"text-lg font-semibold\">AI Interviewer</h3>\n                </CardHeader>\n                <CardBody>\n                  <div id=\"avatar-container\" className=\"h-64 bg-gray-100 rounded-lg flex items-center justify-center\">\n                    <div className=\"text-gray-500\">AI Avatar Loading...</div>\n                  </div>\n                </CardBody>\n              </Card>\n              \n              {/* Current Question */}\n              {interview?.questions && interview.questions[currentQuestionIndex] && (\n                <Card>\n                  <CardHeader>\n                    <h3 className=\"text-lg font-semibold\">Current Question</h3>\n                  </CardHeader>\n                  <CardBody>\n                    <p className=\"text-gray-700\">\n                      {interview.questions[currentQuestionIndex].text}\n                    </p>\n                    <div className=\"mt-4 flex flex-wrap gap-2\">\n                      {interview.questions[currentQuestionIndex].tags?.map((tag, index) => (\n                        <span key={index} className=\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full\">\n                          {tag}\n                        </span>\n                      ))}\n                    </div>\n                  </CardBody>\n                </Card>\n              )}\n            </div>\n            \n            {/* Candidate Video and Controls */}\n            <div className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <h3 className=\"text-lg font-semibold\">Your Video</h3>\n                </CardHeader>\n                <CardBody>\n                  <video\n                    ref={videoRef}\n                    autoPlay\n                    muted\n                    className=\"w-full h-48 bg-gray-900 rounded-lg\"\n                  />\n                </CardBody>\n              </Card>\n              \n              {/* Recording Controls */}\n              <Card>\n                <CardHeader>\n                  <h3 className=\"text-lg font-semibold\">Record Your Response</h3>\n                </CardHeader>\n                <CardBody>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex justify-center space-x-4\">\n                      <Button\n                        onClick={isRecording ? stopRecording : startRecording}\n                        variant={isRecording ? \"danger\" : \"primary\"}\n                        size=\"lg\"\n                      >\n                        {isRecording ? (\n                          <>\n                            <MicOff className=\"h-5 w-5 mr-2\" />\n                            Stop Recording\n                          </>\n                        ) : (\n                          <>\n                            <Mic className=\"h-5 w-5 mr-2\" />\n                            Start Recording\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                    \n                    {response && (\n                      <div className=\"text-center\">\n                        <p className=\"text-sm text-gray-600 mb-2\">Response recorded</p>\n                        <Button\n                          onClick={submitResponse}\n                          variant=\"success\"\n                          loading={submitting}\n                        >\n                          Submit Response\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                </CardBody>\n              </Card>\n              \n              {/* Progress */}\n              <Card>\n                <CardHeader>\n                  <h3 className=\"text-lg font-semibold\">Progress</h3>\n                </CardHeader>\n                <CardBody>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span>Question {currentQuestionIndex + 1} of {interview?.questions?.length || 0}</span>\n                      <span>{Math.round(((currentQuestionIndex + 1) / (interview?.questions?.length || 1)) * 100)}%</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                      <div\n                        className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n                        style={{ width: `${((currentQuestionIndex + 1) / (interview?.questions?.length || 1)) * 100}%` }}\n                      />\n                    </div>\n                  </div>\n                </CardBody>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (step === 'complete') {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\">\n        <div className=\"max-w-2xl mx-auto px-4\">\n          <Card className=\"shadow-xl\">\n            <CardHeader className=\"text-center\">\n              <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n              <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Interview Completed!</h1>\n              <p className=\"text-gray-600\">Thank you for completing the interview. Your responses have been recorded and will be reviewed.</p>\n            </CardHeader>\n            <CardBody className=\"text-center\">\n              <div className=\"space-y-4\">\n                <p className=\"text-gray-700\">\n                  We'll be in touch soon with the results. Thank you for your time and interest!\n                </p>\n                <Button onClick={() => navigate('/')} variant=\"primary\">\n                  Return Home\n                </Button>\n              </div>\n            </CardBody>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return null;\n};\n\nexport default PublicInterview;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}