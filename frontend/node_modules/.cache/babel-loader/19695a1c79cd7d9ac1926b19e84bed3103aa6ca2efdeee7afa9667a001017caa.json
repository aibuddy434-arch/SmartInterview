{"ast":null,"code":"var _jsxFileName = \"D:\\\\ai_avatar\\\\frontend\\\\src\\\\pages\\\\PublicInterview.js\",\n  _s = $RefreshSig$();\n// import React, { useState, useEffect, useRef, useCallback } from 'react';\n// import { useParams, useNavigate } from 'react-router-dom';\n// import { Card, CardHeader, CardBody } from '../components/ui/Card';\n// import Button from '../components/ui/Button';\n// import Input from '../components/ui/Input';\n// import { useToast } from '../contexts/ToastContext';\n// import { interviewService } from '../services/interviewService';\n// import { avatarService } from '../services/avatarService';\n// import { safeApiCallWithValidation } from '../utils/errorHandler';\n// import { safeApiCall } from \"../utils/errorHandler\";\n// import { aiService } from '../services/aiService';\n// import { \n//   Mic, \n//   MicOff, \n//   CheckCircle,\n//   Clock,\n//   AlertCircle,\n//   Upload,\n//   FileText,\n//   Camera\n// } from 'lucide-react';\n\n// const PublicInterview = () => {\n//   const { interviewId } = useParams();\n//   const navigate = useNavigate();\n//   const { toast } = useToast();\n\n//   const [step, setStep] = useState('loading'); // loading, register, interview, complete\n//   const [interview, setInterview] = useState(null);\n//   const [candidate, setCandidate] = useState({\n//     name: '',\n//     email: '',\n//     phone: '',\n//     resume: null\n//   });\n//   const [sessionId, setSessionId] = useState(null);\n//   const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n//   const [isRecording, setIsRecording] = useState(false);\n//   const [response, setResponse] = useState('');\n//   const [loading, setLoading] = useState(true);\n//   const [submitting, setSubmitting] = useState(false);\n//   const [avatarElement, setAvatarElement] = useState(null);\n//   const [mediaStream, setMediaStream] = useState(null);\n//   const [permissionsGranted, setPermissionsGranted] = useState(false);\n\n//   const videoRef = useRef(null);\n//   const mediaRecorderRef = useRef(null);\n//   const audioChunksRef = useRef([]);\n\n//   const loadInterview = useCallback(async () => {\n//     setLoading(true);\n\n//     const result = await safeApiCallWithValidation(\n//       () => interviewService.getPublicInterview(interviewId),\n//       ['id', 'job_role', 'questions'],\n//       'Failed to load interview. Please check the link and try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true && result.data) {\n//       setInterview(result.data);\n//       setStep('register');\n//     } else {\n//       const errorMessage = result?.error || 'Failed to load interview. Please check the link and try again.';\n//       toast.error(errorMessage);\n//       setStep('error');\n//     }\n\n//     setLoading(false);\n//   }, [interviewId, toast]);\n\n//   const initializeAvatar = useCallback(() => {\n//     if (avatarElement) return;\n\n//     const avatarContainer = document.getElementById('avatar-container');\n//     if (avatarContainer) {\n//       const avatar = avatarService.createAvatarVisuals();\n//       avatarContainer.appendChild(avatar);\n//       setAvatarElement(avatar);\n//     }\n//   }, [avatarElement]);\n\n//   useEffect(() => {\n//     loadInterview();\n//   }, [loadInterview]);\n\n//   useEffect(() => {\n//     if (interview && step === 'interview') {\n//       initializeAvatar();\n//     }\n//   }, [interview, step, initializeAvatar]);\n\n//   const handleCandidateRegistration = async (e) => {\n//     e.preventDefault();\n//     setSubmitting(true);\n\n//     try {\n//       const formData = new FormData();\n//       formData.append('name', candidate.name);\n//       formData.append('email', candidate.email);\n//       formData.append('phone', candidate.phone);\n//       if (candidate.resume) {\n//         formData.append('resume_file', candidate.resume);\n//       }\n\n//       const result = await safeApiCallWithValidation(\n//         () => interviewService.registerCandidate(interviewId, formData),\n//         ['candidate.id', 'session_id'],\n//         'Registration failed. Please try again.'\n//       );\n\n//       if (result?.success === true && result?.data) {\n//         setCandidate(prev => ({ ...prev, id: result.data.candidate.id }));\n//         setSessionId(result.data.session_id);\n//         toast.success('Registration successful! You can now start the interview.');\n//         setStep('ready');\n//       } else {\n//         const errorMessage = result?.error || 'Registration failed. Please try again.';\n//         toast.error(errorMessage);\n//       }\n//     } catch (err) {\n//       console.error(\"Registration error:\", err);\n//       toast.error(\"Something went wrong. Please try again.\");\n//     } finally {\n//       setSubmitting(false);\n//     }\n//   };\n\n//   const startInterview = async () => {\n//     setSubmitting(true);\n\n//     // Request media permissions\n//     await requestMediaPermissions();\n\n//     if (!permissionsGranted) {\n//       toast.error('Camera and microphone permissions are required for the interview.');\n//       setSubmitting(false);\n//       return;\n//     }\n\n//     // Start the interview session\n//     const result = await safeApiCall(\n//       () => interviewService.startInterviewSession(sessionId),\n//       'Failed to start interview. Please try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true) {\n//       setStep('interview');\n//       toast.success('Interview started! The AI avatar will begin asking questions.');\n//     } else {\n//       const errorMessage = result?.error || 'Failed to start interview. Please try again.';\n//       toast.error(errorMessage);\n//     }\n\n//     setSubmitting(false);\n//   };\n\n//   const requestMediaPermissions = async () => {\n//     try {\n//       const stream = await navigator.mediaDevices.getUserMedia({\n//         video: true,\n//         audio: true\n//       });\n\n//       setMediaStream(stream);\n//       setPermissionsGranted(true);\n\n//       if (videoRef.current) {\n//         videoRef.current.srcObject = stream;\n//       }\n\n//       return true;\n//     } catch (error) {\n//       console.error('Media permission denied:', error);\n//       setPermissionsGranted(false);\n//       return false;\n//     }\n//   };\n\n//   const askQuestion = async (questionText) => {\n//     if (!avatarElement) return;\n\n//     try {\n//       // Generate TTS audio for the question\n//       const audioBlob = await aiService.generateTTS(questionText);\n//       const audioUrl = URL.createObjectURL(audioBlob);\n//       const audio = new Audio(audioUrl);\n\n//       // Start lip sync animation\n//       avatarService.startLipSyncAnimation(avatarElement, audio);\n\n//       audio.onended = () => {\n//         URL.revokeObjectURL(audioUrl);\n//       };\n\n//       audio.play();\n//     } catch (error) {\n//       console.error('Failed to ask question:', error);\n//     }\n//   };\n\n//   const startRecording = () => {\n//     if (!mediaStream) return;\n\n//     try {\n//       mediaRecorderRef.current = new MediaRecorder(mediaStream);\n//       audioChunksRef.current = [];\n\n//       mediaRecorderRef.current.ondataavailable = (event) => {\n//         audioChunksRef.current.push(event.data);\n//       };\n\n//       mediaRecorderRef.current.onstop = () => {\n//         const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n//         setResponse(audioBlob);\n//       };\n\n//       mediaRecorderRef.current.start();\n//       setIsRecording(true);\n//     } catch (error) {\n//       console.error('Failed to start recording:', error);\n//     }\n//   };\n\n//   const stopRecording = () => {\n//     if (mediaRecorderRef.current && isRecording) {\n//       mediaRecorderRef.current.stop();\n//       setIsRecording(false);\n//     }\n//   };\n\n//   const submitResponse = async () => {\n//     if (!response) return;\n\n//     setSubmitting(true);\n\n//     const formData = new FormData();\n//     formData.append('question_number', currentQuestionIndex);\n//     formData.append('response_text', typeof response === 'string' ? response : '');\n\n//     if (response instanceof Blob) {\n//       formData.append('audio_file', response, 'response.wav');\n//     }\n\n//     const result = await safeApiCall(\n//       () => interviewService.submitResponse(sessionId, formData),\n//       'Failed to submit response. Please try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true) {\n//       // Move to next question\n//       const nextIndex = currentQuestionIndex + 1;\n//       if (nextIndex < interview.questions.length) {\n//         setCurrentQuestionIndex(nextIndex);\n//         setResponse('');\n\n//         // Ask next question\n//         setTimeout(() => {\n//           askQuestion(interview.questions[nextIndex].text);\n//         }, 1000);\n//       } else {\n//         // Interview completed\n//         await completeInterview();\n//       }\n//     } else {\n//       const errorMessage = result?.error || 'Failed to submit response. Please try again.';\n//       toast.error(errorMessage);\n//     }\n\n//     setSubmitting(false);\n//   };\n\n//   const completeInterview = async () => {\n//     const result = await safeApiCall(\n//       () => interviewService.completeSession(sessionId),\n//       'Failed to complete interview. Please try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true) {\n//       setStep('complete');\n//       toast.success('Interview completed successfully! Thank you for your time.');\n//     } else {\n//       const errorMessage = result?.error || 'Failed to complete interview. Please try again.';\n//       toast.error(errorMessage);\n//     }\n//   };\n\n//   const handleResumeChange = (e) => {\n//     const file = e.target.files[0];\n//     if (file && (file.type === 'application/pdf' || file.type === 'application/msword' || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document')) {\n//       setCandidate(prev => ({ ...prev, resume: file }));\n//     } else {\n//       toast.error('Please upload a PDF or Word document.');\n//     }\n//   };\n\n//   if (loading) {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\n//         <div className=\"text-center\">\n//           <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto\"></div>\n//           <p className=\"mt-4 text-gray-600\">Loading interview...</p>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'error') {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-pink-100\">\n//         <Card className=\"max-w-md mx-auto\">\n//           <CardBody className=\"text-center\">\n//             <AlertCircle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\n//             <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Interview Not Found</h2>\n//             <p className=\"text-gray-600 mb-4\">The interview link you're trying to access is invalid or has expired.</p>\n//             <Button onClick={() => navigate('/')} variant=\"primary\">\n//               Go Home\n//             </Button>\n//           </CardBody>\n//         </Card>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'register') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12\">\n//         <div className=\"max-w-2xl mx-auto px-4\">\n//           <Card className=\"shadow-xl\">\n//             <CardHeader className=\"text-center\">\n//               <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Interview Registration</h1>\n//               <p className=\"text-gray-600\">Please provide your details to start the interview</p>\n//             </CardHeader>\n//             <CardBody>\n//               <form onSubmit={handleCandidateRegistration} className=\"space-y-6\">\n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Full Name *\n//                   </label>\n//                   <Input\n//                     type=\"text\"\n//                     value={candidate.name}\n//                     onChange={(e) => setCandidate(prev => ({ ...prev, name: e.target.value }))}\n//                     required\n//                     placeholder=\"Enter your full name\"\n//                   />\n//                 </div>\n\n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Email Address *\n//                   </label>\n//                   <Input\n//                     type=\"email\"\n//                     value={candidate.email}\n//                     onChange={(e) => setCandidate(prev => ({ ...prev, email: e.target.value }))}\n//                     required\n//                     placeholder=\"Enter your email\"\n//                   />\n//                 </div>\n\n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Phone Number *\n//                   </label>\n//                   <Input\n//                     type=\"tel\"\n//                     value={candidate.phone}\n//                     onChange={(e) => setCandidate(prev => ({ ...prev, phone: e.target.value }))}\n//                     required\n//                     placeholder=\"Enter your phone number\"\n//                   />\n//                 </div>\n\n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Resume (Optional)\n//                   </label>\n//                   <div className=\"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors\">\n//                     <div className=\"space-y-1 text-center\">\n//                       <Upload className=\"mx-auto h-12 w-12 text-gray-400\" />\n//                       <div className=\"flex text-sm text-gray-600\">\n//                         <label htmlFor=\"resume-upload\" className=\"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500\">\n//                           <span>Upload a file</span>\n//                           <input\n//                             id=\"resume-upload\"\n//                             name=\"resume-upload\"\n//                             type=\"file\"\n//                             className=\"sr-only\"\n//                             accept=\".pdf,.doc,.docx\"\n//                             onChange={handleResumeChange}\n//                           />\n//                         </label>\n//                         <p className=\"pl-1\">or drag and drop</p>\n//                       </div>\n//                       <p className=\"text-xs text-gray-500\">PDF, DOC, DOCX up to 10MB</p>\n//                     </div>\n//                   </div>\n//                   {candidate.resume && (\n//                     <div className=\"mt-2 flex items-center text-sm text-green-600\">\n//                       <FileText className=\"h-4 w-4 mr-2\" />\n//                       {candidate.resume.name}\n//                     </div>\n//                   )}\n//                 </div>\n\n//                 <Button\n//                   type=\"submit\"\n//                   variant=\"primary\"\n//                   size=\"lg\"\n//                   className=\"w-full\"\n//                   loading={submitting}\n//                 >\n//                   Register for Interview\n//                 </Button>\n//               </form>\n//             </CardBody>\n//           </Card>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'ready') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\">\n//         <div className=\"max-w-2xl mx-auto px-4\">\n//           <Card className=\"shadow-xl\">\n//             <CardHeader className=\"text-center\">\n//               <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n//               <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Ready to Start!</h1>\n//               <p className=\"text-gray-600\">You're all set to begin the interview. Make sure you have a quiet environment and good internet connection.</p>\n//             </CardHeader>\n//             <CardBody className=\"text-center\">\n//               <div className=\"space-y-4 mb-6\">\n//                 <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n//                   <Camera className=\"h-5 w-5\" />\n//                   <span>Camera will be used for video recording</span>\n//                 </div>\n//                 <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n//                   <Mic className=\"h-5 w-5\" />\n//                   <span>Microphone will be used for audio recording</span>\n//                 </div>\n//                 <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n//                   <Clock className=\"h-5 w-5\" />\n//                   <span>Interview duration: {interview?.duration_minutes || 30} minutes</span>\n//                 </div>\n//               </div>\n\n//               <Button\n//                 onClick={startInterview}\n//                 variant=\"primary\"\n//                 size=\"lg\"\n//                 className=\"w-full\"\n//                 loading={submitting}\n//               >\n//                 Start Interview\n//               </Button>\n//             </CardBody>\n//           </Card>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'interview') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100\">\n//         <div className=\"container mx-auto px-4 py-8\">\n//           <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n//             {/* AI Avatar */}\n//             <div className=\"space-y-4\">\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">AI Interviewer</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <div id=\"avatar-container\" className=\"h-64 bg-gray-100 rounded-lg flex items-center justify-center\">\n//                     <div className=\"text-gray-500\">AI Avatar Loading...</div>\n//                   </div>\n//                 </CardBody>\n//               </Card>\n\n//               {/* Current Question */}\n//               {interview?.questions && interview.questions[currentQuestionIndex] && (\n//                 <Card>\n//                   <CardHeader>\n//                     <h3 className=\"text-lg font-semibold\">Current Question</h3>\n//                   </CardHeader>\n//                   <CardBody>\n//                     <p className=\"text-gray-700\">\n//                       {interview.questions[currentQuestionIndex].text}\n//                     </p>\n//                     <div className=\"mt-4 flex flex-wrap gap-2\">\n//                       {interview.questions[currentQuestionIndex].tags?.map((tag, index) => (\n//                         <span key={index} className=\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full\">\n//                           {tag}\n//                         </span>\n//                       ))}\n//                     </div>\n//                   </CardBody>\n//                 </Card>\n//               )}\n//             </div>\n\n//             {/* Candidate Video and Controls */}\n//             <div className=\"space-y-4\">\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">Your Video</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <video\n//                     ref={videoRef}\n//                     autoPlay\n//                     muted\n//                     className=\"w-full h-48 bg-gray-900 rounded-lg\"\n//                   />\n//                 </CardBody>\n//               </Card>\n\n//               {/* Recording Controls */}\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">Record Your Response</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <div className=\"space-y-4\">\n//                     <div className=\"flex justify-center space-x-4\">\n//                       <Button\n//                         onClick={isRecording ? stopRecording : startRecording}\n//                         variant={isRecording ? \"danger\" : \"primary\"}\n//                         size=\"lg\"\n//                       >\n//                         {isRecording ? (\n//                           <>\n//                             <MicOff className=\"h-5 w-5 mr-2\" />\n//                             Stop Recording\n//                           </>\n//                         ) : (\n//                           <>\n//                             <Mic className=\"h-5 w-5 mr-2\" />\n//                             Start Recording\n//                           </>\n//                         )}\n//                       </Button>\n//                     </div>\n\n//                     {response && (\n//                       <div className=\"text-center\">\n//                         <p className=\"text-sm text-gray-600 mb-2\">Response recorded</p>\n//                         <Button\n//                           onClick={submitResponse}\n//                           variant=\"success\"\n//                           loading={submitting}\n//                         >\n//                           Submit Response\n//                         </Button>\n//                       </div>\n//                     )}\n//                   </div>\n//                 </CardBody>\n//               </Card>\n\n//               {/* Progress */}\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">Progress</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <div className=\"space-y-2\">\n//                     <div className=\"flex justify-between text-sm\">\n//                       <span>Question {currentQuestionIndex + 1} of {interview?.questions?.length || 0}</span>\n//                       <span>{Math.round(((currentQuestionIndex + 1) / (interview?.questions?.length || 1)) * 100)}%</span>\n//                     </div>\n//                     <div className=\"w-full bg-gray-200 rounded-full h-2\">\n//                       <div\n//                         className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n//                         style={{ width: `${((currentQuestionIndex + 1) / (interview?.questions?.length || 1)) * 100}%` }}\n//                       />\n//                     </div>\n//                   </div>\n//                 </CardBody>\n//               </Card>\n//             </div>\n//           </div>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'complete') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\">\n//         <div className=\"max-w-2xl mx-auto px-4\">\n//           <Card className=\"shadow-xl\">\n//             <CardHeader className=\"text-center\">\n//               <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n//               <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Interview Completed!</h1>\n//               <p className=\"text-gray-600\">Thank you for completing the interview. Your responses have been recorded and will be reviewed.</p>\n//             </CardHeader>\n//             <CardBody className=\"text-center\">\n//               <div className=\"space-y-4\">\n//                 <p className=\"text-gray-700\">\n//                   We'll be in touch soon with the results. Thank you for your time and interest!\n//                 </p>\n//                 <Button onClick={() => navigate('/')} variant=\"primary\">\n//                   Return Home\n//                 </Button>\n//               </div>\n//             </CardBody>\n//           </Card>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   return null;\n// };\n\n// export default PublicInterview;\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Card, CardHeader, CardBody } from '../components/ui/Card';\nimport Button from '../components/ui/Button';\nimport Input from '../components/ui/Input';\nimport { useToast } from '../contexts/ToastContext';\nimport { interviewService } from '../services/interviewService';\nimport { avatarService } from '../services/avatarService';\nimport { safeApiCall, safeApiCallWithValidation } from '../utils/errorHandler';\nimport { aiService } from '../services/aiService';\nimport { Mic, MicOff, CheckCircle, Clock, AlertCircle, Upload, FileText, Camera } from 'lucide-react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PublicInterview = () => {\n  _s();\n  const {\n    interviewId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    toast\n  } = useToast();\n  const [step, setStep] = useState('loading'); // loading, register, interview, complete\n  const [interview, setInterview] = useState(null);\n  const [candidate, setCandidate] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    resume: null\n  });\n  const [sessionId, setSessionId] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [isRecording, setIsRecording] = useState(false);\n  const [response, setResponse] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [avatarElement, setAvatarElement] = useState(null);\n  const [mediaStream, setMediaStream] = useState(null);\n  const [permissionsGranted, setPermissionsGranted] = useState(false);\n  const videoRef = useRef(null);\n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n  const loadInterview = useCallback(async () => {\n    setLoading(true);\n    try {\n      const result = await safeApiCallWithValidation(() => interviewService.getPublicInterview(interviewId), ['id', 'job_role', 'questions'], 'Failed to load interview. Please check the link.');\n      if (result && result.success && result.data) {\n        setInterview(result.data);\n        setStep('register');\n      } else {\n        toast.error((result === null || result === void 0 ? void 0 : result.error) || 'Failed to load interview. Please check the link.');\n        setStep('error');\n      }\n    } catch (err) {\n      console.error('Error loading interview:', err);\n      toast.error('Failed to load interview. Please try again.');\n      setStep('error');\n    } finally {\n      setLoading(false);\n    }\n  }, [interviewId, toast]);\n  const initializeAvatar = useCallback(() => {\n    if (avatarElement) return;\n    const container = document.getElementById('avatar-container');\n    if (container) {\n      const avatar = avatarService.createAvatarVisuals();\n      container.appendChild(avatar);\n      setAvatarElement(avatar);\n    }\n  }, [avatarElement]);\n  useEffect(() => {\n    loadInterview();\n  }, [loadInterview]);\n  useEffect(() => {\n    if (interview && step === 'interview') {\n      initializeAvatar();\n    }\n  }, [interview, step, initializeAvatar]);\n  const handleCandidateChange = (field, value) => {\n    setCandidate(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n  const handleResumeChange = e => {\n    const file = e.target.files[0];\n    if (file && ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'].includes(file.type)) {\n      setCandidate(prev => ({\n        ...prev,\n        resume: file\n      }));\n    } else {\n      toast.error('Please upload a PDF or Word document.');\n    }\n  };\n  const handleRegistration = async e => {\n    e.preventDefault();\n    setSubmitting(true);\n    try {\n      const formData = new FormData();\n      formData.append('name', candidate.name);\n      formData.append('email', candidate.email);\n      formData.append('phone', candidate.phone);\n      if (candidate.resume) formData.append('resume_file', candidate.resume);\n      const result = await safeApiCallWithValidation(() => interviewService.registerCandidate(interviewId, formData), ['id', 'session_id', 'candidate.id'], 'Registration failed. Please try again.');\n      if (result && result.success && result.data && result.data.candidate && result.data.session_id) {\n        setCandidate(prev => ({\n          ...prev,\n          id: result.data.candidate.id\n        }));\n        setSessionId(result.data.session_id);\n        toast.success('Registration successful.');\n        setStep('ready');\n      } else {\n        toast.error((result === null || result === void 0 ? void 0 : result.error) || 'Registration failed.');\n      }\n    } catch (err) {\n      console.error('Registration error:', err);\n      toast.error('Unexpected error during registration.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n  const requestPermissions = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: true\n      });\n      setMediaStream(stream);\n      setPermissionsGranted(true);\n      if (videoRef.current) videoRef.current.srcObject = stream;\n      return true;\n    } catch (err) {\n      console.error('Permission error:', err);\n      setPermissionsGranted(false);\n      return false;\n    }\n  };\n  const startInterview = async () => {\n    setSubmitting(true);\n    if (!(await requestPermissions())) {\n      toast.error('Camera and microphone permissions required.');\n      setSubmitting(false);\n      return;\n    }\n    try {\n      const result = await safeApiCall(() => interviewService.startInterviewSession(sessionId), 'Failed to start interview.');\n      if (result && result.success) {\n        setStep('interview');\n      } else {\n        toast.error((result === null || result === void 0 ? void 0 : result.error) || 'Failed to start interview.');\n      }\n    } catch (err) {\n      console.error('Start interview error:', err);\n      toast.error('Error starting interview.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n  const askQuestion = async text => {\n    if (!avatarElement) return;\n    try {\n      const audioBlob = await aiService.generateTTS(text);\n      const audioUrl = URL.createObjectURL(audioBlob);\n      const audio = new Audio(audioUrl);\n      avatarService.startLipSyncAnimation(avatarElement, audio);\n      audio.onended = () => URL.revokeObjectURL(audioUrl);\n      audio.play();\n    } catch (err) {\n      console.error('Ask question error:', err);\n    }\n  };\n  const startRecording = () => {\n    if (!mediaStream) return;\n    try {\n      mediaRecorderRef.current = new MediaRecorder(mediaStream);\n      audioChunksRef.current = [];\n      mediaRecorderRef.current.ondataavailable = e => audioChunksRef.current.push(e.data);\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, {\n          type: 'audio/wav'\n        });\n        setResponse(audioBlob);\n      };\n      mediaRecorderRef.current.start();\n      setIsRecording(true);\n    } catch (err) {\n      console.error('Start recording error:', err);\n      toast.error('Failed to start recording.');\n    }\n  };\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n  const submitResponse = async () => {\n    if (!response) return;\n    setSubmitting(true);\n    try {\n      const formData = new FormData();\n      formData.append('question_number', currentQuestionIndex);\n      formData.append('response_text', typeof response === 'string' ? response : '');\n      if (response instanceof Blob) formData.append('audio_file', response);\n      const result = await safeApiCall(() => interviewService.submitResponse(sessionId, formData), 'Failed to submit response.');\n      if (result && result.success) {\n        var _interview$questions;\n        const next = currentQuestionIndex + 1;\n        if (next < ((interview === null || interview === void 0 ? void 0 : (_interview$questions = interview.questions) === null || _interview$questions === void 0 ? void 0 : _interview$questions.length) || 0)) {\n          setCurrentQuestionIndex(next);\n          setResponse('');\n          setTimeout(() => askQuestion(interview.questions[next]), 1000);\n        } else {\n          await completeInterview();\n        }\n      } else {\n        toast.error((result === null || result === void 0 ? void 0 : result.error) || 'Submission failed.');\n      }\n    } catch (err) {\n      console.error('Submit response error:', err);\n      toast.error('Unexpected error submitting response.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n  const completeInterview = async () => {\n    setSubmitting(true);\n    try {\n      const result = await safeApiCall(() => interviewService.completeSession(sessionId), 'Failed to finish interview.');\n      if (result && result.success) {\n        setStep('complete');\n      } else {\n        toast.error((result === null || result === void 0 ? void 0 : result.error) || 'Completion failed.');\n      }\n    } catch (err) {\n      console.error('Complete interview error:', err);\n      toast.error('Error completing interview.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-container\",\n      children: \"Loading interview...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 889,\n      columnNumber: 7\n    }, this);\n  }\n  if (step === 'error') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"The interview link is invalid or expired.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 898,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        onClick: () => navigate('/'),\n        children: \"Go Home\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 899,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 897,\n      columnNumber: 7\n    }, this);\n  }\n  if (step === 'register') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"register-container\",\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n          children: \"Interview Registration\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 908,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(CardBody, {\n          children: /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: handleRegistration,\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              label: \"Full Name\",\n              value: candidate.name,\n              onChange: e => handleCandidateChange('name', e.target.value),\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 911,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Input, {\n              label: \"Email\",\n              type: \"email\",\n              value: candidate.email,\n              onChange: e => handleCandidateChange('email', e.target.value),\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 912,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Input, {\n              label: \"Phone\",\n              value: candidate.phone,\n              onChange: e => handleCandidateChange('phone', e.target.value),\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 913,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Input, {\n              label: \"Resume (Optional)\",\n              type: \"file\",\n              onChange: handleResumeChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 914,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              type: \"submit\",\n              disabled: submitting,\n              children: submitting ? 'Registering...' : 'Register'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 915,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 910,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 909,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 907,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 906,\n      columnNumber: 7\n    }, this);\n  }\n  if (step === 'ready') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ready-container\",\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n          children: \"You\\u2019re all set to begin!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 927,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(CardBody, {\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            onClick: startInterview,\n            disabled: submitting,\n            children: submitting ? 'Starting...' : 'Start Interview'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 929,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 928,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 926,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 925,\n      columnNumber: 7\n    }, this);\n  }\n  if (step === 'interview') {\n    var _interview$questions$;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"interview-container\",\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: \"AI Interviewer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 941,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 940,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(CardBody, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"avatar-container\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 944,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"Question \", currentQuestionIndex + 1, \" of \", interview === null || interview === void 0 ? void 0 : interview.questions.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 945,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: (_interview$questions$ = interview.questions[currentQuestionIndex]) === null || _interview$questions$ === void 0 ? void 0 : _interview$questions$.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 946,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              muted: true,\n              playsInline: true,\n              style: {\n                display: 'none'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 948,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              onClick: isRecording ? stopRecording : startRecording,\n              disabled: submitting,\n              children: [isRecording ? /*#__PURE__*/_jsxDEV(MicOff, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 950,\n                columnNumber: 32\n              }, this) : /*#__PURE__*/_jsxDEV(Mic, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 950,\n                columnNumber: 45\n              }, this), \" \", isRecording ? 'Stop Recording' : 'Start Recording']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 949,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              onClick: submitResponse,\n              disabled: !response || submitting,\n              children: [/*#__PURE__*/_jsxDEV(CheckCircle, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 953,\n                columnNumber: 17\n              }, this), \" Submit Response\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 952,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 947,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"small\", {\n              children: `Progress: ${Math.round((currentQuestionIndex + 1) / interview.questions.length * 100)}%`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 957,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 956,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 943,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 939,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 938,\n      columnNumber: 7\n    }, this);\n  }\n  if (step === 'complete') {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"complete-container\",\n      children: /*#__PURE__*/_jsxDEV(Card, {\n        children: [/*#__PURE__*/_jsxDEV(CardHeader, {\n          children: \"Interview Completed\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 969,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(CardBody, {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Thank you for completing the interview. Your responses have been recorded.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 971,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: () => navigate('/'),\n            children: \"Return Home\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 972,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 970,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 968,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 967,\n      columnNumber: 7\n    }, this);\n  }\n  return null;\n};\n_s(PublicInterview, \"Cegmf894tt68jnbvRtZb3CG4Y0g=\", false, function () {\n  return [useParams, useNavigate, useToast];\n});\n_c = PublicInterview;\nexport default PublicInterview;\nvar _c;\n$RefreshReg$(_c, \"PublicInterview\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useParams","useNavigate","Card","CardHeader","CardBody","Button","Input","useToast","interviewService","avatarService","safeApiCall","safeApiCallWithValidation","aiService","Mic","MicOff","CheckCircle","Clock","AlertCircle","Upload","FileText","Camera","jsxDEV","_jsxDEV","PublicInterview","_s","interviewId","navigate","toast","step","setStep","interview","setInterview","candidate","setCandidate","name","email","phone","resume","sessionId","setSessionId","currentQuestionIndex","setCurrentQuestionIndex","isRecording","setIsRecording","response","setResponse","loading","setLoading","submitting","setSubmitting","avatarElement","setAvatarElement","mediaStream","setMediaStream","permissionsGranted","setPermissionsGranted","videoRef","mediaRecorderRef","audioChunksRef","loadInterview","result","getPublicInterview","success","data","error","err","console","initializeAvatar","container","document","getElementById","avatar","createAvatarVisuals","appendChild","handleCandidateChange","field","value","prev","handleResumeChange","e","file","target","files","includes","type","handleRegistration","preventDefault","formData","FormData","append","registerCandidate","session_id","id","requestPermissions","stream","navigator","mediaDevices","getUserMedia","audio","video","current","srcObject","startInterview","startInterviewSession","askQuestion","text","audioBlob","generateTTS","audioUrl","URL","createObjectURL","Audio","startLipSyncAnimation","onended","revokeObjectURL","play","startRecording","MediaRecorder","ondataavailable","push","onstop","Blob","start","stopRecording","stop","submitResponse","_interview$questions","next","questions","length","setTimeout","completeInterview","completeSession","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","onSubmit","label","onChange","required","disabled","_interview$questions$","ref","autoPlay","muted","playsInline","style","display","Math","round","_c","$RefreshReg$"],"sources":["D:/ai_avatar/frontend/src/pages/PublicInterview.js"],"sourcesContent":["// import React, { useState, useEffect, useRef, useCallback } from 'react';\n// import { useParams, useNavigate } from 'react-router-dom';\n// import { Card, CardHeader, CardBody } from '../components/ui/Card';\n// import Button from '../components/ui/Button';\n// import Input from '../components/ui/Input';\n// import { useToast } from '../contexts/ToastContext';\n// import { interviewService } from '../services/interviewService';\n// import { avatarService } from '../services/avatarService';\n// import { safeApiCallWithValidation } from '../utils/errorHandler';\n// import { safeApiCall } from \"../utils/errorHandler\";\n// import { aiService } from '../services/aiService';\n// import { \n//   Mic, \n//   MicOff, \n//   CheckCircle,\n//   Clock,\n//   AlertCircle,\n//   Upload,\n//   FileText,\n//   Camera\n// } from 'lucide-react';\n\n// const PublicInterview = () => {\n//   const { interviewId } = useParams();\n//   const navigate = useNavigate();\n//   const { toast } = useToast();\n  \n//   const [step, setStep] = useState('loading'); // loading, register, interview, complete\n//   const [interview, setInterview] = useState(null);\n//   const [candidate, setCandidate] = useState({\n//     name: '',\n//     email: '',\n//     phone: '',\n//     resume: null\n//   });\n//   const [sessionId, setSessionId] = useState(null);\n//   const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n//   const [isRecording, setIsRecording] = useState(false);\n//   const [response, setResponse] = useState('');\n//   const [loading, setLoading] = useState(true);\n//   const [submitting, setSubmitting] = useState(false);\n//   const [avatarElement, setAvatarElement] = useState(null);\n//   const [mediaStream, setMediaStream] = useState(null);\n//   const [permissionsGranted, setPermissionsGranted] = useState(false);\n  \n//   const videoRef = useRef(null);\n//   const mediaRecorderRef = useRef(null);\n//   const audioChunksRef = useRef([]);\n\n//   const loadInterview = useCallback(async () => {\n//     setLoading(true);\n    \n//     const result = await safeApiCallWithValidation(\n//       () => interviewService.getPublicInterview(interviewId),\n//       ['id', 'job_role', 'questions'],\n//       'Failed to load interview. Please check the link and try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true && result.data) {\n//       setInterview(result.data);\n//       setStep('register');\n//     } else {\n//       const errorMessage = result?.error || 'Failed to load interview. Please check the link and try again.';\n//       toast.error(errorMessage);\n//       setStep('error');\n//     }\n    \n//     setLoading(false);\n//   }, [interviewId, toast]);\n\n//   const initializeAvatar = useCallback(() => {\n//     if (avatarElement) return;\n    \n//     const avatarContainer = document.getElementById('avatar-container');\n//     if (avatarContainer) {\n//       const avatar = avatarService.createAvatarVisuals();\n//       avatarContainer.appendChild(avatar);\n//       setAvatarElement(avatar);\n//     }\n//   }, [avatarElement]);\n\n//   useEffect(() => {\n//     loadInterview();\n//   }, [loadInterview]);\n\n//   useEffect(() => {\n//     if (interview && step === 'interview') {\n//       initializeAvatar();\n//     }\n//   }, [interview, step, initializeAvatar]);\n\n\n//   const handleCandidateRegistration = async (e) => {\n//     e.preventDefault();\n//     setSubmitting(true);\n\n//     try {\n//       const formData = new FormData();\n//       formData.append('name', candidate.name);\n//       formData.append('email', candidate.email);\n//       formData.append('phone', candidate.phone);\n//       if (candidate.resume) {\n//         formData.append('resume_file', candidate.resume);\n//       }\n\n//       const result = await safeApiCallWithValidation(\n//         () => interviewService.registerCandidate(interviewId, formData),\n//         ['candidate.id', 'session_id'],\n//         'Registration failed. Please try again.'\n//       );\n\n//       if (result?.success === true && result?.data) {\n//         setCandidate(prev => ({ ...prev, id: result.data.candidate.id }));\n//         setSessionId(result.data.session_id);\n//         toast.success('Registration successful! You can now start the interview.');\n//         setStep('ready');\n//       } else {\n//         const errorMessage = result?.error || 'Registration failed. Please try again.';\n//         toast.error(errorMessage);\n//       }\n//     } catch (err) {\n//       console.error(\"Registration error:\", err);\n//       toast.error(\"Something went wrong. Please try again.\");\n//     } finally {\n//       setSubmitting(false);\n//     }\n//   };\n\n\n//   const startInterview = async () => {\n//     setSubmitting(true);\n    \n//     // Request media permissions\n//     await requestMediaPermissions();\n    \n//     if (!permissionsGranted) {\n//       toast.error('Camera and microphone permissions are required for the interview.');\n//       setSubmitting(false);\n//       return;\n//     }\n\n//     // Start the interview session\n//     const result = await safeApiCall(\n//       () => interviewService.startInterviewSession(sessionId),\n//       'Failed to start interview. Please try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true) {\n//       setStep('interview');\n//       toast.success('Interview started! The AI avatar will begin asking questions.');\n//     } else {\n//       const errorMessage = result?.error || 'Failed to start interview. Please try again.';\n//       toast.error(errorMessage);\n//     }\n    \n//     setSubmitting(false);\n//   };\n\n//   const requestMediaPermissions = async () => {\n//     try {\n//       const stream = await navigator.mediaDevices.getUserMedia({\n//         video: true,\n//         audio: true\n//       });\n      \n//       setMediaStream(stream);\n//       setPermissionsGranted(true);\n      \n//       if (videoRef.current) {\n//         videoRef.current.srcObject = stream;\n//       }\n      \n//       return true;\n//     } catch (error) {\n//       console.error('Media permission denied:', error);\n//       setPermissionsGranted(false);\n//       return false;\n//     }\n//   };\n\n\n//   const askQuestion = async (questionText) => {\n//     if (!avatarElement) return;\n    \n//     try {\n//       // Generate TTS audio for the question\n//       const audioBlob = await aiService.generateTTS(questionText);\n//       const audioUrl = URL.createObjectURL(audioBlob);\n//       const audio = new Audio(audioUrl);\n      \n//       // Start lip sync animation\n//       avatarService.startLipSyncAnimation(avatarElement, audio);\n      \n//       audio.onended = () => {\n//         URL.revokeObjectURL(audioUrl);\n//       };\n      \n//       audio.play();\n//     } catch (error) {\n//       console.error('Failed to ask question:', error);\n//     }\n//   };\n\n//   const startRecording = () => {\n//     if (!mediaStream) return;\n    \n//     try {\n//       mediaRecorderRef.current = new MediaRecorder(mediaStream);\n//       audioChunksRef.current = [];\n      \n//       mediaRecorderRef.current.ondataavailable = (event) => {\n//         audioChunksRef.current.push(event.data);\n//       };\n      \n//       mediaRecorderRef.current.onstop = () => {\n//         const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n//         setResponse(audioBlob);\n//       };\n      \n//       mediaRecorderRef.current.start();\n//       setIsRecording(true);\n//     } catch (error) {\n//       console.error('Failed to start recording:', error);\n//     }\n//   };\n\n//   const stopRecording = () => {\n//     if (mediaRecorderRef.current && isRecording) {\n//       mediaRecorderRef.current.stop();\n//       setIsRecording(false);\n//     }\n//   };\n\n//   const submitResponse = async () => {\n//     if (!response) return;\n    \n//     setSubmitting(true);\n    \n//     const formData = new FormData();\n//     formData.append('question_number', currentQuestionIndex);\n//     formData.append('response_text', typeof response === 'string' ? response : '');\n    \n//     if (response instanceof Blob) {\n//       formData.append('audio_file', response, 'response.wav');\n//     }\n    \n//     const result = await safeApiCall(\n//       () => interviewService.submitResponse(sessionId, formData),\n//       'Failed to submit response. Please try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true) {\n//       // Move to next question\n//       const nextIndex = currentQuestionIndex + 1;\n//       if (nextIndex < interview.questions.length) {\n//         setCurrentQuestionIndex(nextIndex);\n//         setResponse('');\n        \n//         // Ask next question\n//         setTimeout(() => {\n//           askQuestion(interview.questions[nextIndex].text);\n//         }, 1000);\n//       } else {\n//         // Interview completed\n//         await completeInterview();\n//       }\n//     } else {\n//       const errorMessage = result?.error || 'Failed to submit response. Please try again.';\n//       toast.error(errorMessage);\n//     }\n    \n//     setSubmitting(false);\n//   };\n\n//   const completeInterview = async () => {\n//     const result = await safeApiCall(\n//       () => interviewService.completeSession(sessionId),\n//       'Failed to complete interview. Please try again.'\n//     );\n\n//     // Safely check result object and properties\n//     if (result && result.success === true) {\n//       setStep('complete');\n//       toast.success('Interview completed successfully! Thank you for your time.');\n//     } else {\n//       const errorMessage = result?.error || 'Failed to complete interview. Please try again.';\n//       toast.error(errorMessage);\n//     }\n//   };\n\n//   const handleResumeChange = (e) => {\n//     const file = e.target.files[0];\n//     if (file && (file.type === 'application/pdf' || file.type === 'application/msword' || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document')) {\n//       setCandidate(prev => ({ ...prev, resume: file }));\n//     } else {\n//       toast.error('Please upload a PDF or Word document.');\n//     }\n//   };\n\n//   if (loading) {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\n//         <div className=\"text-center\">\n//           <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto\"></div>\n//           <p className=\"mt-4 text-gray-600\">Loading interview...</p>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'error') {\n//     return (\n//       <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-pink-100\">\n//         <Card className=\"max-w-md mx-auto\">\n//           <CardBody className=\"text-center\">\n//             <AlertCircle className=\"h-16 w-16 text-red-500 mx-auto mb-4\" />\n//             <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">Interview Not Found</h2>\n//             <p className=\"text-gray-600 mb-4\">The interview link you're trying to access is invalid or has expired.</p>\n//             <Button onClick={() => navigate('/')} variant=\"primary\">\n//               Go Home\n//             </Button>\n//           </CardBody>\n//         </Card>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'register') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12\">\n//         <div className=\"max-w-2xl mx-auto px-4\">\n//           <Card className=\"shadow-xl\">\n//             <CardHeader className=\"text-center\">\n//               <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Interview Registration</h1>\n//               <p className=\"text-gray-600\">Please provide your details to start the interview</p>\n//             </CardHeader>\n//             <CardBody>\n//               <form onSubmit={handleCandidateRegistration} className=\"space-y-6\">\n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Full Name *\n//                   </label>\n//                   <Input\n//                     type=\"text\"\n//                     value={candidate.name}\n//                     onChange={(e) => setCandidate(prev => ({ ...prev, name: e.target.value }))}\n//                     required\n//                     placeholder=\"Enter your full name\"\n//                   />\n//                 </div>\n                \n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Email Address *\n//                   </label>\n//                   <Input\n//                     type=\"email\"\n//                     value={candidate.email}\n//                     onChange={(e) => setCandidate(prev => ({ ...prev, email: e.target.value }))}\n//                     required\n//                     placeholder=\"Enter your email\"\n//                   />\n//                 </div>\n                \n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Phone Number *\n//                   </label>\n//                   <Input\n//                     type=\"tel\"\n//                     value={candidate.phone}\n//                     onChange={(e) => setCandidate(prev => ({ ...prev, phone: e.target.value }))}\n//                     required\n//                     placeholder=\"Enter your phone number\"\n//                   />\n//                 </div>\n                \n//                 <div>\n//                   <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n//                     Resume (Optional)\n//                   </label>\n//                   <div className=\"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md hover:border-gray-400 transition-colors\">\n//                     <div className=\"space-y-1 text-center\">\n//                       <Upload className=\"mx-auto h-12 w-12 text-gray-400\" />\n//                       <div className=\"flex text-sm text-gray-600\">\n//                         <label htmlFor=\"resume-upload\" className=\"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500\">\n//                           <span>Upload a file</span>\n//                           <input\n//                             id=\"resume-upload\"\n//                             name=\"resume-upload\"\n//                             type=\"file\"\n//                             className=\"sr-only\"\n//                             accept=\".pdf,.doc,.docx\"\n//                             onChange={handleResumeChange}\n//                           />\n//                         </label>\n//                         <p className=\"pl-1\">or drag and drop</p>\n//                       </div>\n//                       <p className=\"text-xs text-gray-500\">PDF, DOC, DOCX up to 10MB</p>\n//                     </div>\n//                   </div>\n//                   {candidate.resume && (\n//                     <div className=\"mt-2 flex items-center text-sm text-green-600\">\n//                       <FileText className=\"h-4 w-4 mr-2\" />\n//                       {candidate.resume.name}\n//                     </div>\n//                   )}\n//                 </div>\n                \n//                 <Button\n//                   type=\"submit\"\n//                   variant=\"primary\"\n//                   size=\"lg\"\n//                   className=\"w-full\"\n//                   loading={submitting}\n//                 >\n//                   Register for Interview\n//                 </Button>\n//               </form>\n//             </CardBody>\n//           </Card>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'ready') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\">\n//         <div className=\"max-w-2xl mx-auto px-4\">\n//           <Card className=\"shadow-xl\">\n//             <CardHeader className=\"text-center\">\n//               <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n//               <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Ready to Start!</h1>\n//               <p className=\"text-gray-600\">You're all set to begin the interview. Make sure you have a quiet environment and good internet connection.</p>\n//             </CardHeader>\n//             <CardBody className=\"text-center\">\n//               <div className=\"space-y-4 mb-6\">\n//                 <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n//                   <Camera className=\"h-5 w-5\" />\n//                   <span>Camera will be used for video recording</span>\n//                 </div>\n//                 <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n//                   <Mic className=\"h-5 w-5\" />\n//                   <span>Microphone will be used for audio recording</span>\n//                 </div>\n//                 <div className=\"flex items-center justify-center space-x-2 text-gray-600\">\n//                   <Clock className=\"h-5 w-5\" />\n//                   <span>Interview duration: {interview?.duration_minutes || 30} minutes</span>\n//                 </div>\n//               </div>\n              \n//               <Button\n//                 onClick={startInterview}\n//                 variant=\"primary\"\n//                 size=\"lg\"\n//                 className=\"w-full\"\n//                 loading={submitting}\n//               >\n//                 Start Interview\n//               </Button>\n//             </CardBody>\n//           </Card>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'interview') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100\">\n//         <div className=\"container mx-auto px-4 py-8\">\n//           <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n//             {/* AI Avatar */}\n//             <div className=\"space-y-4\">\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">AI Interviewer</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <div id=\"avatar-container\" className=\"h-64 bg-gray-100 rounded-lg flex items-center justify-center\">\n//                     <div className=\"text-gray-500\">AI Avatar Loading...</div>\n//                   </div>\n//                 </CardBody>\n//               </Card>\n              \n//               {/* Current Question */}\n//               {interview?.questions && interview.questions[currentQuestionIndex] && (\n//                 <Card>\n//                   <CardHeader>\n//                     <h3 className=\"text-lg font-semibold\">Current Question</h3>\n//                   </CardHeader>\n//                   <CardBody>\n//                     <p className=\"text-gray-700\">\n//                       {interview.questions[currentQuestionIndex].text}\n//                     </p>\n//                     <div className=\"mt-4 flex flex-wrap gap-2\">\n//                       {interview.questions[currentQuestionIndex].tags?.map((tag, index) => (\n//                         <span key={index} className=\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full\">\n//                           {tag}\n//                         </span>\n//                       ))}\n//                     </div>\n//                   </CardBody>\n//                 </Card>\n//               )}\n//             </div>\n            \n//             {/* Candidate Video and Controls */}\n//             <div className=\"space-y-4\">\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">Your Video</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <video\n//                     ref={videoRef}\n//                     autoPlay\n//                     muted\n//                     className=\"w-full h-48 bg-gray-900 rounded-lg\"\n//                   />\n//                 </CardBody>\n//               </Card>\n              \n//               {/* Recording Controls */}\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">Record Your Response</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <div className=\"space-y-4\">\n//                     <div className=\"flex justify-center space-x-4\">\n//                       <Button\n//                         onClick={isRecording ? stopRecording : startRecording}\n//                         variant={isRecording ? \"danger\" : \"primary\"}\n//                         size=\"lg\"\n//                       >\n//                         {isRecording ? (\n//                           <>\n//                             <MicOff className=\"h-5 w-5 mr-2\" />\n//                             Stop Recording\n//                           </>\n//                         ) : (\n//                           <>\n//                             <Mic className=\"h-5 w-5 mr-2\" />\n//                             Start Recording\n//                           </>\n//                         )}\n//                       </Button>\n//                     </div>\n                    \n//                     {response && (\n//                       <div className=\"text-center\">\n//                         <p className=\"text-sm text-gray-600 mb-2\">Response recorded</p>\n//                         <Button\n//                           onClick={submitResponse}\n//                           variant=\"success\"\n//                           loading={submitting}\n//                         >\n//                           Submit Response\n//                         </Button>\n//                       </div>\n//                     )}\n//                   </div>\n//                 </CardBody>\n//               </Card>\n              \n//               {/* Progress */}\n//               <Card>\n//                 <CardHeader>\n//                   <h3 className=\"text-lg font-semibold\">Progress</h3>\n//                 </CardHeader>\n//                 <CardBody>\n//                   <div className=\"space-y-2\">\n//                     <div className=\"flex justify-between text-sm\">\n//                       <span>Question {currentQuestionIndex + 1} of {interview?.questions?.length || 0}</span>\n//                       <span>{Math.round(((currentQuestionIndex + 1) / (interview?.questions?.length || 1)) * 100)}%</span>\n//                     </div>\n//                     <div className=\"w-full bg-gray-200 rounded-full h-2\">\n//                       <div\n//                         className=\"bg-blue-600 h-2 rounded-full transition-all duration-300\"\n//                         style={{ width: `${((currentQuestionIndex + 1) / (interview?.questions?.length || 1)) * 100}%` }}\n//                       />\n//                     </div>\n//                   </div>\n//                 </CardBody>\n//               </Card>\n//             </div>\n//           </div>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   if (step === 'complete') {\n//     return (\n//       <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12\">\n//         <div className=\"max-w-2xl mx-auto px-4\">\n//           <Card className=\"shadow-xl\">\n//             <CardHeader className=\"text-center\">\n//               <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n//               <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Interview Completed!</h1>\n//               <p className=\"text-gray-600\">Thank you for completing the interview. Your responses have been recorded and will be reviewed.</p>\n//             </CardHeader>\n//             <CardBody className=\"text-center\">\n//               <div className=\"space-y-4\">\n//                 <p className=\"text-gray-700\">\n//                   We'll be in touch soon with the results. Thank you for your time and interest!\n//                 </p>\n//                 <Button onClick={() => navigate('/')} variant=\"primary\">\n//                   Return Home\n//                 </Button>\n//               </div>\n//             </CardBody>\n//           </Card>\n//         </div>\n//       </div>\n//     );\n//   }\n\n//   return null;\n// };\n\n// export default PublicInterview;\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Card, CardHeader, CardBody } from '../components/ui/Card';\nimport Button from '../components/ui/Button';\nimport Input from '../components/ui/Input';\nimport { useToast } from '../contexts/ToastContext';\nimport { interviewService } from '../services/interviewService';\nimport { avatarService } from '../services/avatarService';\nimport { safeApiCall, safeApiCallWithValidation } from '../utils/errorHandler';\nimport { aiService } from '../services/aiService';\nimport { \n  Mic, \n  MicOff, \n  CheckCircle,\n  Clock,\n  AlertCircle,\n  Upload,\n  FileText,\n  Camera\n} from 'lucide-react';\n\nconst PublicInterview = () => {\n  const { interviewId } = useParams();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n\n  const [step, setStep] = useState('loading'); // loading, register, interview, complete\n  const [interview, setInterview] = useState(null);\n  const [candidate, setCandidate] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    resume: null\n  });\n  const [sessionId, setSessionId] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [isRecording, setIsRecording] = useState(false);\n  const [response, setResponse] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const [avatarElement, setAvatarElement] = useState(null);\n  const [mediaStream, setMediaStream] = useState(null);\n  const [permissionsGranted, setPermissionsGranted] = useState(false);\n\n  const videoRef = useRef(null);\n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n\n  const loadInterview = useCallback(async () => {\n    setLoading(true);\n    try {\n      const result = await safeApiCallWithValidation(\n        () => interviewService.getPublicInterview(interviewId),\n        ['id', 'job_role', 'questions'],\n        'Failed to load interview. Please check the link.'\n      );\n      if (result && result.success && result.data) {\n        setInterview(result.data);\n        setStep('register');\n      } else {\n        toast.error(result?.error || 'Failed to load interview. Please check the link.');\n        setStep('error');\n      }\n    } catch (err) {\n      console.error('Error loading interview:', err);\n      toast.error('Failed to load interview. Please try again.');\n      setStep('error');\n    } finally {\n      setLoading(false);\n    }\n  }, [interviewId, toast]);\n\n  const initializeAvatar = useCallback(() => {\n    if (avatarElement) return;\n    const container = document.getElementById('avatar-container');\n    if (container) {\n      const avatar = avatarService.createAvatarVisuals();\n      container.appendChild(avatar);\n      setAvatarElement(avatar);\n    }\n  }, [avatarElement]);\n\n  useEffect(() => {\n    loadInterview();\n  }, [loadInterview]);\n\n  useEffect(() => {\n    if (interview && step === 'interview') {\n      initializeAvatar();\n    }\n  }, [interview, step, initializeAvatar]);\n\n  const handleCandidateChange = (field, value) => {\n    setCandidate(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleResumeChange = e => {\n    const file = e.target.files[0];\n    if (file && ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'].includes(file.type)) {\n      setCandidate(prev => ({ ...prev, resume: file }));\n    } else {\n      toast.error('Please upload a PDF or Word document.');\n    }\n  };\n\n  const handleRegistration = async e => {\n    e.preventDefault();\n    setSubmitting(true);\n    try {\n      const formData = new FormData();\n      formData.append('name', candidate.name);\n      formData.append('email', candidate.email);\n      formData.append('phone', candidate.phone);\n      if (candidate.resume) formData.append('resume_file', candidate.resume);\n\n      const result = await safeApiCallWithValidation(\n        () => interviewService.registerCandidate(interviewId, formData),\n        ['id', 'session_id', 'candidate.id'],\n        'Registration failed. Please try again.'\n      );\n      if (result && result.success && result.data && result.data.candidate && result.data.session_id) {\n        setCandidate(prev => ({ ...prev, id: result.data.candidate.id }));\n        setSessionId(result.data.session_id);\n        toast.success('Registration successful.');\n        setStep('ready');\n      } else {\n        toast.error(result?.error || 'Registration failed.');\n      }\n    } catch (err) {\n      console.error('Registration error:', err);\n      toast.error('Unexpected error during registration.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const requestPermissions = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });\n      setMediaStream(stream);\n      setPermissionsGranted(true);\n      if (videoRef.current) videoRef.current.srcObject = stream;\n      return true;\n    } catch (err) {\n      console.error('Permission error:', err);\n      setPermissionsGranted(false);\n      return false;\n    }\n  };\n\n  const startInterview = async () => {\n    setSubmitting(true);\n    if (!(await requestPermissions())) {\n      toast.error('Camera and microphone permissions required.');\n      setSubmitting(false);\n      return;\n    }\n    try {\n      const result = await safeApiCall(() => interviewService.startInterviewSession(sessionId), 'Failed to start interview.');\n      if (result && result.success) {\n        setStep('interview');\n      } else {\n        toast.error(result?.error || 'Failed to start interview.');\n      }\n    } catch (err) {\n      console.error('Start interview error:', err);\n      toast.error('Error starting interview.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const askQuestion = async text => {\n    if (!avatarElement) return;\n    try {\n      const audioBlob = await aiService.generateTTS(text);\n      const audioUrl = URL.createObjectURL(audioBlob);\n      const audio = new Audio(audioUrl);\n      avatarService.startLipSyncAnimation(avatarElement, audio);\n      audio.onended = () => URL.revokeObjectURL(audioUrl);\n      audio.play();\n    } catch (err) {\n      console.error('Ask question error:', err);\n    }\n  };\n\n  const startRecording = () => {\n    if (!mediaStream) return;\n    try {\n      mediaRecorderRef.current = new MediaRecorder(mediaStream);\n      audioChunksRef.current = [];\n      mediaRecorderRef.current.ondataavailable = e => audioChunksRef.current.push(e.data);\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n        setResponse(audioBlob);\n      };\n      mediaRecorderRef.current.start();\n      setIsRecording(true);\n    } catch (err) {\n      console.error('Start recording error:', err);\n      toast.error('Failed to start recording.');\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const submitResponse = async () => {\n    if (!response) return;\n    setSubmitting(true);\n    try {\n      const formData = new FormData();\n      formData.append('question_number', currentQuestionIndex);\n      formData.append('response_text', typeof response === 'string' ? response : '');\n      if (response instanceof Blob) formData.append('audio_file', response);\n\n      const result = await safeApiCall(() => interviewService.submitResponse(sessionId, formData), 'Failed to submit response.');\n      if (result && result.success) {\n        const next = currentQuestionIndex + 1;\n        if (next < (interview?.questions?.length || 0)) {\n          setCurrentQuestionIndex(next);\n          setResponse('');\n          setTimeout(() => askQuestion(interview.questions[next]), 1000);\n        } else {\n          await completeInterview();\n        }\n      } else {\n        toast.error(result?.error || 'Submission failed.');\n      }\n    } catch (err) {\n      console.error('Submit response error:', err);\n      toast.error('Unexpected error submitting response.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const completeInterview = async () => {\n    setSubmitting(true);\n    try {\n      const result = await safeApiCall(() => interviewService.completeSession(sessionId), 'Failed to finish interview.');\n      if (result && result.success) {\n        setStep('complete');\n      } else {\n        toast.error(result?.error || 'Completion failed.');\n      }\n    } catch (err) {\n      console.error('Complete interview error:', err);\n      toast.error('Error completing interview.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"loading-container\">\n        Loading interview...\n      </div>\n    );\n  }\n\n  if (step === 'error') {\n    return (\n      <div className=\"error-container\">\n        <p>The interview link is invalid or expired.</p>\n        <Button onClick={() => navigate('/')}>Go Home</Button>\n      </div>\n    );\n  }\n\n  if (step === 'register') {\n    return (\n      <div className=\"register-container\">\n        <Card>\n          <CardHeader>Interview Registration</CardHeader>\n          <CardBody>\n            <form onSubmit={handleRegistration}>\n              <Input label=\"Full Name\" value={candidate.name} onChange={e => handleCandidateChange('name', e.target.value)} required />\n              <Input label=\"Email\" type=\"email\" value={candidate.email} onChange={e => handleCandidateChange('email', e.target.value)} required />\n              <Input label=\"Phone\" value={candidate.phone} onChange={e => handleCandidateChange('phone', e.target.value)} required />\n              <Input label=\"Resume (Optional)\" type=\"file\" onChange={handleResumeChange} />\n              <Button type=\"submit\" disabled={submitting}>{submitting ? 'Registering...' : 'Register'}</Button>\n            </form>\n          </CardBody>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'ready') {\n    return (\n      <div className=\"ready-container\">\n        <Card>\n          <CardHeader>Youre all set to begin!</CardHeader>\n          <CardBody>\n            <Button onClick={startInterview} disabled={submitting}>{submitting ? 'Starting...' : 'Start Interview'}</Button>\n          </CardBody>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'interview') {\n    return (\n      <div className=\"interview-container\">\n        <Card>\n          <CardHeader>\n            <div>AI Interviewer</div>\n          </CardHeader>\n          <CardBody>\n            <div id=\"avatar-container\"></div>\n            <h3>Question {currentQuestionIndex + 1} of {interview?.questions.length}</h3>\n            <p>{interview.questions[currentQuestionIndex]?.text}</p>\n            <div>\n              <video ref={videoRef} autoPlay muted playsInline style={{ display: 'none' }} />\n              <Button onClick={isRecording ? stopRecording : startRecording} disabled={submitting}>\n                {isRecording ? <MicOff /> : <Mic />} {isRecording ? 'Stop Recording' : 'Start Recording'}\n              </Button>\n              <Button onClick={submitResponse} disabled={!response || submitting}>\n                <CheckCircle /> Submit Response\n              </Button>\n            </div>\n            <div>\n              <small>{`Progress: ${Math.round(((currentQuestionIndex + 1) / interview.questions.length) * 100)}%`}</small>\n            </div>\n          </CardBody>\n        </Card>\n      </div>\n    );\n  }\n\n  if (step === 'complete') {\n    return (\n      <div className=\"complete-container\">\n        <Card>\n          <CardHeader>Interview Completed</CardHeader>\n          <CardBody>\n            <p>Thank you for completing the interview. Your responses have been recorded.</p>\n            <Button onClick={() => navigate('/')}>Return Home</Button>\n          </CardBody>\n        </Card>\n      </div>\n    );\n  }\n\n  return null;\n};\n\nexport default PublicInterview;\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAC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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}