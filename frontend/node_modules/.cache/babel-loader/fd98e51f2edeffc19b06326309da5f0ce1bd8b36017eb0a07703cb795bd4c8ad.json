{"ast":null,"code":"/**\r\n * Utility functions for consistent error handling across the application\r\n */\n\n/**\r\n * Safely extracts error message from various error response formats\r\n * @param {Error} error - The error object from try/catch\r\n * @param {string} fallbackMessage - Default message if no error details found\r\n * @returns {string} - Safe error message to display to user\r\n */\n/**\r\n * Utility functions for consistent error handling across the application\r\n */\n\n// Extract error message safely\nexport const getErrorMessage = (error, fallbackMessage = 'An unexpected error occurred') => {\n  var _error$response;\n  if (!error) return fallbackMessage;\n  if ((_error$response = error.response) !== null && _error$response !== void 0 && _error$response.data) {\n    const data = error.response.data;\n    if (data.detail) return data.detail;\n    if (data.error) return data.error;\n    if (data.errors && Array.isArray(data.errors)) {\n      return data.errors.join(', ');\n    }\n    if (data.message) return data.message;\n  }\n  if (error.message) return error.message;\n  if (error.error) return error.error;\n  return fallbackMessage;\n};\n\n// Validate required fields inside response\nexport const validateResponse = (response, requiredFields = []) => {\n  if (!response || typeof response !== 'object') return false;\n  return requiredFields.every(field => {\n    const fieldPath = field.split('.');\n    let current = response;\n    for (const key of fieldPath) {\n      if (current && typeof current === 'object' && key in current) {\n        current = current[key];\n      } else {\n        return false;\n      }\n    }\n    return current !== null && current !== undefined;\n  });\n};\n\n// Handle raw responses safely\nexport const safeResponseHandler = (response, requiredFields = [], errorMessage = 'Invalid response from server') => {\n  if (validateResponse(response, requiredFields)) {\n    return {\n      success: true,\n      data: response,\n      error: null\n    };\n  } else {\n    console.error('Response validation failed:', response);\n    return {\n      success: false,\n      data: null,\n      error: errorMessage\n    };\n  }\n};\n\n// API call wrapper without validation\nexport const safeApiCall = async (apiCall, fallbackMessage = 'API call failed') => {\n  try {\n    const response = await apiCall();\n    if (response && response.data) {\n      const {\n        success,\n        data,\n        message,\n        error\n      } = response.data;\n      if (success === true) {\n        return {\n          success: true,\n          data,\n          error: null\n        };\n      } else {\n        return {\n          success: false,\n          data: null,\n          error: error || message || fallbackMessage\n        };\n      }\n    }\n    return {\n      success: true,\n      data: response,\n      error: null\n    };\n  } catch (error) {\n    const errorMessage = getErrorMessage(error, fallbackMessage);\n    console.error('API call failed:', error);\n    return {\n      success: false,\n      data: null,\n      error: errorMessage\n    };\n  }\n};\n\n// API call wrapper WITH validation\n// errorHandler.js\nexport const safeApiCallWithValidation = async (apiCall, requiredFields = [], fallbackMessage = 'Request failed') => {\n  try {\n    const response = await apiCall();\n\n    // If API didn't return data at all\n    if (!response || !response.data) {\n      return {\n        success: false,\n        error: 'No response from server'\n      };\n    }\n    const validation = validateResponse(response, requiredFields);\n    if (!validation.success) {\n      return {\n        success: false,\n        error: validation.error\n      };\n    }\n    return {\n      success: true,\n      data: response.data,\n      error: null // ✅ always defined\n    };\n  } catch (err) {\n    return {\n      success: false,\n      data: null,\n      // ✅ always defined\n      error: extractErrorMessage(err, fallbackMessage) // ✅ always defined\n    };\n  }\n};","map":{"version":3,"names":["getErrorMessage","error","fallbackMessage","_error$response","response","data","detail","errors","Array","isArray","join","message","validateResponse","requiredFields","every","field","fieldPath","split","current","key","undefined","safeResponseHandler","errorMessage","success","console","safeApiCall","apiCall","safeApiCallWithValidation","validation","err","extractErrorMessage"],"sources":["D:/ai_avatar/frontend/src/utils/errorHandler.js"],"sourcesContent":["/**\r\n * Utility functions for consistent error handling across the application\r\n */\r\n\r\n/**\r\n * Safely extracts error message from various error response formats\r\n * @param {Error} error - The error object from try/catch\r\n * @param {string} fallbackMessage - Default message if no error details found\r\n * @returns {string} - Safe error message to display to user\r\n */\r\n/**\r\n * Utility functions for consistent error handling across the application\r\n */\r\n\r\n// Extract error message safely\r\nexport const getErrorMessage = (error, fallbackMessage = 'An unexpected error occurred') => {\r\n  if (!error) return fallbackMessage;\r\n\r\n  if (error.response?.data) {\r\n    const data = error.response.data;\r\n    if (data.detail) return data.detail;\r\n    if (data.error) return data.error;\r\n    if (data.errors && Array.isArray(data.errors)) {\r\n      return data.errors.join(', ');\r\n    }\r\n    if (data.message) return data.message;\r\n  }\r\n\r\n  if (error.message) return error.message;\r\n  if (error.error) return error.error;\r\n\r\n  return fallbackMessage;\r\n};\r\n\r\n// Validate required fields inside response\r\nexport const validateResponse = (response, requiredFields = []) => {\r\n  if (!response || typeof response !== 'object') return false;\r\n\r\n  return requiredFields.every(field => {\r\n    const fieldPath = field.split('.');\r\n    let current = response;\r\n\r\n    for (const key of fieldPath) {\r\n      if (current && typeof current === 'object' && key in current) {\r\n        current = current[key];\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    return current !== null && current !== undefined;\r\n  });\r\n};\r\n\r\n// Handle raw responses safely\r\nexport const safeResponseHandler = (response, requiredFields = [], errorMessage = 'Invalid response from server') => {\r\n  if (validateResponse(response, requiredFields)) {\r\n    return { success: true, data: response, error: null };\r\n  } else {\r\n    console.error('Response validation failed:', response);\r\n    return { success: false, data: null, error: errorMessage };\r\n  }\r\n};\r\n\r\n// API call wrapper without validation\r\nexport const safeApiCall = async (apiCall, fallbackMessage = 'API call failed') => {\r\n  try {\r\n    const response = await apiCall();\r\n\r\n    if (response && response.data) {\r\n      const { success, data, message, error } = response.data;\r\n\r\n      if (success === true) {\r\n        return { success: true, data, error: null };\r\n      } else {\r\n        return { success: false, data: null, error: error || message || fallbackMessage };\r\n      }\r\n    }\r\n\r\n    return { success: true, data: response, error: null };\r\n  } catch (error) {\r\n    const errorMessage = getErrorMessage(error, fallbackMessage);\r\n    console.error('API call failed:', error);\r\n    return { success: false, data: null, error: errorMessage };\r\n  }\r\n};\r\n\r\n// API call wrapper WITH validation\r\n// errorHandler.js\r\nexport const safeApiCallWithValidation = async (apiCall, requiredFields = [], fallbackMessage = 'Request failed') => {\r\n  try {\r\n    const response = await apiCall();\r\n\r\n    // If API didn't return data at all\r\n    if (!response || !response.data) {\r\n      return { success: false, error: 'No response from server' };\r\n    }\r\n\r\n    const validation = validateResponse(response, requiredFields);\r\n    if (!validation.success) {\r\n      return { success: false, error: validation.error };\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      data: response.data,\r\n      error: null,   // ✅ always defined\r\n    };\r\n  } catch (err) {\r\n    return {\r\n      success: false,\r\n      data: null,    // ✅ always defined\r\n      error: extractErrorMessage(err, fallbackMessage), // ✅ always defined\r\n    };\r\n  }\r\n};\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}