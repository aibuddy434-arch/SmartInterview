{"ast":null,"code":"/**\r\n * Avatar Service for managing AI interviewer avatar\r\n */\nexport class AvatarService {\n  constructor() {\n    this.avatarElement = null;\n    this.isAnimating = false;\n    this.currentAudio = null;\n    this.audioContext = null;\n    this.analyser = null;\n    this.dataArray = null;\n    this.animationFrame = null;\n  }\n\n  /**\r\n   * Initialize avatar with DOM element\r\n   * @param {HTMLElement} avatarElement - Avatar DOM element\r\n   */\n  initialize(avatarElement) {\n    this.avatarElement = avatarElement;\n    this.setupAudioContext();\n    this.createAvatarVisuals();\n  }\n\n  /**\r\n   * Setup Web Audio API context for real-time audio analysis\r\n   */\n  setupAudioContext() {\n    try {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 256;\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n    } catch (error) {\n      console.warn('Web Audio API not supported, using fallback animation');\n    }\n  }\n\n  /**\r\n   * Create avatar visual elements\r\n   */\n  createAvatarVisuals() {\n    if (!this.avatarElement) return;\n\n    // Create talking head elements with more detailed structure\n    this.avatarElement.innerHTML = `\n      <div class=\"avatar-container\">\n        <div class=\"avatar-head\">\n          <div class=\"avatar-face\">\n            <div class=\"avatar-eyes\">\n              <div class=\"avatar-eye left\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n              <div class=\"avatar-eye right\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-nose\"></div>\n            <div class=\"avatar-mouth\">\n              <div class=\"avatar-lips\">\n                <div class=\"upper-lip\"></div>\n                <div class=\"lower-lip\"></div>\n                <div class=\"mouth-opening\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-cheeks\">\n              <div class=\"cheek left\"></div>\n              <div class=\"cheek right\"></div>\n            </div>\n          </div>\n          <div class=\"avatar-hair\"></div>\n        </div>\n        <div class=\"avatar-body\">\n          <div class=\"avatar-torso\"></div>\n          <div class=\"avatar-arms\">\n            <div class=\"arm left\"></div>\n            <div class=\"arm right\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add CSS classes for styling\n    this.avatarElement.classList.add('avatar-interviewer');\n\n    // Add the CSS styles\n    this.addAvatarStyles();\n  }\n\n  /**\r\n   * Add CSS styles for the avatar\r\n   */\n  addAvatarStyles() {\n    if (document.getElementById('avatar-styles')) return;\n    const style = document.createElement('style');\n    style.id = 'avatar-styles';\n    style.textContent = `\n      .avatar-interviewer {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        border-radius: 20px;\n        overflow: hidden;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n      }\n\n      .avatar-container {\n        position: relative;\n        width: 200px;\n        height: 250px;\n        transform-style: preserve-3d;\n        animation: float 3s ease-in-out infinite;\n      }\n\n      @keyframes float {\n        0%, 100% { transform: translateY(0px); }\n        50% { transform: translateY(-10px); }\n      }\n\n      .avatar-head {\n        position: relative;\n        width: 120px;\n        height: 120px;\n        background: #fdbcb4;\n        border-radius: 50%;\n        margin: 0 auto 20px;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n        transform-style: preserve-3d;\n      }\n\n      .avatar-face {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n        overflow: hidden;\n      }\n\n      .avatar-eyes {\n        position: absolute;\n        top: 30px;\n        left: 50%;\n        transform: translateX(-50%);\n        display: flex;\n        gap: 20px;\n      }\n\n      .avatar-eye {\n        position: relative;\n        width: 20px;\n        height: 20px;\n        background: white;\n        border-radius: 50%;\n        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\n      }\n\n      .pupil {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 12px;\n        height: 12px;\n        background: #333;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .eyelid {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 50%;\n        background: #fdbcb4;\n        border-radius: 50% 50% 0 0;\n        transition: transform 0.1s ease;\n      }\n\n      .avatar-nose {\n        position: absolute;\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 8px;\n        height: 12px;\n        background: #f4a5a5;\n        border-radius: 50%;\n      }\n\n      .avatar-mouth {\n        position: absolute;\n        top: 70px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 40px;\n        height: 20px;\n      }\n\n      .avatar-lips {\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      .upper-lip, .lower-lip {\n        position: absolute;\n        width: 100%;\n        height: 50%;\n        background: #d63384;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .upper-lip {\n        top: 0;\n        border-radius: 50% 50% 0 0;\n      }\n\n      .lower-lip {\n        bottom: 0;\n        border-radius: 0 0 50% 50%;\n      }\n\n      .mouth-opening {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 20px;\n        height: 8px;\n        background: #000;\n        border-radius: 50%;\n        opacity: 0;\n        transition: all 0.1s ease;\n      }\n\n      .avatar-cheeks {\n        position: absolute;\n        top: 50px;\n        left: 0;\n        right: 0;\n        height: 30px;\n      }\n\n      .cheek {\n        position: absolute;\n        top: 0;\n        width: 20px;\n        height: 20px;\n        background: #ffb3ba;\n        border-radius: 50%;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n      }\n\n      .cheek.left {\n        left: 10px;\n      }\n\n      .cheek.right {\n        right: 10px;\n      }\n\n      .avatar-hair {\n        position: absolute;\n        top: -10px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 100px;\n        height: 40px;\n        background: #8b4513;\n        border-radius: 50% 50% 0 0;\n        z-index: -1;\n      }\n\n      .avatar-body {\n        position: relative;\n        width: 80px;\n        height: 100px;\n        background: #4a90e2;\n        border-radius: 20px;\n        margin: 0 auto;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n      }\n\n      .avatar-torso {\n        width: 100%;\n        height: 60px;\n        background: #4a90e2;\n        border-radius: 20px 20px 10px 10px;\n      }\n\n      .avatar-arms {\n        position: absolute;\n        top: 10px;\n        left: 0;\n        right: 0;\n        height: 40px;\n      }\n\n      .arm {\n        position: absolute;\n        width: 15px;\n        height: 40px;\n        background: #fdbcb4;\n        border-radius: 10px;\n      }\n\n      .arm.left {\n        left: -10px;\n        top: 10px;\n        transform: rotate(-20deg);\n      }\n\n      .arm.right {\n        right: -10px;\n        top: 10px;\n        transform: rotate(20deg);\n      }\n\n      /* Expression styles */\n      .expression-happy .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.8);\n      }\n\n      .expression-happy .avatar-lips {\n        transform: scaleY(1.2);\n      }\n\n      .expression-happy .cheek {\n        opacity: 1;\n      }\n\n      .expression-serious .avatar-eyes {\n        transform: translateX(-50%) scaleY(1.2);\n      }\n\n      .expression-serious .avatar-lips {\n        transform: scaleY(0.8);\n      }\n\n      .expression-thinking .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.6);\n      }\n\n      .expression-thinking .avatar-lips {\n        transform: scaleY(0.9);\n      }\n\n      /* Speaking animation */\n      .speaking .mouth-opening {\n        opacity: 1;\n        animation: mouth-move 0.1s ease-in-out infinite alternate;\n      }\n\n      @keyframes mouth-move {\n        0% { transform: translate(-50%, -50%) scaleY(1); }\n        100% { transform: translate(-50%, -50%) scaleY(1.5); }\n      }\n\n      /* Blinking animation */\n      .avatar-eye .eyelid {\n        animation: blink 4s infinite;\n      }\n\n      @keyframes blink {\n        0%, 90%, 100% { transform: scaleY(1); }\n        95% { transform: scaleY(0.1); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\r\n   * Start speaking animation with audio\r\n   * @param {Blob} audioBlob - Audio blob to play\r\n   * @param {string} text - Text being spoken (for fallback)\r\n   */\n  async startSpeaking(audioBlob, text = '') {\n    if (this.isAnimating) {\n      await this.stopSpeaking();\n    }\n    this.isAnimating = true;\n\n    // Add speaking class for CSS animations\n    if (this.avatarElement) {\n      this.avatarElement.classList.add('speaking');\n    }\n    try {\n      if (this.audioContext && audioBlob) {\n        await this.playAudioWithLipSync(audioBlob);\n      } else {\n        // Fallback: animate based on text length\n        this.animateWithText(text);\n      }\n    } catch (error) {\n      console.error('Failed to start speaking animation:', error);\n      // Fallback animation\n      this.animateWithText(text);\n    }\n  }\n\n  /**\r\n   * Play audio with real-time lip sync\r\n   * @param {Blob} audioBlob - Audio to play\r\n   */\n  async playAudioWithLipSync(audioBlob) {\n    try {\n      const arrayBuffer = await audioBlob.arrayBuffer();\n      const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n      const source = this.audioContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(this.analyser);\n      this.analyser.connect(this.audioContext.destination);\n      this.currentAudio = source;\n\n      // Start lip sync animation\n      this.startLipSyncAnimation();\n\n      // Play audio\n      source.start(0);\n\n      // Stop animation when audio ends\n      source.onended = () => {\n        this.stopSpeaking();\n      };\n    } catch (error) {\n      console.error('Audio playback failed:', error);\n      throw error;\n    }\n  }\n\n  /**\r\n   * Start lip sync animation based on audio frequency\r\n   */\n  startLipSyncAnimation() {\n    const animate = () => {\n      if (!this.isAnimating) return;\n      this.analyser.getByteFrequencyData(this.dataArray);\n\n      // Calculate more sophisticated audio analysis\n      const average = this.dataArray.reduce((a, b) => a + b) / this.dataArray.length;\n      const max = Math.max(...this.dataArray);\n      const min = Math.min(...this.dataArray);\n\n      // Normalize to 0-1 with better scaling\n      const normalized = Math.min(1, (average + (max - min) * 0.3) / 255);\n\n      // Apply mouth animation with more realistic movement\n      this.animateMouth(normalized);\n      this.animationFrame = requestAnimationFrame(animate);\n    };\n    animate();\n  }\n\n  /**\r\n   * Animate mouth based on audio intensity\r\n   * @param {number} intensity - Audio intensity (0-1)\r\n   */\n  animateMouth(intensity) {\n    var _this$avatarElement, _this$avatarElement2;\n    const lips = (_this$avatarElement = this.avatarElement) === null || _this$avatarElement === void 0 ? void 0 : _this$avatarElement.querySelector('.avatar-lips');\n    const mouthOpening = (_this$avatarElement2 = this.avatarElement) === null || _this$avatarElement2 === void 0 ? void 0 : _this$avatarElement2.querySelector('.mouth-opening');\n    if (!lips || !mouthOpening) return;\n\n    // More realistic mouth movement\n    const scale = 1 + intensity * 0.8;\n    const mouthScale = 0.5 + intensity * 1.5;\n\n    // Animate lips\n    lips.style.transform = `scaleY(${scale})`;\n\n    // Animate mouth opening\n    mouthOpening.style.transform = `translate(-50%, -50%) scaleY(${mouthScale})`;\n    mouthOpening.style.opacity = Math.min(1, intensity * 2);\n\n    // Add some randomness for natural movement\n    const randomOffset = (Math.random() - 0.5) * 0.2;\n    lips.style.transform += ` translateY(${randomOffset}px)`;\n  }\n\n  /**\r\n   * Fallback animation based on text length\r\n   * @param {string} text - Text to animate for\r\n   */\n  animateWithText(text) {\n    const duration = Math.max(text.length * 100, 2000); // 100ms per character, min 2s\n\n    this.animateMouth(0.5); // Medium intensity\n\n    setTimeout(() => {\n      this.stopSpeaking();\n    }, duration);\n  }\n\n  /**\r\n   * Stop speaking animation\r\n   */\n  async stopSpeaking() {\n    var _this$avatarElement3;\n    this.isAnimating = false;\n\n    // Remove speaking class\n    if (this.avatarElement) {\n      this.avatarElement.classList.remove('speaking');\n    }\n    if (this.currentAudio) {\n      this.currentAudio.stop();\n      this.currentAudio = null;\n    }\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n    }\n\n    // Reset mouth to neutral position\n    const lips = (_this$avatarElement3 = this.avatarElement) === null || _this$avatarElement3 === void 0 ? void 0 : _this$avatarElement3.querySelector('.avatar-lips');\n    if (lips) {\n      lips.style.transform = 'scaleY(1) translateY(0px)';\n    }\n  }\n\n  /**\r\n   * Set avatar expression\r\n   * @param {string} expression - Expression type (happy, serious, thinking, etc.)\r\n   */\n  setExpression(expression) {\n    if (!this.avatarElement) return;\n\n    // Remove previous expression classes\n    this.avatarElement.classList.remove('expression-happy', 'expression-serious', 'expression-thinking');\n\n    // Add new expression class\n    this.avatarElement.classList.add(`expression-${expression}`);\n\n    // Update visual elements based on expression\n    this.updateExpressionVisuals(expression);\n  }\n\n  /**\r\n   * Update visual elements for expression\r\n   * @param {string} expression - Expression type\r\n   */\n  updateExpressionVisuals(expression) {\n    var _this$avatarElement4, _this$avatarElement5;\n    const eyes = (_this$avatarElement4 = this.avatarElement) === null || _this$avatarElement4 === void 0 ? void 0 : _this$avatarElement4.querySelector('.avatar-eyes');\n    const mouth = (_this$avatarElement5 = this.avatarElement) === null || _this$avatarElement5 === void 0 ? void 0 : _this$avatarElement5.querySelector('.avatar-mouth');\n    if (!eyes || !mouth) return;\n    switch (expression) {\n      case 'happy':\n        eyes.style.transform = 'scaleY(0.8)';\n        mouth.style.transform = 'scaleY(1.2)';\n        break;\n      case 'serious':\n        eyes.style.transform = 'scaleY(1.2)';\n        mouth.style.transform = 'scaleY(0.8)';\n        break;\n      case 'thinking':\n        eyes.style.transform = 'scaleY(0.6)';\n        mouth.style.transform = 'scaleY(0.9)';\n        break;\n      default:\n        eyes.style.transform = 'scaleY(1)';\n        mouth.style.transform = 'scaleY(1)';\n    }\n  }\n\n  /**\r\n   * Cleanup resources\r\n   */\n  destroy() {\n    this.stopSpeaking();\n    if (this.audioContext) {\n      this.audioContext.close();\n      this.audioContext = null;\n    }\n    this.avatarElement = null;\n  }\n}\n\n// Global instance\nexport const avatarService = new AvatarService();","map":{"version":3,"names":["AvatarService","constructor","avatarElement","isAnimating","currentAudio","audioContext","analyser","dataArray","animationFrame","initialize","setupAudioContext","createAvatarVisuals","window","AudioContext","webkitAudioContext","createAnalyser","fftSize","Uint8Array","frequencyBinCount","error","console","warn","innerHTML","classList","add","addAvatarStyles","document","getElementById","style","createElement","id","textContent","head","appendChild","startSpeaking","audioBlob","text","stopSpeaking","playAudioWithLipSync","animateWithText","arrayBuffer","audioBuffer","decodeAudioData","source","createBufferSource","buffer","connect","destination","startLipSyncAnimation","start","onended","animate","getByteFrequencyData","average","reduce","a","b","length","max","Math","min","normalized","animateMouth","requestAnimationFrame","intensity","_this$avatarElement","_this$avatarElement2","lips","querySelector","mouthOpening","scale","mouthScale","transform","opacity","randomOffset","random","duration","setTimeout","_this$avatarElement3","remove","stop","cancelAnimationFrame","setExpression","expression","updateExpressionVisuals","_this$avatarElement4","_this$avatarElement5","eyes","mouth","destroy","close","avatarService"],"sources":["D:/ai_avatar/frontend/src/services/avatarService.js"],"sourcesContent":["/**\r\n * Avatar Service for managing AI interviewer avatar\r\n */\r\nexport class AvatarService {\r\n  constructor() {\r\n    this.avatarElement = null;\r\n    this.isAnimating = false;\r\n    this.currentAudio = null;\r\n    this.audioContext = null;\r\n    this.analyser = null;\r\n    this.dataArray = null;\r\n    this.animationFrame = null;\r\n  }\r\n\r\n  /**\r\n   * Initialize avatar with DOM element\r\n   * @param {HTMLElement} avatarElement - Avatar DOM element\r\n   */\r\n  initialize(avatarElement) {\r\n    this.avatarElement = avatarElement;\r\n    this.setupAudioContext();\r\n    this.createAvatarVisuals();\r\n  }\r\n\r\n  /**\r\n   * Setup Web Audio API context for real-time audio analysis\r\n   */\r\n  setupAudioContext() {\r\n    try {\r\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n      this.analyser = this.audioContext.createAnalyser();\r\n      this.analyser.fftSize = 256;\r\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\r\n    } catch (error) {\r\n      console.warn('Web Audio API not supported, using fallback animation');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create avatar visual elements\r\n   */\r\n  createAvatarVisuals() {\r\n    if (!this.avatarElement) return;\r\n\r\n    // Create talking head elements with more detailed structure\r\n    this.avatarElement.innerHTML = `\r\n      <div class=\"avatar-container\">\r\n        <div class=\"avatar-head\">\r\n          <div class=\"avatar-face\">\r\n            <div class=\"avatar-eyes\">\r\n              <div class=\"avatar-eye left\">\r\n                <div class=\"pupil\"></div>\r\n                <div class=\"eyelid\"></div>\r\n              </div>\r\n              <div class=\"avatar-eye right\">\r\n                <div class=\"pupil\"></div>\r\n                <div class=\"eyelid\"></div>\r\n              </div>\r\n            </div>\r\n            <div class=\"avatar-nose\"></div>\r\n            <div class=\"avatar-mouth\">\r\n              <div class=\"avatar-lips\">\r\n                <div class=\"upper-lip\"></div>\r\n                <div class=\"lower-lip\"></div>\r\n                <div class=\"mouth-opening\"></div>\r\n              </div>\r\n            </div>\r\n            <div class=\"avatar-cheeks\">\r\n              <div class=\"cheek left\"></div>\r\n              <div class=\"cheek right\"></div>\r\n            </div>\r\n          </div>\r\n          <div class=\"avatar-hair\"></div>\r\n        </div>\r\n        <div class=\"avatar-body\">\r\n          <div class=\"avatar-torso\"></div>\r\n          <div class=\"avatar-arms\">\r\n            <div class=\"arm left\"></div>\r\n            <div class=\"arm right\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Add CSS classes for styling\r\n    this.avatarElement.classList.add('avatar-interviewer');\r\n    \r\n    // Add the CSS styles\r\n    this.addAvatarStyles();\r\n  }\r\n\r\n  /**\r\n   * Add CSS styles for the avatar\r\n   */\r\n  addAvatarStyles() {\r\n    if (document.getElementById('avatar-styles')) return;\r\n\r\n    const style = document.createElement('style');\r\n    style.id = 'avatar-styles';\r\n    style.textContent = `\r\n      .avatar-interviewer {\r\n        position: relative;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n        border-radius: 20px;\r\n        overflow: hidden;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        box-shadow: 0 10px 30px rgba(0,0,0,0.3);\r\n      }\r\n\r\n      .avatar-container {\r\n        position: relative;\r\n        width: 200px;\r\n        height: 250px;\r\n        transform-style: preserve-3d;\r\n        animation: float 3s ease-in-out infinite;\r\n      }\r\n\r\n      @keyframes float {\r\n        0%, 100% { transform: translateY(0px); }\r\n        50% { transform: translateY(-10px); }\r\n      }\r\n\r\n      .avatar-head {\r\n        position: relative;\r\n        width: 120px;\r\n        height: 120px;\r\n        background: #fdbcb4;\r\n        border-radius: 50%;\r\n        margin: 0 auto 20px;\r\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\r\n        transform-style: preserve-3d;\r\n      }\r\n\r\n      .avatar-face {\r\n        position: relative;\r\n        width: 100%;\r\n        height: 100%;\r\n        border-radius: 50%;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .avatar-eyes {\r\n        position: absolute;\r\n        top: 30px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        display: flex;\r\n        gap: 20px;\r\n      }\r\n\r\n      .avatar-eye {\r\n        position: relative;\r\n        width: 20px;\r\n        height: 20px;\r\n        background: white;\r\n        border-radius: 50%;\r\n        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\r\n      }\r\n\r\n      .pupil {\r\n        position: absolute;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        width: 12px;\r\n        height: 12px;\r\n        background: #333;\r\n        border-radius: 50%;\r\n        transition: all 0.1s ease;\r\n      }\r\n\r\n      .eyelid {\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 50%;\r\n        background: #fdbcb4;\r\n        border-radius: 50% 50% 0 0;\r\n        transition: transform 0.1s ease;\r\n      }\r\n\r\n      .avatar-nose {\r\n        position: absolute;\r\n        top: 50px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        width: 8px;\r\n        height: 12px;\r\n        background: #f4a5a5;\r\n        border-radius: 50%;\r\n      }\r\n\r\n      .avatar-mouth {\r\n        position: absolute;\r\n        top: 70px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        width: 40px;\r\n        height: 20px;\r\n      }\r\n\r\n      .avatar-lips {\r\n        position: relative;\r\n        width: 100%;\r\n        height: 100%;\r\n      }\r\n\r\n      .upper-lip, .lower-lip {\r\n        position: absolute;\r\n        width: 100%;\r\n        height: 50%;\r\n        background: #d63384;\r\n        border-radius: 50%;\r\n        transition: all 0.1s ease;\r\n      }\r\n\r\n      .upper-lip {\r\n        top: 0;\r\n        border-radius: 50% 50% 0 0;\r\n      }\r\n\r\n      .lower-lip {\r\n        bottom: 0;\r\n        border-radius: 0 0 50% 50%;\r\n      }\r\n\r\n      .mouth-opening {\r\n        position: absolute;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        width: 20px;\r\n        height: 8px;\r\n        background: #000;\r\n        border-radius: 50%;\r\n        opacity: 0;\r\n        transition: all 0.1s ease;\r\n      }\r\n\r\n      .avatar-cheeks {\r\n        position: absolute;\r\n        top: 50px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 30px;\r\n      }\r\n\r\n      .cheek {\r\n        position: absolute;\r\n        top: 0;\r\n        width: 20px;\r\n        height: 20px;\r\n        background: #ffb3ba;\r\n        border-radius: 50%;\r\n        opacity: 0;\r\n        transition: opacity 0.3s ease;\r\n      }\r\n\r\n      .cheek.left {\r\n        left: 10px;\r\n      }\r\n\r\n      .cheek.right {\r\n        right: 10px;\r\n      }\r\n\r\n      .avatar-hair {\r\n        position: absolute;\r\n        top: -10px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        width: 100px;\r\n        height: 40px;\r\n        background: #8b4513;\r\n        border-radius: 50% 50% 0 0;\r\n        z-index: -1;\r\n      }\r\n\r\n      .avatar-body {\r\n        position: relative;\r\n        width: 80px;\r\n        height: 100px;\r\n        background: #4a90e2;\r\n        border-radius: 20px;\r\n        margin: 0 auto;\r\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\r\n      }\r\n\r\n      .avatar-torso {\r\n        width: 100%;\r\n        height: 60px;\r\n        background: #4a90e2;\r\n        border-radius: 20px 20px 10px 10px;\r\n      }\r\n\r\n      .avatar-arms {\r\n        position: absolute;\r\n        top: 10px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 40px;\r\n      }\r\n\r\n      .arm {\r\n        position: absolute;\r\n        width: 15px;\r\n        height: 40px;\r\n        background: #fdbcb4;\r\n        border-radius: 10px;\r\n      }\r\n\r\n      .arm.left {\r\n        left: -10px;\r\n        top: 10px;\r\n        transform: rotate(-20deg);\r\n      }\r\n\r\n      .arm.right {\r\n        right: -10px;\r\n        top: 10px;\r\n        transform: rotate(20deg);\r\n      }\r\n\r\n      /* Expression styles */\r\n      .expression-happy .avatar-eyes {\r\n        transform: translateX(-50%) scaleY(0.8);\r\n      }\r\n\r\n      .expression-happy .avatar-lips {\r\n        transform: scaleY(1.2);\r\n      }\r\n\r\n      .expression-happy .cheek {\r\n        opacity: 1;\r\n      }\r\n\r\n      .expression-serious .avatar-eyes {\r\n        transform: translateX(-50%) scaleY(1.2);\r\n      }\r\n\r\n      .expression-serious .avatar-lips {\r\n        transform: scaleY(0.8);\r\n      }\r\n\r\n      .expression-thinking .avatar-eyes {\r\n        transform: translateX(-50%) scaleY(0.6);\r\n      }\r\n\r\n      .expression-thinking .avatar-lips {\r\n        transform: scaleY(0.9);\r\n      }\r\n\r\n      /* Speaking animation */\r\n      .speaking .mouth-opening {\r\n        opacity: 1;\r\n        animation: mouth-move 0.1s ease-in-out infinite alternate;\r\n      }\r\n\r\n      @keyframes mouth-move {\r\n        0% { transform: translate(-50%, -50%) scaleY(1); }\r\n        100% { transform: translate(-50%, -50%) scaleY(1.5); }\r\n      }\r\n\r\n      /* Blinking animation */\r\n      .avatar-eye .eyelid {\r\n        animation: blink 4s infinite;\r\n      }\r\n\r\n      @keyframes blink {\r\n        0%, 90%, 100% { transform: scaleY(1); }\r\n        95% { transform: scaleY(0.1); }\r\n      }\r\n    `;\r\n    \r\n    document.head.appendChild(style);\r\n  }\r\n\r\n  /**\r\n   * Start speaking animation with audio\r\n   * @param {Blob} audioBlob - Audio blob to play\r\n   * @param {string} text - Text being spoken (for fallback)\r\n   */\r\n  async startSpeaking(audioBlob, text = '') {\r\n    if (this.isAnimating) {\r\n      await this.stopSpeaking();\r\n    }\r\n\r\n    this.isAnimating = true;\r\n    \r\n    // Add speaking class for CSS animations\r\n    if (this.avatarElement) {\r\n      this.avatarElement.classList.add('speaking');\r\n    }\r\n    \r\n    try {\r\n      if (this.audioContext && audioBlob) {\r\n        await this.playAudioWithLipSync(audioBlob);\r\n      } else {\r\n        // Fallback: animate based on text length\r\n        this.animateWithText(text);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to start speaking animation:', error);\r\n      // Fallback animation\r\n      this.animateWithText(text);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Play audio with real-time lip sync\r\n   * @param {Blob} audioBlob - Audio to play\r\n   */\r\n  async playAudioWithLipSync(audioBlob) {\r\n    try {\r\n      const arrayBuffer = await audioBlob.arrayBuffer();\r\n      const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\r\n      \r\n      const source = this.audioContext.createBufferSource();\r\n      source.buffer = audioBuffer;\r\n      source.connect(this.analyser);\r\n      this.analyser.connect(this.audioContext.destination);\r\n      \r\n      this.currentAudio = source;\r\n      \r\n      // Start lip sync animation\r\n      this.startLipSyncAnimation();\r\n      \r\n      // Play audio\r\n      source.start(0);\r\n      \r\n      // Stop animation when audio ends\r\n      source.onended = () => {\r\n        this.stopSpeaking();\r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('Audio playback failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start lip sync animation based on audio frequency\r\n   */\r\n  startLipSyncAnimation() {\r\n    const animate = () => {\r\n      if (!this.isAnimating) return;\r\n      \r\n      this.analyser.getByteFrequencyData(this.dataArray);\r\n      \r\n      // Calculate more sophisticated audio analysis\r\n      const average = this.dataArray.reduce((a, b) => a + b) / this.dataArray.length;\r\n      const max = Math.max(...this.dataArray);\r\n      const min = Math.min(...this.dataArray);\r\n      \r\n      // Normalize to 0-1 with better scaling\r\n      const normalized = Math.min(1, (average + (max - min) * 0.3) / 255);\r\n      \r\n      // Apply mouth animation with more realistic movement\r\n      this.animateMouth(normalized);\r\n      \r\n      this.animationFrame = requestAnimationFrame(animate);\r\n    };\r\n    \r\n    animate();\r\n  }\r\n\r\n  /**\r\n   * Animate mouth based on audio intensity\r\n   * @param {number} intensity - Audio intensity (0-1)\r\n   */\r\n  animateMouth(intensity) {\r\n    const lips = this.avatarElement?.querySelector('.avatar-lips');\r\n    const mouthOpening = this.avatarElement?.querySelector('.mouth-opening');\r\n    if (!lips || !mouthOpening) return;\r\n    \r\n    // More realistic mouth movement\r\n    const scale = 1 + (intensity * 0.8);\r\n    const mouthScale = 0.5 + (intensity * 1.5);\r\n    \r\n    // Animate lips\r\n    lips.style.transform = `scaleY(${scale})`;\r\n    \r\n    // Animate mouth opening\r\n    mouthOpening.style.transform = `translate(-50%, -50%) scaleY(${mouthScale})`;\r\n    mouthOpening.style.opacity = Math.min(1, intensity * 2);\r\n    \r\n    // Add some randomness for natural movement\r\n    const randomOffset = (Math.random() - 0.5) * 0.2;\r\n    lips.style.transform += ` translateY(${randomOffset}px)`;\r\n  }\r\n\r\n  /**\r\n   * Fallback animation based on text length\r\n   * @param {string} text - Text to animate for\r\n   */\r\n  animateWithText(text) {\r\n    const duration = Math.max(text.length * 100, 2000); // 100ms per character, min 2s\r\n    \r\n    this.animateMouth(0.5); // Medium intensity\r\n    \r\n    setTimeout(() => {\r\n      this.stopSpeaking();\r\n    }, duration);\r\n  }\r\n\r\n  /**\r\n   * Stop speaking animation\r\n   */\r\n  async stopSpeaking() {\r\n    this.isAnimating = false;\r\n    \r\n    // Remove speaking class\r\n    if (this.avatarElement) {\r\n      this.avatarElement.classList.remove('speaking');\r\n    }\r\n    \r\n    if (this.currentAudio) {\r\n      this.currentAudio.stop();\r\n      this.currentAudio = null;\r\n    }\r\n    \r\n    if (this.animationFrame) {\r\n      cancelAnimationFrame(this.animationFrame);\r\n      this.animationFrame = null;\r\n    }\r\n    \r\n    // Reset mouth to neutral position\r\n    const lips = this.avatarElement?.querySelector('.avatar-lips');\r\n    if (lips) {\r\n      lips.style.transform = 'scaleY(1) translateY(0px)';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set avatar expression\r\n   * @param {string} expression - Expression type (happy, serious, thinking, etc.)\r\n   */\r\n  setExpression(expression) {\r\n    if (!this.avatarElement) return;\r\n    \r\n    // Remove previous expression classes\r\n    this.avatarElement.classList.remove('expression-happy', 'expression-serious', 'expression-thinking');\r\n    \r\n    // Add new expression class\r\n    this.avatarElement.classList.add(`expression-${expression}`);\r\n    \r\n    // Update visual elements based on expression\r\n    this.updateExpressionVisuals(expression);\r\n  }\r\n\r\n  /**\r\n   * Update visual elements for expression\r\n   * @param {string} expression - Expression type\r\n   */\r\n  updateExpressionVisuals(expression) {\r\n    const eyes = this.avatarElement?.querySelector('.avatar-eyes');\r\n    const mouth = this.avatarElement?.querySelector('.avatar-mouth');\r\n    \r\n    if (!eyes || !mouth) return;\r\n    \r\n    switch (expression) {\r\n      case 'happy':\r\n        eyes.style.transform = 'scaleY(0.8)';\r\n        mouth.style.transform = 'scaleY(1.2)';\r\n        break;\r\n      case 'serious':\r\n        eyes.style.transform = 'scaleY(1.2)';\r\n        mouth.style.transform = 'scaleY(0.8)';\r\n        break;\r\n      case 'thinking':\r\n        eyes.style.transform = 'scaleY(0.6)';\r\n        mouth.style.transform = 'scaleY(0.9)';\r\n        break;\r\n      default:\r\n        eyes.style.transform = 'scaleY(1)';\r\n        mouth.style.transform = 'scaleY(1)';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup resources\r\n   */\r\n  destroy() {\r\n    this.stopSpeaking();\r\n    \r\n    if (this.audioContext) {\r\n      this.audioContext.close();\r\n      this.audioContext = null;\r\n    }\r\n    \r\n    this.avatarElement = null;\r\n  }\r\n}\r\n\r\n// Global instance\r\nexport const avatarService = new AvatarService();\r\n\r\n\r\n"],"mappings":"AAAA;AACA;AACA;AACA,OAAO,MAAMA,aAAa,CAAC;EACzBC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,aAAa,GAAG,IAAI;IACzB,IAAI,CAACC,WAAW,GAAG,KAAK;IACxB,IAAI,CAACC,YAAY,GAAG,IAAI;IACxB,IAAI,CAACC,YAAY,GAAG,IAAI;IACxB,IAAI,CAACC,QAAQ,GAAG,IAAI;IACpB,IAAI,CAACC,SAAS,GAAG,IAAI;IACrB,IAAI,CAACC,cAAc,GAAG,IAAI;EAC5B;;EAEA;AACF;AACA;AACA;EACEC,UAAUA,CAACP,aAAa,EAAE;IACxB,IAAI,CAACA,aAAa,GAAGA,aAAa;IAClC,IAAI,CAACQ,iBAAiB,CAAC,CAAC;IACxB,IAAI,CAACC,mBAAmB,CAAC,CAAC;EAC5B;;EAEA;AACF;AACA;EACED,iBAAiBA,CAAA,EAAG;IAClB,IAAI;MACF,IAAI,CAACL,YAAY,GAAG,KAAKO,MAAM,CAACC,YAAY,IAAID,MAAM,CAACE,kBAAkB,EAAE,CAAC;MAC5E,IAAI,CAACR,QAAQ,GAAG,IAAI,CAACD,YAAY,CAACU,cAAc,CAAC,CAAC;MAClD,IAAI,CAACT,QAAQ,CAACU,OAAO,GAAG,GAAG;MAC3B,IAAI,CAACT,SAAS,GAAG,IAAIU,UAAU,CAAC,IAAI,CAACX,QAAQ,CAACY,iBAAiB,CAAC;IAClE,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACC,IAAI,CAAC,uDAAuD,CAAC;IACvE;EACF;;EAEA;AACF;AACA;EACEV,mBAAmBA,CAAA,EAAG;IACpB,IAAI,CAAC,IAAI,CAACT,aAAa,EAAE;;IAEzB;IACA,IAAI,CAACA,aAAa,CAACoB,SAAS,GAAG;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;IAED;IACA,IAAI,CAACpB,aAAa,CAACqB,SAAS,CAACC,GAAG,CAAC,oBAAoB,CAAC;;IAEtD;IACA,IAAI,CAACC,eAAe,CAAC,CAAC;EACxB;;EAEA;AACF;AACA;EACEA,eAAeA,CAAA,EAAG;IAChB,IAAIC,QAAQ,CAACC,cAAc,CAAC,eAAe,CAAC,EAAE;IAE9C,MAAMC,KAAK,GAAGF,QAAQ,CAACG,aAAa,CAAC,OAAO,CAAC;IAC7CD,KAAK,CAACE,EAAE,GAAG,eAAe;IAC1BF,KAAK,CAACG,WAAW,GAAG;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;IAEDL,QAAQ,CAACM,IAAI,CAACC,WAAW,CAACL,KAAK,CAAC;EAClC;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMM,aAAaA,CAACC,SAAS,EAAEC,IAAI,GAAG,EAAE,EAAE;IACxC,IAAI,IAAI,CAACjC,WAAW,EAAE;MACpB,MAAM,IAAI,CAACkC,YAAY,CAAC,CAAC;IAC3B;IAEA,IAAI,CAAClC,WAAW,GAAG,IAAI;;IAEvB;IACA,IAAI,IAAI,CAACD,aAAa,EAAE;MACtB,IAAI,CAACA,aAAa,CAACqB,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;IAC9C;IAEA,IAAI;MACF,IAAI,IAAI,CAACnB,YAAY,IAAI8B,SAAS,EAAE;QAClC,MAAM,IAAI,CAACG,oBAAoB,CAACH,SAAS,CAAC;MAC5C,CAAC,MAAM;QACL;QACA,IAAI,CAACI,eAAe,CAACH,IAAI,CAAC;MAC5B;IACF,CAAC,CAAC,OAAOjB,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;MAC3D;MACA,IAAI,CAACoB,eAAe,CAACH,IAAI,CAAC;IAC5B;EACF;;EAEA;AACF;AACA;AACA;EACE,MAAME,oBAAoBA,CAACH,SAAS,EAAE;IACpC,IAAI;MACF,MAAMK,WAAW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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}