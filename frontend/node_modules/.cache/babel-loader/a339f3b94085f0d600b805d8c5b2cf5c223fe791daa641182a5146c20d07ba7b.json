{"ast":null,"code":"// Replace the entire contents of frontend/src/services/aiService.js\n\nimport api from './api'; // For authenticated requests\nimport publicApi from './publicApi'; // For public requests\n\nexport const aiService = {\n  /**\n   * Generate speech from text using the PUBLIC endpoint.\n   * THIS IS THE FUNCTION USED BY THE PUBLIC INTERVIEW.\n   * @param {string} text - Text to convert to speech\n   * @returns {Promise<Blob>} Audio blob\n   */\n  async generateTTS(text) {\n    // Basic validation\n    if (!text || typeof text !== 'string' || text.trim() === '') {\n      const errorMsg = 'TTS Error: Text input is invalid or empty.';\n      console.error(errorMsg);\n      // Return a rejected promise for clearer error handling in the component\n      return Promise.reject(new Error(errorMsg));\n    }\n    try {\n      console.log(`[aiService] Calling PUBLIC TTS endpoint (/api/public/tts) for text: \"${text.substring(0, 50)}...\"`);\n\n      // *** CRITICAL FIX: Ensure publicApi is used and payload is JSON ***\n      const response = await publicApi.post('/public/tts', {\n        text: text.trim()\n      },\n      // Send payload as JSON object\n      {\n        responseType: 'blob',\n        // Expect binary audio data back\n        timeout: 15000 // Add a timeout (15 seconds)\n      });\n\n      // Check if the response looks like audio\n      if (response.data instanceof Blob && response.data.type.startsWith('audio/')) {\n        console.log(\"[aiService] Received valid audio blob from /public/tts. Size:\", response.data.size);\n        return response.data; // Return the audio blob\n      } else {\n        console.error(\"[aiService] Received invalid data format from /public/tts. Expected audio blob, got:\", response.data);\n        throw new Error(\"Invalid audio data received from server.\");\n      }\n    } catch (error) {\n      var _error$response, _error$response2, _error$response2$data;\n      console.error('[aiService] TTS generation via /public/tts failed:', ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message || error);\n      // Try to provide a more specific error message if available\n      const detail = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.detail) || \"Could not connect to TTS service.\";\n      toast.error(`TTS Error: ${detail}`); // Show error to user\n      // Re-throw the error so the calling component knows it failed\n      throw error;\n    }\n  },\n  // --- Functions below are likely for ADMIN/LOGGED-IN users ---\n  // --- They should use the authenticated 'api' client ---\n\n  /**\n   * Generate speech from text using the SECURE endpoint (likely for admins).\n   * @param {string} text - Text to convert to speech\n   * @param {string} voice - Voice to use\n   * @returns {Promise<Blob>} Audio blob\n   */\n  async generateSpeechSecure(text, voice = 'default') {\n    try {\n      const formData = new FormData();\n      formData.append('text', text);\n      formData.append('voice', voice);\n      console.log(\"[aiService] Calling SECURE TTS endpoint (/api/ai/tts)\");\n      // Use the secure 'api' instance\n      const response = await api.post('/ai/tts', formData, {\n        // Secure endpoint might expect FormData\n        headers: {\n          // 'Content-Type': 'multipart/form-data', // Often set automatically for FormData\n        },\n        responseType: 'blob',\n        timeout: 15000\n      });\n      return response.data;\n    } catch (error) {\n      console.error('[aiService] Secure TTS generation failed:', error);\n      throw error;\n    }\n  },\n  /**\n   * Transcribe audio file using the SECURE endpoint.\n   * @param {File} audioFile - Audio file to transcribe\n   * @returns {Promise<Object>} Transcription result\n   */\n  async transcribeAudio(audioFile) {\n    try {\n      const formData = new FormData();\n      formData.append('audio_file', audioFile);\n      console.log(\"[aiService] Calling SECURE transcribe endpoint (/api/ai/transcribe)\");\n      // Use the secure 'api' instance\n      const response = await api.post('/ai/transcribe', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      return response.data;\n    } catch (error) {\n      console.error('[aiService] Transcription failed:', error);\n      throw error;\n    }\n  },\n  /**\n   * Get available voices using the SECURE endpoint.\n   * @returns {Promise<Object>} Available voices\n   */\n  async getAvailableVoices() {\n    try {\n      console.log(\"[aiService] Calling SECURE voices endpoint (/api/ai/voices)\");\n      // Use the secure 'api' instance\n      const response = await api.get('/ai/voices');\n      return response.data;\n    } catch (error) {\n      console.error('[aiService] Failed to get voices:', error);\n      throw error;\n    }\n  },\n  /**\n  * Check AI services health using the SECURE endpoint\n  * @returns {Promise<Object>} Health status\n  */\n  async checkHealth() {\n    try {\n      console.log(\"[aiService] Calling SECURE health endpoint (/api/ai/health)\");\n      const response = await api.get('/ai/health');\n      return response.data;\n    } catch (error) {\n      console.error('Health check failed:', error);\n      throw error;\n    }\n  }\n};","map":{"version":3,"names":["api","publicApi","aiService","generateTTS","text","trim","errorMsg","console","error","Promise","reject","Error","log","substring","response","post","responseType","timeout","data","Blob","type","startsWith","size","_error$response","_error$response2","_error$response2$data","message","detail","toast","generateSpeechSecure","voice","formData","FormData","append","headers","transcribeAudio","audioFile","getAvailableVoices","get","checkHealth"],"sources":["D:/ai_avatar/frontend/src/services/aiService.js"],"sourcesContent":["// Replace the entire contents of frontend/src/services/aiService.js\n\nimport api from './api'; // For authenticated requests\nimport publicApi from './publicApi'; // For public requests\n\nexport const aiService = {\n  /**\n   * Generate speech from text using the PUBLIC endpoint.\n   * THIS IS THE FUNCTION USED BY THE PUBLIC INTERVIEW.\n   * @param {string} text - Text to convert to speech\n   * @returns {Promise<Blob>} Audio blob\n   */\n  async generateTTS(text) {\n    // Basic validation\n    if (!text || typeof text !== 'string' || text.trim() === '') {\n      const errorMsg = 'TTS Error: Text input is invalid or empty.';\n      console.error(errorMsg);\n      // Return a rejected promise for clearer error handling in the component\n      return Promise.reject(new Error(errorMsg));\n    }\n\n    try {\n      console.log(`[aiService] Calling PUBLIC TTS endpoint (/api/public/tts) for text: \"${text.substring(0, 50)}...\"`);\n      \n      // *** CRITICAL FIX: Ensure publicApi is used and payload is JSON ***\n      const response = await publicApi.post('/public/tts', \n        { text: text.trim() }, // Send payload as JSON object\n        { \n          responseType: 'blob', // Expect binary audio data back\n          timeout: 15000 // Add a timeout (15 seconds)\n        }\n      );\n      \n      // Check if the response looks like audio\n      if (response.data instanceof Blob && response.data.type.startsWith('audio/')) {\n        console.log(\"[aiService] Received valid audio blob from /public/tts. Size:\", response.data.size);\n        return response.data; // Return the audio blob\n      } else {\n        console.error(\"[aiService] Received invalid data format from /public/tts. Expected audio blob, got:\", response.data);\n        throw new Error(\"Invalid audio data received from server.\");\n      }\n      \n    } catch (error) {\n      console.error('[aiService] TTS generation via /public/tts failed:', error.response?.data || error.message || error);\n      // Try to provide a more specific error message if available\n      const detail = error.response?.data?.detail || \"Could not connect to TTS service.\";\n      toast.error(`TTS Error: ${detail}`); // Show error to user\n      // Re-throw the error so the calling component knows it failed\n      throw error; \n    }\n  },\n\n  // --- Functions below are likely for ADMIN/LOGGED-IN users ---\n  // --- They should use the authenticated 'api' client ---\n\n  /**\n   * Generate speech from text using the SECURE endpoint (likely for admins).\n   * @param {string} text - Text to convert to speech\n   * @param {string} voice - Voice to use\n   * @returns {Promise<Blob>} Audio blob\n   */\n  async generateSpeechSecure(text, voice = 'default') {\n    try {\n      const formData = new FormData();\n      formData.append('text', text);\n      formData.append('voice', voice);\n      \n      console.log(\"[aiService] Calling SECURE TTS endpoint (/api/ai/tts)\");\n      // Use the secure 'api' instance\n      const response = await api.post('/ai/tts', formData, {\n        // Secure endpoint might expect FormData\n        headers: { \n         // 'Content-Type': 'multipart/form-data', // Often set automatically for FormData\n        }, \n        responseType: 'blob',\n        timeout: 15000 \n      });\n      return response.data;\n    } catch (error) {\n      console.error('[aiService] Secure TTS generation failed:', error);\n      throw error;\n    }\n  },\n\n\n  /**\n   * Transcribe audio file using the SECURE endpoint.\n   * @param {File} audioFile - Audio file to transcribe\n   * @returns {Promise<Object>} Transcription result\n   */\n  async transcribeAudio(audioFile) {\n    try {\n      const formData = new FormData();\n      formData.append('audio_file', audioFile);\n      \n      console.log(\"[aiService] Calling SECURE transcribe endpoint (/api/ai/transcribe)\");\n      // Use the secure 'api' instance\n      const response = await api.post('/ai/transcribe', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data',\n        },\n      });\n      return response.data;\n    } catch (error) {\n      console.error('[aiService] Transcription failed:', error);\n      throw error;\n    }\n  },\n\n  /**\n   * Get available voices using the SECURE endpoint.\n   * @returns {Promise<Object>} Available voices\n   */\n  async getAvailableVoices() {\n    try {\n      console.log(\"[aiService] Calling SECURE voices endpoint (/api/ai/voices)\");\n      // Use the secure 'api' instance\n      const response = await api.get('/ai/voices');\n      return response.data;\n    } catch (error) {\n      console.error('[aiService] Failed to get voices:', error);\n      throw error;\n    }\n  },\n  \n   /**\n   * Check AI services health using the SECURE endpoint\n   * @returns {Promise<Object>} Health status\n   */\n  async checkHealth() {\n    try {\n      console.log(\"[aiService] Calling SECURE health endpoint (/api/ai/health)\");\n      const response = await api.get('/ai/health');\n      return response.data;\n    } catch (error) {\n      console.error('Health check failed:', error);\n      throw error;\n    }\n  },\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}