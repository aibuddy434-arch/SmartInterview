{"ast":null,"code":"import { readyPlayerMeService } from './readyPlayerMeService';\n\n/**\n * Avatar Service for managing AI interviewer avatar\n * Now integrates with Ready Player Me for 3D avatars\n */\nexport class AvatarService {\n  constructor() {\n    this.avatarElement = null;\n    this.isAnimating = false;\n    this.currentAudio = null;\n    this.audioContext = null;\n    this.analyser = null;\n    this.dataArray = null;\n    this.animationFrame = null;\n    this.use3DAvatar = true; // Flag to switch between 2D and 3D\n  }\n\n  /**\n   * Initialize avatar with DOM element\n   * @param {HTMLElement} avatarElement - Avatar DOM element\n   * @param {boolean} use3D - Whether to use 3D Ready Player Me avatar\n   */\n  async initialize(avatarElement, use3D = true) {\n    this.avatarElement = avatarElement;\n    this.use3DAvatar = use3D;\n    if (use3D) {\n      // Initialize 3D Ready Player Me avatar\n      const success = await readyPlayerMeService.initialize('avatar-container');\n      if (!success) {\n        console.warn('Failed to initialize 3D avatar, falling back to 2D');\n        this.use3DAvatar = false;\n        this.setupAudioContext();\n        this.createAvatarVisuals();\n      }\n    } else {\n      // Use 2D avatar\n      this.setupAudioContext();\n      this.createAvatarVisuals();\n    }\n  }\n\n  /**\n   * Setup Web Audio API context for real-time audio analysis\n   */\n  setupAudioContext() {\n    try {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 256;\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n    } catch (error) {\n      console.warn('Web Audio API not supported, using fallback animation');\n    }\n  }\n\n  /**\n   * Create avatar visual elements\n   */\n  createAvatarVisuals() {\n    if (!this.avatarElement) return;\n\n    // Create talking head elements with more detailed structure\n    this.avatarElement.innerHTML = `\n      <div class=\"avatar-container\">\n        <div class=\"avatar-head\">\n          <div class=\"avatar-face\">\n            <div class=\"avatar-eyes\">\n              <div class=\"avatar-eye left\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n              <div class=\"avatar-eye right\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-nose\"></div>\n            <div class=\"avatar-mouth\">\n              <div class=\"avatar-lips\">\n                <div class=\"upper-lip\"></div>\n                <div class=\"lower-lip\"></div>\n                <div class=\"mouth-opening\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-cheeks\">\n              <div class=\"cheek left\"></div>\n              <div class=\"cheek right\"></div>\n            </div>\n          </div>\n          <div class=\"avatar-hair\"></div>\n        </div>\n        <div class=\"avatar-body\">\n          <div class=\"avatar-torso\"></div>\n          <div class=\"avatar-arms\">\n            <div class=\"arm left\"></div>\n            <div class=\"arm right\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add CSS classes for styling\n    this.avatarElement.classList.add('avatar-interviewer');\n\n    // Add the CSS styles\n    this.addAvatarStyles();\n  }\n\n  /**\n   * Add CSS styles for the avatar\n   */\n  addAvatarStyles() {\n    if (document.getElementById('avatar-styles')) return;\n    const style = document.createElement('style');\n    style.id = 'avatar-styles';\n    style.textContent = `\n      .avatar-interviewer {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        border-radius: 20px;\n        overflow: hidden;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n      }\n\n      .avatar-container {\n        position: relative;\n        width: 200px;\n        height: 250px;\n        transform-style: preserve-3d;\n        animation: float 3s ease-in-out infinite;\n      }\n\n      @keyframes float {\n        0%, 100% { transform: translateY(0px); }\n        50% { transform: translateY(-10px); }\n      }\n\n      .avatar-head {\n        position: relative;\n        width: 120px;\n        height: 120px;\n        background: #fdbcb4;\n        border-radius: 50%;\n        margin: 0 auto 20px;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n        transform-style: preserve-3d;\n      }\n\n      .avatar-face {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n        overflow: hidden;\n      }\n\n      .avatar-eyes {\n        position: absolute;\n        top: 30px;\n        left: 50%;\n        transform: translateX(-50%);\n        display: flex;\n        gap: 20px;\n      }\n\n      .avatar-eye {\n        position: relative;\n        width: 20px;\n        height: 20px;\n        background: white;\n        border-radius: 50%;\n        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\n      }\n\n      .pupil {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 12px;\n        height: 12px;\n        background: #333;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .eyelid {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 50%;\n        background: #fdbcb4;\n        border-radius: 50% 50% 0 0;\n        transition: transform 0.1s ease;\n      }\n\n      .avatar-nose {\n        position: absolute;\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 8px;\n        height: 12px;\n        background: #f4a5a5;\n        border-radius: 50%;\n      }\n\n      .avatar-mouth {\n        position: absolute;\n        top: 70px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 40px;\n        height: 20px;\n      }\n\n      .avatar-lips {\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      .upper-lip, .lower-lip {\n        position: absolute;\n        width: 100%;\n        height: 50%;\n        background: #d63384;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .upper-lip {\n        top: 0;\n        border-radius: 50% 50% 0 0;\n      }\n\n      .lower-lip {\n        bottom: 0;\n        border-radius: 0 0 50% 50%;\n      }\n\n      .mouth-opening {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 20px;\n        height: 8px;\n        background: #000;\n        border-radius: 50%;\n        opacity: 0;\n        transition: all 0.1s ease;\n      }\n\n      .avatar-cheeks {\n        position: absolute;\n        top: 50px;\n        left: 0;\n        right: 0;\n        height: 30px;\n      }\n\n      .cheek {\n        position: absolute;\n        top: 0;\n        width: 20px;\n        height: 20px;\n        background: #ffb3ba;\n        border-radius: 50%;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n      }\n\n      .cheek.left {\n        left: 10px;\n      }\n\n      .cheek.right {\n        right: 10px;\n      }\n\n      .avatar-hair {\n        position: absolute;\n        top: -10px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 100px;\n        height: 40px;\n        background: #8b4513;\n        border-radius: 50% 50% 0 0;\n        z-index: -1;\n      }\n\n      .avatar-body {\n        position: relative;\n        width: 80px;\n        height: 100px;\n        background: #4a90e2;\n        border-radius: 20px;\n        margin: 0 auto;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n      }\n\n      .avatar-torso {\n        width: 100%;\n        height: 60px;\n        background: #4a90e2;\n        border-radius: 20px 20px 10px 10px;\n      }\n\n      .avatar-arms {\n        position: absolute;\n        top: 10px;\n        left: 0;\n        right: 0;\n        height: 40px;\n      }\n\n      .arm {\n        position: absolute;\n        width: 15px;\n        height: 40px;\n        background: #fdbcb4;\n        border-radius: 10px;\n      }\n\n      .arm.left {\n        left: -10px;\n        top: 10px;\n        transform: rotate(-20deg);\n      }\n\n      .arm.right {\n        right: -10px;\n        top: 10px;\n        transform: rotate(20deg);\n      }\n\n      /* Expression styles */\n      .expression-happy .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.8);\n      }\n\n      .expression-happy .avatar-lips {\n        transform: scaleY(1.2);\n      }\n\n      .expression-happy .cheek {\n        opacity: 1;\n      }\n\n      .expression-serious .avatar-eyes {\n        transform: translateX(-50%) scaleY(1.2);\n      }\n\n      .expression-serious .avatar-lips {\n        transform: scaleY(0.8);\n      }\n\n      .expression-thinking .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.6);\n      }\n\n      .expression-thinking .avatar-lips {\n        transform: scaleY(0.9);\n      }\n\n      /* Speaking animation */\n      .speaking .mouth-opening {\n        opacity: 1;\n        animation: mouth-move 0.1s ease-in-out infinite alternate;\n      }\n\n      @keyframes mouth-move {\n        0% { transform: translate(-50%, -50%) scaleY(1); }\n        100% { transform: translate(-50%, -50%) scaleY(1.5); }\n      }\n\n      /* Blinking animation */\n      .avatar-eye .eyelid {\n        animation: blink 4s infinite;\n      }\n\n      @keyframes blink {\n        0%, 90%, 100% { transform: scaleY(1); }\n        95% { transform: scaleY(0.1); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  /**\n   * Start speaking animation with audio\n   * @param {Blob} audioBlob - Audio blob to play\n   * @param {string} text - Text being spoken (for fallback)\n   */\n  async startSpeaking(audioBlob, text = '') {\n    if (this.isAnimating) {\n      await this.stopSpeaking();\n    }\n    this.isAnimating = true;\n\n    // Add speaking class for CSS animations (2D only)\n    if (this.avatarElement && !this.use3DAvatar) {\n      this.avatarElement.classList.add('speaking');\n    }\n    try {\n      if (this.use3DAvatar && readyPlayerMeService.isReady()) {\n        // Use 3D avatar with Ready Player Me\n        await this.playWith3DAvatar(audioBlob, text);\n      } else if (this.audioContext && audioBlob) {\n        // Use 2D avatar with lip sync\n        await this.playAudioWithLipSync(audioBlob);\n      } else {\n        // Fallback: animate based on text length\n        this.animateWithText(text);\n      }\n    } catch (error) {\n      console.error('Failed to start speaking animation:', error);\n      // Fallback animation\n      this.animateWithText(text);\n    }\n  }\n\n  /**\n   * Play audio with 3D Ready Player Me avatar\n   * @param {Blob} audioBlob - Audio blob to play\n   * @param {string} text - Text being spoken\n   */\n  async playWith3DAvatar(audioBlob, text) {\n    try {\n      // Create audio element from blob\n      const audioUrl = URL.createObjectURL(audioBlob);\n      const audio = new Audio(audioUrl);\n\n      // Set up audio event handlers\n      audio.onended = () => {\n        URL.revokeObjectURL(audioUrl);\n        this.stopSpeaking();\n      };\n      audio.onerror = e => {\n        console.error('Audio playback error:', e);\n        URL.revokeObjectURL(audioUrl);\n        this.stopSpeaking();\n      };\n\n      // Play with lip sync using Ready Player Me\n      await readyPlayerMeService.playWithLipSync(audio);\n    } catch (error) {\n      console.error('Failed to play with 3D avatar:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Play audio with real-time lip sync\n   * @param {Blob} audioBlob - Audio to play\n   */\n  async playAudioWithLipSync(audioBlob) {\n    try {\n      const arrayBuffer = await audioBlob.arrayBuffer();\n      const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n      const source = this.audioContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(this.analyser);\n      this.analyser.connect(this.audioContext.destination);\n      this.currentAudio = source;\n\n      // Start lip sync animation\n      this.startLipSyncAnimation();\n\n      // Play audio\n      source.start(0);\n\n      // Stop animation when audio ends\n      source.onended = () => {\n        this.stopSpeaking();\n      };\n    } catch (error) {\n      console.error('Audio playback failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Start lip sync animation based on audio frequency\n   */\n  startLipSyncAnimation() {\n    const animate = () => {\n      if (!this.isAnimating) return;\n      this.analyser.getByteFrequencyData(this.dataArray);\n\n      // Calculate more sophisticated audio analysis\n      const average = this.dataArray.reduce((a, b) => a + b) / this.dataArray.length;\n      const max = Math.max(...this.dataArray);\n      const min = Math.min(...this.dataArray);\n\n      // Normalize to 0-1 with better scaling\n      const normalized = Math.min(1, (average + (max - min) * 0.3) / 255);\n\n      // Apply mouth animation with more realistic movement\n      this.animateMouth(normalized);\n      this.animationFrame = requestAnimationFrame(animate);\n    };\n    animate();\n  }\n\n  /**\n   * Animate mouth based on audio intensity\n   * @param {number} intensity - Audio intensity (0-1)\n   */\n  animateMouth(intensity) {\n    var _this$avatarElement, _this$avatarElement2;\n    const lips = (_this$avatarElement = this.avatarElement) === null || _this$avatarElement === void 0 ? void 0 : _this$avatarElement.querySelector('.avatar-lips');\n    const mouthOpening = (_this$avatarElement2 = this.avatarElement) === null || _this$avatarElement2 === void 0 ? void 0 : _this$avatarElement2.querySelector('.mouth-opening');\n    if (!lips || !mouthOpening) return;\n\n    // More realistic mouth movement\n    const scale = 1 + intensity * 0.8;\n    const mouthScale = 0.5 + intensity * 1.5;\n\n    // Animate lips\n    lips.style.transform = `scaleY(${scale})`;\n\n    // Animate mouth opening\n    mouthOpening.style.transform = `translate(-50%, -50%) scaleY(${mouthScale})`;\n    mouthOpening.style.opacity = Math.min(1, intensity * 2);\n\n    // Add some randomness for natural movement\n    const randomOffset = (Math.random() - 0.5) * 0.2;\n    lips.style.transform += ` translateY(${randomOffset}px)`;\n  }\n\n  /**\n   * Fallback animation based on text length\n   * @param {string} text - Text to animate for\n   */\n  animateWithText(text) {\n    const duration = Math.max(text.length * 100, 2000); // 100ms per character, min 2s\n\n    this.animateMouth(0.5); // Medium intensity\n\n    setTimeout(() => {\n      this.stopSpeaking();\n    }, duration);\n  }\n\n  /**\n   * Stop speaking animation\n   */\n  async stopSpeaking() {\n    this.isAnimating = false;\n\n    // Stop 3D avatar lip sync\n    if (this.use3DAvatar && readyPlayerMeService.isReady()) {\n      readyPlayerMeService.stopLipSync();\n    }\n\n    // Remove speaking class (2D only)\n    if (this.avatarElement && !this.use3DAvatar) {\n      this.avatarElement.classList.remove('speaking');\n    }\n    if (this.currentAudio) {\n      this.currentAudio.stop();\n      this.currentAudio = null;\n    }\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n    }\n\n    // Reset mouth to neutral position (2D only)\n    if (!this.use3DAvatar) {\n      var _this$avatarElement3;\n      const lips = (_this$avatarElement3 = this.avatarElement) === null || _this$avatarElement3 === void 0 ? void 0 : _this$avatarElement3.querySelector('.avatar-lips');\n      if (lips) {\n        lips.style.transform = 'scaleY(1) translateY(0px)';\n      }\n    }\n  }\n\n  /**\n   * Set avatar expression\n   * @param {string} expression - Expression type (happy, serious, thinking, etc.)\n   */\n  setExpression(expression) {\n    if (this.use3DAvatar && readyPlayerMeService.isReady()) {\n      // Use 3D avatar expression\n      readyPlayerMeService.setExpression(expression);\n    } else if (this.avatarElement) {\n      // Use 2D avatar expression\n      // Remove previous expression classes\n      this.avatarElement.classList.remove('expression-happy', 'expression-serious', 'expression-thinking');\n\n      // Add new expression class\n      this.avatarElement.classList.add(`expression-${expression}`);\n\n      // Update visual elements based on expression\n      this.updateExpressionVisuals(expression);\n    }\n  }\n\n  /**\n   * Update visual elements for expression\n   * @param {string} expression - Expression type\n   */\n  updateExpressionVisuals(expression) {\n    var _this$avatarElement4, _this$avatarElement5;\n    const eyes = (_this$avatarElement4 = this.avatarElement) === null || _this$avatarElement4 === void 0 ? void 0 : _this$avatarElement4.querySelector('.avatar-eyes');\n    const mouth = (_this$avatarElement5 = this.avatarElement) === null || _this$avatarElement5 === void 0 ? void 0 : _this$avatarElement5.querySelector('.avatar-mouth');\n    if (!eyes || !mouth) return;\n    switch (expression) {\n      case 'happy':\n        eyes.style.transform = 'scaleY(0.8)';\n        mouth.style.transform = 'scaleY(1.2)';\n        break;\n      case 'serious':\n        eyes.style.transform = 'scaleY(1.2)';\n        mouth.style.transform = 'scaleY(0.8)';\n        break;\n      case 'thinking':\n        eyes.style.transform = 'scaleY(0.6)';\n        mouth.style.transform = 'scaleY(0.9)';\n        break;\n      default:\n        eyes.style.transform = 'scaleY(1)';\n        mouth.style.transform = 'scaleY(1)';\n    }\n  }\n\n  /**\n   * Create avatar visual elements (2D fallback)\n   */\n  createAvatarVisuals() {\n    if (!this.avatarElement) return;\n\n    // Create talking head elements with more detailed structure\n    this.avatarElement.innerHTML = `\n      <div class=\"avatar-container\">\n        <div class=\"avatar-head\">\n          <div class=\"avatar-face\">\n            <div class=\"avatar-eyes\">\n              <div class=\"avatar-eye left\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n              <div class=\"avatar-eye right\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-nose\"></div>\n            <div class=\"avatar-mouth\">\n              <div class=\"avatar-lips\">\n                <div class=\"upper-lip\"></div>\n                <div class=\"lower-lip\"></div>\n                <div class=\"mouth-opening\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-cheeks\">\n              <div class=\"cheek left\"></div>\n              <div class=\"cheek right\"></div>\n            </div>\n          </div>\n          <div class=\"avatar-hair\"></div>\n        </div>\n        <div class=\"avatar-body\">\n          <div class=\"avatar-torso\"></div>\n          <div class=\"avatar-arms\">\n            <div class=\"arm left\"></div>\n            <div class=\"arm right\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add CSS classes for styling\n    this.avatarElement.classList.add('avatar-interviewer');\n\n    // Add the CSS styles\n    this.addAvatarStyles();\n  }\n\n  /**\n   * Cleanup resources\n   */\n  destroy() {\n    this.stopSpeaking();\n\n    // Cleanup 3D avatar\n    if (this.use3DAvatar) {\n      readyPlayerMeService.destroy();\n    }\n    if (this.audioContext) {\n      this.audioContext.close();\n      this.audioContext = null;\n    }\n    this.avatarElement = null;\n  }\n}\n\n// Global instance\nexport const avatarService = new AvatarService();","map":{"version":3,"names":["readyPlayerMeService","AvatarService","constructor","avatarElement","isAnimating","currentAudio","audioContext","analyser","dataArray","animationFrame","use3DAvatar","initialize","use3D","success","console","warn","setupAudioContext","createAvatarVisuals","window","AudioContext","webkitAudioContext","createAnalyser","fftSize","Uint8Array","frequencyBinCount","error","innerHTML","classList","add","addAvatarStyles","document","getElementById","style","createElement","id","textContent","head","appendChild","startSpeaking","audioBlob","text","stopSpeaking","isReady","playWith3DAvatar","playAudioWithLipSync","animateWithText","audioUrl","URL","createObjectURL","audio","Audio","onended","revokeObjectURL","onerror","e","playWithLipSync","arrayBuffer","audioBuffer","decodeAudioData","source","createBufferSource","buffer","connect","destination","startLipSyncAnimation","start","animate","getByteFrequencyData","average","reduce","a","b","length","max","Math","min","normalized","animateMouth","requestAnimationFrame","intensity","_this$avatarElement","_this$avatarElement2","lips","querySelector","mouthOpening","scale","mouthScale","transform","opacity","randomOffset","random","duration","setTimeout","stopLipSync","remove","stop","cancelAnimationFrame","_this$avatarElement3","setExpression","expression","updateExpressionVisuals","_this$avatarElement4","_this$avatarElement5","eyes","mouth","destroy","close","avatarService"],"sources":["D:/ai_avatar/frontend/src/services/avatarService.js"],"sourcesContent":["import { readyPlayerMeService } from './readyPlayerMeService';\n\n/**\n * Avatar Service for managing AI interviewer avatar\n * Now integrates with Ready Player Me for 3D avatars\n */\nexport class AvatarService {\n  constructor() {\n    this.avatarElement = null;\n    this.isAnimating = false;\n    this.currentAudio = null;\n    this.audioContext = null;\n    this.analyser = null;\n    this.dataArray = null;\n    this.animationFrame = null;\n    this.use3DAvatar = true; // Flag to switch between 2D and 3D\n  }\n\n  /**\n   * Initialize avatar with DOM element\n   * @param {HTMLElement} avatarElement - Avatar DOM element\n   * @param {boolean} use3D - Whether to use 3D Ready Player Me avatar\n   */\n  async initialize(avatarElement, use3D = true) {\n    this.avatarElement = avatarElement;\n    this.use3DAvatar = use3D;\n    \n    if (use3D) {\n      // Initialize 3D Ready Player Me avatar\n      const success = await readyPlayerMeService.initialize('avatar-container');\n      if (!success) {\n        console.warn('Failed to initialize 3D avatar, falling back to 2D');\n        this.use3DAvatar = false;\n        this.setupAudioContext();\n        this.createAvatarVisuals();\n      }\n    } else {\n      // Use 2D avatar\n      this.setupAudioContext();\n      this.createAvatarVisuals();\n    }\n  }\n\n  /**\n   * Setup Web Audio API context for real-time audio analysis\n   */\n  setupAudioContext() {\n    try {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 256;\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n    } catch (error) {\n      console.warn('Web Audio API not supported, using fallback animation');\n    }\n  }\n\n  /**\n   * Create avatar visual elements\n   */\n  createAvatarVisuals() {\n    if (!this.avatarElement) return;\n\n    // Create talking head elements with more detailed structure\n    this.avatarElement.innerHTML = `\n      <div class=\"avatar-container\">\n        <div class=\"avatar-head\">\n          <div class=\"avatar-face\">\n            <div class=\"avatar-eyes\">\n              <div class=\"avatar-eye left\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n              <div class=\"avatar-eye right\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-nose\"></div>\n            <div class=\"avatar-mouth\">\n              <div class=\"avatar-lips\">\n                <div class=\"upper-lip\"></div>\n                <div class=\"lower-lip\"></div>\n                <div class=\"mouth-opening\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-cheeks\">\n              <div class=\"cheek left\"></div>\n              <div class=\"cheek right\"></div>\n            </div>\n          </div>\n          <div class=\"avatar-hair\"></div>\n        </div>\n        <div class=\"avatar-body\">\n          <div class=\"avatar-torso\"></div>\n          <div class=\"avatar-arms\">\n            <div class=\"arm left\"></div>\n            <div class=\"arm right\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add CSS classes for styling\n    this.avatarElement.classList.add('avatar-interviewer');\n    \n    // Add the CSS styles\n    this.addAvatarStyles();\n  }\n\n  /**\n   * Add CSS styles for the avatar\n   */\n  addAvatarStyles() {\n    if (document.getElementById('avatar-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'avatar-styles';\n    style.textContent = `\n      .avatar-interviewer {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        border-radius: 20px;\n        overflow: hidden;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n      }\n\n      .avatar-container {\n        position: relative;\n        width: 200px;\n        height: 250px;\n        transform-style: preserve-3d;\n        animation: float 3s ease-in-out infinite;\n      }\n\n      @keyframes float {\n        0%, 100% { transform: translateY(0px); }\n        50% { transform: translateY(-10px); }\n      }\n\n      .avatar-head {\n        position: relative;\n        width: 120px;\n        height: 120px;\n        background: #fdbcb4;\n        border-radius: 50%;\n        margin: 0 auto 20px;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n        transform-style: preserve-3d;\n      }\n\n      .avatar-face {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n        overflow: hidden;\n      }\n\n      .avatar-eyes {\n        position: absolute;\n        top: 30px;\n        left: 50%;\n        transform: translateX(-50%);\n        display: flex;\n        gap: 20px;\n      }\n\n      .avatar-eye {\n        position: relative;\n        width: 20px;\n        height: 20px;\n        background: white;\n        border-radius: 50%;\n        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\n      }\n\n      .pupil {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 12px;\n        height: 12px;\n        background: #333;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .eyelid {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 50%;\n        background: #fdbcb4;\n        border-radius: 50% 50% 0 0;\n        transition: transform 0.1s ease;\n      }\n\n      .avatar-nose {\n        position: absolute;\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 8px;\n        height: 12px;\n        background: #f4a5a5;\n        border-radius: 50%;\n      }\n\n      .avatar-mouth {\n        position: absolute;\n        top: 70px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 40px;\n        height: 20px;\n      }\n\n      .avatar-lips {\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      .upper-lip, .lower-lip {\n        position: absolute;\n        width: 100%;\n        height: 50%;\n        background: #d63384;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .upper-lip {\n        top: 0;\n        border-radius: 50% 50% 0 0;\n      }\n\n      .lower-lip {\n        bottom: 0;\n        border-radius: 0 0 50% 50%;\n      }\n\n      .mouth-opening {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 20px;\n        height: 8px;\n        background: #000;\n        border-radius: 50%;\n        opacity: 0;\n        transition: all 0.1s ease;\n      }\n\n      .avatar-cheeks {\n        position: absolute;\n        top: 50px;\n        left: 0;\n        right: 0;\n        height: 30px;\n      }\n\n      .cheek {\n        position: absolute;\n        top: 0;\n        width: 20px;\n        height: 20px;\n        background: #ffb3ba;\n        border-radius: 50%;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n      }\n\n      .cheek.left {\n        left: 10px;\n      }\n\n      .cheek.right {\n        right: 10px;\n      }\n\n      .avatar-hair {\n        position: absolute;\n        top: -10px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 100px;\n        height: 40px;\n        background: #8b4513;\n        border-radius: 50% 50% 0 0;\n        z-index: -1;\n      }\n\n      .avatar-body {\n        position: relative;\n        width: 80px;\n        height: 100px;\n        background: #4a90e2;\n        border-radius: 20px;\n        margin: 0 auto;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n      }\n\n      .avatar-torso {\n        width: 100%;\n        height: 60px;\n        background: #4a90e2;\n        border-radius: 20px 20px 10px 10px;\n      }\n\n      .avatar-arms {\n        position: absolute;\n        top: 10px;\n        left: 0;\n        right: 0;\n        height: 40px;\n      }\n\n      .arm {\n        position: absolute;\n        width: 15px;\n        height: 40px;\n        background: #fdbcb4;\n        border-radius: 10px;\n      }\n\n      .arm.left {\n        left: -10px;\n        top: 10px;\n        transform: rotate(-20deg);\n      }\n\n      .arm.right {\n        right: -10px;\n        top: 10px;\n        transform: rotate(20deg);\n      }\n\n      /* Expression styles */\n      .expression-happy .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.8);\n      }\n\n      .expression-happy .avatar-lips {\n        transform: scaleY(1.2);\n      }\n\n      .expression-happy .cheek {\n        opacity: 1;\n      }\n\n      .expression-serious .avatar-eyes {\n        transform: translateX(-50%) scaleY(1.2);\n      }\n\n      .expression-serious .avatar-lips {\n        transform: scaleY(0.8);\n      }\n\n      .expression-thinking .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.6);\n      }\n\n      .expression-thinking .avatar-lips {\n        transform: scaleY(0.9);\n      }\n\n      /* Speaking animation */\n      .speaking .mouth-opening {\n        opacity: 1;\n        animation: mouth-move 0.1s ease-in-out infinite alternate;\n      }\n\n      @keyframes mouth-move {\n        0% { transform: translate(-50%, -50%) scaleY(1); }\n        100% { transform: translate(-50%, -50%) scaleY(1.5); }\n      }\n\n      /* Blinking animation */\n      .avatar-eye .eyelid {\n        animation: blink 4s infinite;\n      }\n\n      @keyframes blink {\n        0%, 90%, 100% { transform: scaleY(1); }\n        95% { transform: scaleY(0.1); }\n      }\n    `;\n    \n    document.head.appendChild(style);\n  }\n\n  /**\n   * Start speaking animation with audio\n   * @param {Blob} audioBlob - Audio blob to play\n   * @param {string} text - Text being spoken (for fallback)\n   */\n  async startSpeaking(audioBlob, text = '') {\n    if (this.isAnimating) {\n      await this.stopSpeaking();\n    }\n\n    this.isAnimating = true;\n    \n    // Add speaking class for CSS animations (2D only)\n    if (this.avatarElement && !this.use3DAvatar) {\n      this.avatarElement.classList.add('speaking');\n    }\n    \n    try {\n      if (this.use3DAvatar && readyPlayerMeService.isReady()) {\n        // Use 3D avatar with Ready Player Me\n        await this.playWith3DAvatar(audioBlob, text);\n      } else if (this.audioContext && audioBlob) {\n        // Use 2D avatar with lip sync\n        await this.playAudioWithLipSync(audioBlob);\n      } else {\n        // Fallback: animate based on text length\n        this.animateWithText(text);\n      }\n    } catch (error) {\n      console.error('Failed to start speaking animation:', error);\n      // Fallback animation\n      this.animateWithText(text);\n    }\n  }\n\n  /**\n   * Play audio with 3D Ready Player Me avatar\n   * @param {Blob} audioBlob - Audio blob to play\n   * @param {string} text - Text being spoken\n   */\n  async playWith3DAvatar(audioBlob, text) {\n    try {\n      // Create audio element from blob\n      const audioUrl = URL.createObjectURL(audioBlob);\n      const audio = new Audio(audioUrl);\n      \n      // Set up audio event handlers\n      audio.onended = () => {\n        URL.revokeObjectURL(audioUrl);\n        this.stopSpeaking();\n      };\n\n      audio.onerror = (e) => {\n        console.error('Audio playback error:', e);\n        URL.revokeObjectURL(audioUrl);\n        this.stopSpeaking();\n      };\n\n      // Play with lip sync using Ready Player Me\n      await readyPlayerMeService.playWithLipSync(audio);\n      \n    } catch (error) {\n      console.error('Failed to play with 3D avatar:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Play audio with real-time lip sync\n   * @param {Blob} audioBlob - Audio to play\n   */\n  async playAudioWithLipSync(audioBlob) {\n    try {\n      const arrayBuffer = await audioBlob.arrayBuffer();\n      const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n      \n      const source = this.audioContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(this.analyser);\n      this.analyser.connect(this.audioContext.destination);\n      \n      this.currentAudio = source;\n      \n      // Start lip sync animation\n      this.startLipSyncAnimation();\n      \n      // Play audio\n      source.start(0);\n      \n      // Stop animation when audio ends\n      source.onended = () => {\n        this.stopSpeaking();\n      };\n      \n    } catch (error) {\n      console.error('Audio playback failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Start lip sync animation based on audio frequency\n   */\n  startLipSyncAnimation() {\n    const animate = () => {\n      if (!this.isAnimating) return;\n      \n      this.analyser.getByteFrequencyData(this.dataArray);\n      \n      // Calculate more sophisticated audio analysis\n      const average = this.dataArray.reduce((a, b) => a + b) / this.dataArray.length;\n      const max = Math.max(...this.dataArray);\n      const min = Math.min(...this.dataArray);\n      \n      // Normalize to 0-1 with better scaling\n      const normalized = Math.min(1, (average + (max - min) * 0.3) / 255);\n      \n      // Apply mouth animation with more realistic movement\n      this.animateMouth(normalized);\n      \n      this.animationFrame = requestAnimationFrame(animate);\n    };\n    \n    animate();\n  }\n\n  /**\n   * Animate mouth based on audio intensity\n   * @param {number} intensity - Audio intensity (0-1)\n   */\n  animateMouth(intensity) {\n    const lips = this.avatarElement?.querySelector('.avatar-lips');\n    const mouthOpening = this.avatarElement?.querySelector('.mouth-opening');\n    if (!lips || !mouthOpening) return;\n    \n    // More realistic mouth movement\n    const scale = 1 + (intensity * 0.8);\n    const mouthScale = 0.5 + (intensity * 1.5);\n    \n    // Animate lips\n    lips.style.transform = `scaleY(${scale})`;\n    \n    // Animate mouth opening\n    mouthOpening.style.transform = `translate(-50%, -50%) scaleY(${mouthScale})`;\n    mouthOpening.style.opacity = Math.min(1, intensity * 2);\n    \n    // Add some randomness for natural movement\n    const randomOffset = (Math.random() - 0.5) * 0.2;\n    lips.style.transform += ` translateY(${randomOffset}px)`;\n  }\n\n  /**\n   * Fallback animation based on text length\n   * @param {string} text - Text to animate for\n   */\n  animateWithText(text) {\n    const duration = Math.max(text.length * 100, 2000); // 100ms per character, min 2s\n    \n    this.animateMouth(0.5); // Medium intensity\n    \n    setTimeout(() => {\n      this.stopSpeaking();\n    }, duration);\n  }\n\n  /**\n   * Stop speaking animation\n   */\n  async stopSpeaking() {\n    this.isAnimating = false;\n    \n    // Stop 3D avatar lip sync\n    if (this.use3DAvatar && readyPlayerMeService.isReady()) {\n      readyPlayerMeService.stopLipSync();\n    }\n    \n    // Remove speaking class (2D only)\n    if (this.avatarElement && !this.use3DAvatar) {\n      this.avatarElement.classList.remove('speaking');\n    }\n    \n    if (this.currentAudio) {\n      this.currentAudio.stop();\n      this.currentAudio = null;\n    }\n    \n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n    }\n    \n    // Reset mouth to neutral position (2D only)\n    if (!this.use3DAvatar) {\n      const lips = this.avatarElement?.querySelector('.avatar-lips');\n      if (lips) {\n        lips.style.transform = 'scaleY(1) translateY(0px)';\n      }\n    }\n  }\n\n  /**\n   * Set avatar expression\n   * @param {string} expression - Expression type (happy, serious, thinking, etc.)\n   */\n  setExpression(expression) {\n    if (this.use3DAvatar && readyPlayerMeService.isReady()) {\n      // Use 3D avatar expression\n      readyPlayerMeService.setExpression(expression);\n    } else if (this.avatarElement) {\n      // Use 2D avatar expression\n      // Remove previous expression classes\n      this.avatarElement.classList.remove('expression-happy', 'expression-serious', 'expression-thinking');\n      \n      // Add new expression class\n      this.avatarElement.classList.add(`expression-${expression}`);\n      \n      // Update visual elements based on expression\n      this.updateExpressionVisuals(expression);\n    }\n  }\n\n  /**\n   * Update visual elements for expression\n   * @param {string} expression - Expression type\n   */\n  updateExpressionVisuals(expression) {\n    const eyes = this.avatarElement?.querySelector('.avatar-eyes');\n    const mouth = this.avatarElement?.querySelector('.avatar-mouth');\n    \n    if (!eyes || !mouth) return;\n    \n    switch (expression) {\n      case 'happy':\n        eyes.style.transform = 'scaleY(0.8)';\n        mouth.style.transform = 'scaleY(1.2)';\n        break;\n      case 'serious':\n        eyes.style.transform = 'scaleY(1.2)';\n        mouth.style.transform = 'scaleY(0.8)';\n        break;\n      case 'thinking':\n        eyes.style.transform = 'scaleY(0.6)';\n        mouth.style.transform = 'scaleY(0.9)';\n        break;\n      default:\n        eyes.style.transform = 'scaleY(1)';\n        mouth.style.transform = 'scaleY(1)';\n    }\n  }\n\n  /**\n   * Create avatar visual elements (2D fallback)\n   */\n  createAvatarVisuals() {\n    if (!this.avatarElement) return;\n\n    // Create talking head elements with more detailed structure\n    this.avatarElement.innerHTML = `\n      <div class=\"avatar-container\">\n        <div class=\"avatar-head\">\n          <div class=\"avatar-face\">\n            <div class=\"avatar-eyes\">\n              <div class=\"avatar-eye left\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n              <div class=\"avatar-eye right\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-nose\"></div>\n            <div class=\"avatar-mouth\">\n              <div class=\"avatar-lips\">\n                <div class=\"upper-lip\"></div>\n                <div class=\"lower-lip\"></div>\n                <div class=\"mouth-opening\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-cheeks\">\n              <div class=\"cheek left\"></div>\n              <div class=\"cheek right\"></div>\n            </div>\n          </div>\n          <div class=\"avatar-hair\"></div>\n        </div>\n        <div class=\"avatar-body\">\n          <div class=\"avatar-torso\"></div>\n          <div class=\"avatar-arms\">\n            <div class=\"arm left\"></div>\n            <div class=\"arm right\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add CSS classes for styling\n    this.avatarElement.classList.add('avatar-interviewer');\n    \n    // Add the CSS styles\n    this.addAvatarStyles();\n  }\n\n  /**\n   * Cleanup resources\n   */\n  destroy() {\n    this.stopSpeaking();\n    \n    // Cleanup 3D avatar\n    if (this.use3DAvatar) {\n      readyPlayerMeService.destroy();\n    }\n    \n    if (this.audioContext) {\n      this.audioContext.close();\n      this.audioContext = null;\n    }\n    \n    this.avatarElement = null;\n  }\n}\n\n// Global instance\nexport const avatarService = new AvatarService();\n\n\n"],"mappings":"AAAA,SAASA,oBAAoB,QAAQ,wBAAwB;;AAE7D;AACA;AACA;AACA;AACA,OAAO,MAAMC,aAAa,CAAC;EACzBC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,aAAa,GAAG,IAAI;IACzB,IAAI,CAACC,WAAW,GAAG,KAAK;IACxB,IAAI,CAACC,YAAY,GAAG,IAAI;IACxB,IAAI,CAACC,YAAY,GAAG,IAAI;IACxB,IAAI,CAACC,QAAQ,GAAG,IAAI;IACpB,IAAI,CAACC,SAAS,GAAG,IAAI;IACrB,IAAI,CAACC,cAAc,GAAG,IAAI;IAC1B,IAAI,CAACC,WAAW,GAAG,IAAI,CAAC,CAAC;EAC3B;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMC,UAAUA,CAACR,aAAa,EAAES,KAAK,GAAG,IAAI,EAAE;IAC5C,IAAI,CAACT,aAAa,GAAGA,aAAa;IAClC,IAAI,CAACO,WAAW,GAAGE,KAAK;IAExB,IAAIA,KAAK,EAAE;MACT;MACA,MAAMC,OAAO,GAAG,MAAMb,oBAAoB,CAACW,UAAU,CAAC,kBAAkB,CAAC;MACzE,IAAI,CAACE,OAAO,EAAE;QACZC,OAAO,CAACC,IAAI,CAAC,oDAAoD,CAAC;QAClE,IAAI,CAACL,WAAW,GAAG,KAAK;QACxB,IAAI,CAACM,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACC,mBAAmB,CAAC,CAAC;MAC5B;IACF,CAAC,MAAM;MACL;MACA,IAAI,CAACD,iBAAiB,CAAC,CAAC;MACxB,IAAI,CAACC,mBAAmB,CAAC,CAAC;IAC5B;EACF;;EAEA;AACF;AACA;EACED,iBAAiBA,CAAA,EAAG;IAClB,IAAI;MACF,IAAI,CAACV,YAAY,GAAG,KAAKY,MAAM,CAACC,YAAY,IAAID,MAAM,CAACE,kBAAkB,EAAE,CAAC;MAC5E,IAAI,CAACb,QAAQ,GAAG,IAAI,CAACD,YAAY,CAACe,cAAc,CAAC,CAAC;MAClD,IAAI,CAACd,QAAQ,CAACe,OAAO,GAAG,GAAG;MAC3B,IAAI,CAACd,SAAS,GAAG,IAAIe,UAAU,CAAC,IAAI,CAAChB,QAAQ,CAACiB,iBAAiB,CAAC;IAClE,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdX,OAAO,CAACC,IAAI,CAAC,uDAAuD,CAAC;IACvE;EACF;;EAEA;AACF;AACA;EACEE,mBAAmBA,CAAA,EAAG;IACpB,IAAI,CAAC,IAAI,CAACd,aAAa,EAAE;;IAEzB;IACA,IAAI,CAACA,aAAa,CAACuB,SAAS,GAAG;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;IAED;IACA,IAAI,CAACvB,aAAa,CAACwB,SAAS,CAACC,GAAG,CAAC,oBAAoB,CAAC;;IAEtD;IACA,IAAI,CAACC,eAAe,CAAC,CAAC;EACxB;;EAEA;AACF;AACA;EACEA,eAAeA,CAAA,EAAG;IAChB,IAAIC,QAAQ,CAACC,cAAc,CAAC,eAAe,CAAC,EAAE;IAE9C,MAAMC,KAAK,GAAGF,QAAQ,CAACG,aAAa,CAAC,OAAO,CAAC;IAC7CD,KAAK,CAACE,EAAE,GAAG,eAAe;IAC1BF,KAAK,CAACG,WAAW,GAAG;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;IAEDL,QAAQ,CAACM,IAAI,CAACC,WAAW,CAACL,KAAK,CAAC;EAClC;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMM,aAAaA,CAACC,SAAS,EAAEC,IAAI,GAAG,EAAE,EAAE;IACxC,IAAI,IAAI,CAACpC,WAAW,EAAE;MACpB,MAAM,IAAI,CAACqC,YAAY,CAAC,CAAC;IAC3B;IAEA,IAAI,CAACrC,WAAW,GAAG,IAAI;;IAEvB;IACA,IAAI,IAAI,CAACD,aAAa,IAAI,CAAC,IAAI,CAACO,WA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}