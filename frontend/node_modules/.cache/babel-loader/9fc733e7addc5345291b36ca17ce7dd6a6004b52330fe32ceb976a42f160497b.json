{"ast":null,"code":"/**\n * Avatar Service for managing AI interviewer avatar\n */export class AvatarService{constructor(){this.avatarElement=null;this.isAnimating=false;this.currentAudio=null;this.audioContext=null;this.analyser=null;this.dataArray=null;this.animationFrame=null;}/**\n   * Initialize avatar with DOM element\n   * @param {HTMLElement} avatarElement - Avatar DOM element\n   */initialize(avatarElement){this.avatarElement=avatarElement;this.setupAudioContext();this.createAvatarVisuals();}/**\n   * Setup Web Audio API context for real-time audio analysis\n   */setupAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)();this.analyser=this.audioContext.createAnalyser();this.analyser.fftSize=256;this.dataArray=new Uint8Array(this.analyser.frequencyBinCount);}catch(error){console.warn('Web Audio API not supported, using fallback animation');}}/**\n   * Create avatar visual elements\n   */createAvatarVisuals(){if(!this.avatarElement)return;// Create talking head elements with more detailed structure\nthis.avatarElement.innerHTML=\"\\n      <div class=\\\"avatar-container\\\">\\n        <div class=\\\"avatar-head\\\">\\n          <div class=\\\"avatar-face\\\">\\n            <div class=\\\"avatar-eyes\\\">\\n              <div class=\\\"avatar-eye left\\\">\\n                <div class=\\\"pupil\\\"></div>\\n                <div class=\\\"eyelid\\\"></div>\\n              </div>\\n              <div class=\\\"avatar-eye right\\\">\\n                <div class=\\\"pupil\\\"></div>\\n                <div class=\\\"eyelid\\\"></div>\\n              </div>\\n            </div>\\n            <div class=\\\"avatar-nose\\\"></div>\\n            <div class=\\\"avatar-mouth\\\">\\n              <div class=\\\"avatar-lips\\\">\\n                <div class=\\\"upper-lip\\\"></div>\\n                <div class=\\\"lower-lip\\\"></div>\\n                <div class=\\\"mouth-opening\\\"></div>\\n              </div>\\n            </div>\\n            <div class=\\\"avatar-cheeks\\\">\\n              <div class=\\\"cheek left\\\"></div>\\n              <div class=\\\"cheek right\\\"></div>\\n            </div>\\n          </div>\\n          <div class=\\\"avatar-hair\\\"></div>\\n        </div>\\n        <div class=\\\"avatar-body\\\">\\n          <div class=\\\"avatar-torso\\\"></div>\\n          <div class=\\\"avatar-arms\\\">\\n            <div class=\\\"arm left\\\"></div>\\n            <div class=\\\"arm right\\\"></div>\\n          </div>\\n        </div>\\n      </div>\\n    \";// Add CSS classes for styling\nthis.avatarElement.classList.add('avatar-interviewer');// Add the CSS styles\nthis.addAvatarStyles();}/**\n   * Add CSS styles for the avatar\n   */addAvatarStyles(){if(document.getElementById('avatar-styles'))return;const style=document.createElement('style');style.id='avatar-styles';style.textContent=\"\\n      .avatar-interviewer {\\n        position: relative;\\n        width: 100%;\\n        height: 100%;\\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\\n        border-radius: 20px;\\n        overflow: hidden;\\n        display: flex;\\n        align-items: center;\\n        justify-content: center;\\n        box-shadow: 0 10px 30px rgba(0,0,0,0.3);\\n      }\\n\\n      .avatar-container {\\n        position: relative;\\n        width: 200px;\\n        height: 250px;\\n        transform-style: preserve-3d;\\n        animation: float 3s ease-in-out infinite;\\n      }\\n\\n      @keyframes float {\\n        0%, 100% { transform: translateY(0px); }\\n        50% { transform: translateY(-10px); }\\n      }\\n\\n      .avatar-head {\\n        position: relative;\\n        width: 120px;\\n        height: 120px;\\n        background: #fdbcb4;\\n        border-radius: 50%;\\n        margin: 0 auto 20px;\\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\\n        transform-style: preserve-3d;\\n      }\\n\\n      .avatar-face {\\n        position: relative;\\n        width: 100%;\\n        height: 100%;\\n        border-radius: 50%;\\n        overflow: hidden;\\n      }\\n\\n      .avatar-eyes {\\n        position: absolute;\\n        top: 30px;\\n        left: 50%;\\n        transform: translateX(-50%);\\n        display: flex;\\n        gap: 20px;\\n      }\\n\\n      .avatar-eye {\\n        position: relative;\\n        width: 20px;\\n        height: 20px;\\n        background: white;\\n        border-radius: 50%;\\n        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\\n      }\\n\\n      .pupil {\\n        position: absolute;\\n        top: 50%;\\n        left: 50%;\\n        transform: translate(-50%, -50%);\\n        width: 12px;\\n        height: 12px;\\n        background: #333;\\n        border-radius: 50%;\\n        transition: all 0.1s ease;\\n      }\\n\\n      .eyelid {\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        width: 100%;\\n        height: 50%;\\n        background: #fdbcb4;\\n        border-radius: 50% 50% 0 0;\\n        transition: transform 0.1s ease;\\n      }\\n\\n      .avatar-nose {\\n        position: absolute;\\n        top: 50px;\\n        left: 50%;\\n        transform: translateX(-50%);\\n        width: 8px;\\n        height: 12px;\\n        background: #f4a5a5;\\n        border-radius: 50%;\\n      }\\n\\n      .avatar-mouth {\\n        position: absolute;\\n        top: 70px;\\n        left: 50%;\\n        transform: translateX(-50%);\\n        width: 40px;\\n        height: 20px;\\n      }\\n\\n      .avatar-lips {\\n        position: relative;\\n        width: 100%;\\n        height: 100%;\\n      }\\n\\n      .upper-lip, .lower-lip {\\n        position: absolute;\\n        width: 100%;\\n        height: 50%;\\n        background: #d63384;\\n        border-radius: 50%;\\n        transition: all 0.1s ease;\\n      }\\n\\n      .upper-lip {\\n        top: 0;\\n        border-radius: 50% 50% 0 0;\\n      }\\n\\n      .lower-lip {\\n        bottom: 0;\\n        border-radius: 0 0 50% 50%;\\n      }\\n\\n      .mouth-opening {\\n        position: absolute;\\n        top: 50%;\\n        left: 50%;\\n        transform: translate(-50%, -50%);\\n        width: 20px;\\n        height: 8px;\\n        background: #000;\\n        border-radius: 50%;\\n        opacity: 0;\\n        transition: all 0.1s ease;\\n      }\\n\\n      .avatar-cheeks {\\n        position: absolute;\\n        top: 50px;\\n        left: 0;\\n        right: 0;\\n        height: 30px;\\n      }\\n\\n      .cheek {\\n        position: absolute;\\n        top: 0;\\n        width: 20px;\\n        height: 20px;\\n        background: #ffb3ba;\\n        border-radius: 50%;\\n        opacity: 0;\\n        transition: opacity 0.3s ease;\\n      }\\n\\n      .cheek.left {\\n        left: 10px;\\n      }\\n\\n      .cheek.right {\\n        right: 10px;\\n      }\\n\\n      .avatar-hair {\\n        position: absolute;\\n        top: -10px;\\n        left: 50%;\\n        transform: translateX(-50%);\\n        width: 100px;\\n        height: 40px;\\n        background: #8b4513;\\n        border-radius: 50% 50% 0 0;\\n        z-index: -1;\\n      }\\n\\n      .avatar-body {\\n        position: relative;\\n        width: 80px;\\n        height: 100px;\\n        background: #4a90e2;\\n        border-radius: 20px;\\n        margin: 0 auto;\\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\\n      }\\n\\n      .avatar-torso {\\n        width: 100%;\\n        height: 60px;\\n        background: #4a90e2;\\n        border-radius: 20px 20px 10px 10px;\\n      }\\n\\n      .avatar-arms {\\n        position: absolute;\\n        top: 10px;\\n        left: 0;\\n        right: 0;\\n        height: 40px;\\n      }\\n\\n      .arm {\\n        position: absolute;\\n        width: 15px;\\n        height: 40px;\\n        background: #fdbcb4;\\n        border-radius: 10px;\\n      }\\n\\n      .arm.left {\\n        left: -10px;\\n        top: 10px;\\n        transform: rotate(-20deg);\\n      }\\n\\n      .arm.right {\\n        right: -10px;\\n        top: 10px;\\n        transform: rotate(20deg);\\n      }\\n\\n      /* Expression styles */\\n      .expression-happy .avatar-eyes {\\n        transform: translateX(-50%) scaleY(0.8);\\n      }\\n\\n      .expression-happy .avatar-lips {\\n        transform: scaleY(1.2);\\n      }\\n\\n      .expression-happy .cheek {\\n        opacity: 1;\\n      }\\n\\n      .expression-serious .avatar-eyes {\\n        transform: translateX(-50%) scaleY(1.2);\\n      }\\n\\n      .expression-serious .avatar-lips {\\n        transform: scaleY(0.8);\\n      }\\n\\n      .expression-thinking .avatar-eyes {\\n        transform: translateX(-50%) scaleY(0.6);\\n      }\\n\\n      .expression-thinking .avatar-lips {\\n        transform: scaleY(0.9);\\n      }\\n\\n      /* Speaking animation */\\n      .speaking .mouth-opening {\\n        opacity: 1;\\n        animation: mouth-move 0.1s ease-in-out infinite alternate;\\n      }\\n\\n      @keyframes mouth-move {\\n        0% { transform: translate(-50%, -50%) scaleY(1); }\\n        100% { transform: translate(-50%, -50%) scaleY(1.5); }\\n      }\\n\\n      /* Blinking animation */\\n      .avatar-eye .eyelid {\\n        animation: blink 4s infinite;\\n      }\\n\\n      @keyframes blink {\\n        0%, 90%, 100% { transform: scaleY(1); }\\n        95% { transform: scaleY(0.1); }\\n      }\\n    \";document.head.appendChild(style);}/**\n   * Start speaking animation with audio\n   * @param {Blob} audioBlob - Audio blob to play\n   * @param {string} text - Text being spoken (for fallback)\n   */async startSpeaking(audioBlob){let text=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';if(this.isAnimating){await this.stopSpeaking();}this.isAnimating=true;// Add speaking class for CSS animations\nif(this.avatarElement){this.avatarElement.classList.add('speaking');}try{if(this.audioContext&&audioBlob){await this.playAudioWithLipSync(audioBlob);}else{// Fallback: animate based on text length\nthis.animateWithText(text);}}catch(error){console.error('Failed to start speaking animation:',error);// Fallback animation\nthis.animateWithText(text);}}/**\n   * Play audio with real-time lip sync\n   * @param {Blob} audioBlob - Audio to play\n   */async playAudioWithLipSync(audioBlob){try{const arrayBuffer=await audioBlob.arrayBuffer();const audioBuffer=await this.audioContext.decodeAudioData(arrayBuffer);const source=this.audioContext.createBufferSource();source.buffer=audioBuffer;source.connect(this.analyser);this.analyser.connect(this.audioContext.destination);this.currentAudio=source;// Start lip sync animation\nthis.startLipSyncAnimation();// Play audio\nsource.start(0);// Stop animation when audio ends\nsource.onended=()=>{this.stopSpeaking();};}catch(error){console.error('Audio playback failed:',error);throw error;}}/**\n   * Start lip sync animation based on audio frequency\n   */startLipSyncAnimation(){const animate=()=>{if(!this.isAnimating)return;this.analyser.getByteFrequencyData(this.dataArray);// Calculate more sophisticated audio analysis\nconst average=this.dataArray.reduce((a,b)=>a+b)/this.dataArray.length;const max=Math.max(...this.dataArray);const min=Math.min(...this.dataArray);// Normalize to 0-1 with better scaling\nconst normalized=Math.min(1,(average+(max-min)*0.3)/255);// Apply mouth animation with more realistic movement\nthis.animateMouth(normalized);this.animationFrame=requestAnimationFrame(animate);};animate();}/**\n   * Animate mouth based on audio intensity\n   * @param {number} intensity - Audio intensity (0-1)\n   */animateMouth(intensity){var _this$avatarElement,_this$avatarElement2;const lips=(_this$avatarElement=this.avatarElement)===null||_this$avatarElement===void 0?void 0:_this$avatarElement.querySelector('.avatar-lips');const mouthOpening=(_this$avatarElement2=this.avatarElement)===null||_this$avatarElement2===void 0?void 0:_this$avatarElement2.querySelector('.mouth-opening');if(!lips||!mouthOpening)return;// More realistic mouth movement\nconst scale=1+intensity*0.8;const mouthScale=0.5+intensity*1.5;// Animate lips\nlips.style.transform=\"scaleY(\".concat(scale,\")\");// Animate mouth opening\nmouthOpening.style.transform=\"translate(-50%, -50%) scaleY(\".concat(mouthScale,\")\");mouthOpening.style.opacity=Math.min(1,intensity*2);// Add some randomness for natural movement\nconst randomOffset=(Math.random()-0.5)*0.2;lips.style.transform+=\" translateY(\".concat(randomOffset,\"px)\");}/**\n   * Fallback animation based on text length\n   * @param {string} text - Text to animate for\n   */animateWithText(text){const duration=Math.max(text.length*100,2000);// 100ms per character, min 2s\nthis.animateMouth(0.5);// Medium intensity\nsetTimeout(()=>{this.stopSpeaking();},duration);}/**\n   * Stop speaking animation\n   */async stopSpeaking(){var _this$avatarElement3;this.isAnimating=false;// Remove speaking class\nif(this.avatarElement){this.avatarElement.classList.remove('speaking');}if(this.currentAudio){this.currentAudio.stop();this.currentAudio=null;}if(this.animationFrame){cancelAnimationFrame(this.animationFrame);this.animationFrame=null;}// Reset mouth to neutral position\nconst lips=(_this$avatarElement3=this.avatarElement)===null||_this$avatarElement3===void 0?void 0:_this$avatarElement3.querySelector('.avatar-lips');if(lips){lips.style.transform='scaleY(1) translateY(0px)';}}/**\n   * Set avatar expression\n   * @param {string} expression - Expression type (happy, serious, thinking, etc.)\n   */setExpression(expression){if(!this.avatarElement)return;// Remove previous expression classes\nthis.avatarElement.classList.remove('expression-happy','expression-serious','expression-thinking');// Add new expression class\nthis.avatarElement.classList.add(\"expression-\".concat(expression));// Update visual elements based on expression\nthis.updateExpressionVisuals(expression);}/**\n   * Update visual elements for expression\n   * @param {string} expression - Expression type\n   */updateExpressionVisuals(expression){var _this$avatarElement4,_this$avatarElement5;const eyes=(_this$avatarElement4=this.avatarElement)===null||_this$avatarElement4===void 0?void 0:_this$avatarElement4.querySelector('.avatar-eyes');const mouth=(_this$avatarElement5=this.avatarElement)===null||_this$avatarElement5===void 0?void 0:_this$avatarElement5.querySelector('.avatar-mouth');if(!eyes||!mouth)return;switch(expression){case'happy':eyes.style.transform='scaleY(0.8)';mouth.style.transform='scaleY(1.2)';break;case'serious':eyes.style.transform='scaleY(1.2)';mouth.style.transform='scaleY(0.8)';break;case'thinking':eyes.style.transform='scaleY(0.6)';mouth.style.transform='scaleY(0.9)';break;default:eyes.style.transform='scaleY(1)';mouth.style.transform='scaleY(1)';}}/**\n   * Cleanup resources\n   */destroy(){this.stopSpeaking();if(this.audioContext){this.audioContext.close();this.audioContext=null;}this.avatarElement=null;}}// Global instance\nexport const avatarService=new AvatarService();","map":{"version":3,"names":["AvatarService","constructor","avatarElement","isAnimating","currentAudio","audioContext","analyser","dataArray","animationFrame","initialize","setupAudioContext","createAvatarVisuals","window","AudioContext","webkitAudioContext","createAnalyser","fftSize","Uint8Array","frequencyBinCount","error","console","warn","innerHTML","classList","add","addAvatarStyles","document","getElementById","style","createElement","id","textContent","head","appendChild","startSpeaking","audioBlob","text","arguments","length","undefined","stopSpeaking","playAudioWithLipSync","animateWithText","arrayBuffer","audioBuffer","decodeAudioData","source","createBufferSource","buffer","connect","destination","startLipSyncAnimation","start","onended","animate","getByteFrequencyData","average","reduce","a","b","max","Math","min","normalized","animateMouth","requestAnimationFrame","intensity","_this$avatarElement","_this$avatarElement2","lips","querySelector","mouthOpening","scale","mouthScale","transform","concat","opacity","randomOffset","random","duration","setTimeout","_this$avatarElement3","remove","stop","cancelAnimationFrame","setExpression","expression","updateExpressionVisuals","_this$avatarElement4","_this$avatarElement5","eyes","mouth","destroy","close","avatarService"],"sources":["D:/ai_avatar/frontend/src/services/avatarService.js"],"sourcesContent":["/**\n * Avatar Service for managing AI interviewer avatar\n */\nexport class AvatarService {\n  constructor() {\n    this.avatarElement = null;\n    this.isAnimating = false;\n    this.currentAudio = null;\n    this.audioContext = null;\n    this.analyser = null;\n    this.dataArray = null;\n    this.animationFrame = null;\n  }\n\n  /**\n   * Initialize avatar with DOM element\n   * @param {HTMLElement} avatarElement - Avatar DOM element\n   */\n  initialize(avatarElement) {\n    this.avatarElement = avatarElement;\n    this.setupAudioContext();\n    this.createAvatarVisuals();\n  }\n\n  /**\n   * Setup Web Audio API context for real-time audio analysis\n   */\n  setupAudioContext() {\n    try {\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 256;\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n    } catch (error) {\n      console.warn('Web Audio API not supported, using fallback animation');\n    }\n  }\n\n  /**\n   * Create avatar visual elements\n   */\n  createAvatarVisuals() {\n    if (!this.avatarElement) return;\n\n    // Create talking head elements with more detailed structure\n    this.avatarElement.innerHTML = `\n      <div class=\"avatar-container\">\n        <div class=\"avatar-head\">\n          <div class=\"avatar-face\">\n            <div class=\"avatar-eyes\">\n              <div class=\"avatar-eye left\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n              <div class=\"avatar-eye right\">\n                <div class=\"pupil\"></div>\n                <div class=\"eyelid\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-nose\"></div>\n            <div class=\"avatar-mouth\">\n              <div class=\"avatar-lips\">\n                <div class=\"upper-lip\"></div>\n                <div class=\"lower-lip\"></div>\n                <div class=\"mouth-opening\"></div>\n              </div>\n            </div>\n            <div class=\"avatar-cheeks\">\n              <div class=\"cheek left\"></div>\n              <div class=\"cheek right\"></div>\n            </div>\n          </div>\n          <div class=\"avatar-hair\"></div>\n        </div>\n        <div class=\"avatar-body\">\n          <div class=\"avatar-torso\"></div>\n          <div class=\"avatar-arms\">\n            <div class=\"arm left\"></div>\n            <div class=\"arm right\"></div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    // Add CSS classes for styling\n    this.avatarElement.classList.add('avatar-interviewer');\n    \n    // Add the CSS styles\n    this.addAvatarStyles();\n  }\n\n  /**\n   * Add CSS styles for the avatar\n   */\n  addAvatarStyles() {\n    if (document.getElementById('avatar-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'avatar-styles';\n    style.textContent = `\n      .avatar-interviewer {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        border-radius: 20px;\n        overflow: hidden;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n      }\n\n      .avatar-container {\n        position: relative;\n        width: 200px;\n        height: 250px;\n        transform-style: preserve-3d;\n        animation: float 3s ease-in-out infinite;\n      }\n\n      @keyframes float {\n        0%, 100% { transform: translateY(0px); }\n        50% { transform: translateY(-10px); }\n      }\n\n      .avatar-head {\n        position: relative;\n        width: 120px;\n        height: 120px;\n        background: #fdbcb4;\n        border-radius: 50%;\n        margin: 0 auto 20px;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n        transform-style: preserve-3d;\n      }\n\n      .avatar-face {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n        overflow: hidden;\n      }\n\n      .avatar-eyes {\n        position: absolute;\n        top: 30px;\n        left: 50%;\n        transform: translateX(-50%);\n        display: flex;\n        gap: 20px;\n      }\n\n      .avatar-eye {\n        position: relative;\n        width: 20px;\n        height: 20px;\n        background: white;\n        border-radius: 50%;\n        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);\n      }\n\n      .pupil {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 12px;\n        height: 12px;\n        background: #333;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .eyelid {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 50%;\n        background: #fdbcb4;\n        border-radius: 50% 50% 0 0;\n        transition: transform 0.1s ease;\n      }\n\n      .avatar-nose {\n        position: absolute;\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 8px;\n        height: 12px;\n        background: #f4a5a5;\n        border-radius: 50%;\n      }\n\n      .avatar-mouth {\n        position: absolute;\n        top: 70px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 40px;\n        height: 20px;\n      }\n\n      .avatar-lips {\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      .upper-lip, .lower-lip {\n        position: absolute;\n        width: 100%;\n        height: 50%;\n        background: #d63384;\n        border-radius: 50%;\n        transition: all 0.1s ease;\n      }\n\n      .upper-lip {\n        top: 0;\n        border-radius: 50% 50% 0 0;\n      }\n\n      .lower-lip {\n        bottom: 0;\n        border-radius: 0 0 50% 50%;\n      }\n\n      .mouth-opening {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        width: 20px;\n        height: 8px;\n        background: #000;\n        border-radius: 50%;\n        opacity: 0;\n        transition: all 0.1s ease;\n      }\n\n      .avatar-cheeks {\n        position: absolute;\n        top: 50px;\n        left: 0;\n        right: 0;\n        height: 30px;\n      }\n\n      .cheek {\n        position: absolute;\n        top: 0;\n        width: 20px;\n        height: 20px;\n        background: #ffb3ba;\n        border-radius: 50%;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n      }\n\n      .cheek.left {\n        left: 10px;\n      }\n\n      .cheek.right {\n        right: 10px;\n      }\n\n      .avatar-hair {\n        position: absolute;\n        top: -10px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 100px;\n        height: 40px;\n        background: #8b4513;\n        border-radius: 50% 50% 0 0;\n        z-index: -1;\n      }\n\n      .avatar-body {\n        position: relative;\n        width: 80px;\n        height: 100px;\n        background: #4a90e2;\n        border-radius: 20px;\n        margin: 0 auto;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n      }\n\n      .avatar-torso {\n        width: 100%;\n        height: 60px;\n        background: #4a90e2;\n        border-radius: 20px 20px 10px 10px;\n      }\n\n      .avatar-arms {\n        position: absolute;\n        top: 10px;\n        left: 0;\n        right: 0;\n        height: 40px;\n      }\n\n      .arm {\n        position: absolute;\n        width: 15px;\n        height: 40px;\n        background: #fdbcb4;\n        border-radius: 10px;\n      }\n\n      .arm.left {\n        left: -10px;\n        top: 10px;\n        transform: rotate(-20deg);\n      }\n\n      .arm.right {\n        right: -10px;\n        top: 10px;\n        transform: rotate(20deg);\n      }\n\n      /* Expression styles */\n      .expression-happy .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.8);\n      }\n\n      .expression-happy .avatar-lips {\n        transform: scaleY(1.2);\n      }\n\n      .expression-happy .cheek {\n        opacity: 1;\n      }\n\n      .expression-serious .avatar-eyes {\n        transform: translateX(-50%) scaleY(1.2);\n      }\n\n      .expression-serious .avatar-lips {\n        transform: scaleY(0.8);\n      }\n\n      .expression-thinking .avatar-eyes {\n        transform: translateX(-50%) scaleY(0.6);\n      }\n\n      .expression-thinking .avatar-lips {\n        transform: scaleY(0.9);\n      }\n\n      /* Speaking animation */\n      .speaking .mouth-opening {\n        opacity: 1;\n        animation: mouth-move 0.1s ease-in-out infinite alternate;\n      }\n\n      @keyframes mouth-move {\n        0% { transform: translate(-50%, -50%) scaleY(1); }\n        100% { transform: translate(-50%, -50%) scaleY(1.5); }\n      }\n\n      /* Blinking animation */\n      .avatar-eye .eyelid {\n        animation: blink 4s infinite;\n      }\n\n      @keyframes blink {\n        0%, 90%, 100% { transform: scaleY(1); }\n        95% { transform: scaleY(0.1); }\n      }\n    `;\n    \n    document.head.appendChild(style);\n  }\n\n  /**\n   * Start speaking animation with audio\n   * @param {Blob} audioBlob - Audio blob to play\n   * @param {string} text - Text being spoken (for fallback)\n   */\n  async startSpeaking(audioBlob, text = '') {\n    if (this.isAnimating) {\n      await this.stopSpeaking();\n    }\n\n    this.isAnimating = true;\n    \n    // Add speaking class for CSS animations\n    if (this.avatarElement) {\n      this.avatarElement.classList.add('speaking');\n    }\n    \n    try {\n      if (this.audioContext && audioBlob) {\n        await this.playAudioWithLipSync(audioBlob);\n      } else {\n        // Fallback: animate based on text length\n        this.animateWithText(text);\n      }\n    } catch (error) {\n      console.error('Failed to start speaking animation:', error);\n      // Fallback animation\n      this.animateWithText(text);\n    }\n  }\n\n  /**\n   * Play audio with real-time lip sync\n   * @param {Blob} audioBlob - Audio to play\n   */\n  async playAudioWithLipSync(audioBlob) {\n    try {\n      const arrayBuffer = await audioBlob.arrayBuffer();\n      const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);\n      \n      const source = this.audioContext.createBufferSource();\n      source.buffer = audioBuffer;\n      source.connect(this.analyser);\n      this.analyser.connect(this.audioContext.destination);\n      \n      this.currentAudio = source;\n      \n      // Start lip sync animation\n      this.startLipSyncAnimation();\n      \n      // Play audio\n      source.start(0);\n      \n      // Stop animation when audio ends\n      source.onended = () => {\n        this.stopSpeaking();\n      };\n      \n    } catch (error) {\n      console.error('Audio playback failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Start lip sync animation based on audio frequency\n   */\n  startLipSyncAnimation() {\n    const animate = () => {\n      if (!this.isAnimating) return;\n      \n      this.analyser.getByteFrequencyData(this.dataArray);\n      \n      // Calculate more sophisticated audio analysis\n      const average = this.dataArray.reduce((a, b) => a + b) / this.dataArray.length;\n      const max = Math.max(...this.dataArray);\n      const min = Math.min(...this.dataArray);\n      \n      // Normalize to 0-1 with better scaling\n      const normalized = Math.min(1, (average + (max - min) * 0.3) / 255);\n      \n      // Apply mouth animation with more realistic movement\n      this.animateMouth(normalized);\n      \n      this.animationFrame = requestAnimationFrame(animate);\n    };\n    \n    animate();\n  }\n\n  /**\n   * Animate mouth based on audio intensity\n   * @param {number} intensity - Audio intensity (0-1)\n   */\n  animateMouth(intensity) {\n    const lips = this.avatarElement?.querySelector('.avatar-lips');\n    const mouthOpening = this.avatarElement?.querySelector('.mouth-opening');\n    if (!lips || !mouthOpening) return;\n    \n    // More realistic mouth movement\n    const scale = 1 + (intensity * 0.8);\n    const mouthScale = 0.5 + (intensity * 1.5);\n    \n    // Animate lips\n    lips.style.transform = `scaleY(${scale})`;\n    \n    // Animate mouth opening\n    mouthOpening.style.transform = `translate(-50%, -50%) scaleY(${mouthScale})`;\n    mouthOpening.style.opacity = Math.min(1, intensity * 2);\n    \n    // Add some randomness for natural movement\n    const randomOffset = (Math.random() - 0.5) * 0.2;\n    lips.style.transform += ` translateY(${randomOffset}px)`;\n  }\n\n  /**\n   * Fallback animation based on text length\n   * @param {string} text - Text to animate for\n   */\n  animateWithText(text) {\n    const duration = Math.max(text.length * 100, 2000); // 100ms per character, min 2s\n    \n    this.animateMouth(0.5); // Medium intensity\n    \n    setTimeout(() => {\n      this.stopSpeaking();\n    }, duration);\n  }\n\n  /**\n   * Stop speaking animation\n   */\n  async stopSpeaking() {\n    this.isAnimating = false;\n    \n    // Remove speaking class\n    if (this.avatarElement) {\n      this.avatarElement.classList.remove('speaking');\n    }\n    \n    if (this.currentAudio) {\n      this.currentAudio.stop();\n      this.currentAudio = null;\n    }\n    \n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n    }\n    \n    // Reset mouth to neutral position\n    const lips = this.avatarElement?.querySelector('.avatar-lips');\n    if (lips) {\n      lips.style.transform = 'scaleY(1) translateY(0px)';\n    }\n  }\n\n  /**\n   * Set avatar expression\n   * @param {string} expression - Expression type (happy, serious, thinking, etc.)\n   */\n  setExpression(expression) {\n    if (!this.avatarElement) return;\n    \n    // Remove previous expression classes\n    this.avatarElement.classList.remove('expression-happy', 'expression-serious', 'expression-thinking');\n    \n    // Add new expression class\n    this.avatarElement.classList.add(`expression-${expression}`);\n    \n    // Update visual elements based on expression\n    this.updateExpressionVisuals(expression);\n  }\n\n  /**\n   * Update visual elements for expression\n   * @param {string} expression - Expression type\n   */\n  updateExpressionVisuals(expression) {\n    const eyes = this.avatarElement?.querySelector('.avatar-eyes');\n    const mouth = this.avatarElement?.querySelector('.avatar-mouth');\n    \n    if (!eyes || !mouth) return;\n    \n    switch (expression) {\n      case 'happy':\n        eyes.style.transform = 'scaleY(0.8)';\n        mouth.style.transform = 'scaleY(1.2)';\n        break;\n      case 'serious':\n        eyes.style.transform = 'scaleY(1.2)';\n        mouth.style.transform = 'scaleY(0.8)';\n        break;\n      case 'thinking':\n        eyes.style.transform = 'scaleY(0.6)';\n        mouth.style.transform = 'scaleY(0.9)';\n        break;\n      default:\n        eyes.style.transform = 'scaleY(1)';\n        mouth.style.transform = 'scaleY(1)';\n    }\n  }\n\n  /**\n   * Cleanup resources\n   */\n  destroy() {\n    this.stopSpeaking();\n    \n    if (this.audioContext) {\n      this.audioContext.close();\n      this.audioContext = null;\n    }\n    \n    this.avatarElement = null;\n  }\n}\n\n// Global instance\nexport const avatarService = new AvatarService();\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}