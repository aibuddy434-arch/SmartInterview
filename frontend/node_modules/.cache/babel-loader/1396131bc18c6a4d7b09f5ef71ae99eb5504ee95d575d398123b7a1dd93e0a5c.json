{"ast":null,"code":"/**\r\n * Utility functions for consistent error handling across the application\r\n */\n\n/**\r\n * Safely extracts error message from various error response formats\r\n * @param {Error} error - The error object from try/catch\r\n * @param {string} fallbackMessage - Default message if no error details found\r\n * @returns {string} - Safe error message to display to user\r\n */\nexport const getErrorMessage = (error, fallbackMessage = 'An unexpected error occurred') => {\n  var _error$response;\n  if (!error) return fallbackMessage;\n\n  // Check for Axios response error\n  if ((_error$response = error.response) !== null && _error$response !== void 0 && _error$response.data) {\n    const data = error.response.data;\n\n    // New standardized error format: { \"success\": false, \"message\": \"...\", \"error\": \"...\" }\n    if (data.success === false) {\n      return data.message || data.error || fallbackMessage;\n    }\n\n    // FastAPI error format: { \"detail\": \"...\" }\n    if (data.detail) return data.detail;\n\n    // Custom error format: { \"error\": \"...\" }\n    if (data.error) return data.error;\n\n    // Multiple errors format: { \"errors\": [...] }\n    if (data.errors && Array.isArray(data.errors)) {\n      return data.errors.join(', ');\n    }\n\n    // Message format: { \"message\": \"...\" }\n    if (data.message) return data.message;\n  }\n\n  // Check for network error\n  if (error.message) return error.message;\n\n  // Check for custom error properties\n  if (error.error) return error.error;\n  return fallbackMessage;\n};\n\n/**\r\n * Safely checks if a response object has the expected structure\r\n * @param {any} response - The response object to validate\r\n * @param {string[]} requiredFields - Array of required field paths (e.g., ['candidate.id', 'session_id'])\r\n * @returns {boolean} - True if response has all required fields\r\n */\nexport const validateResponse = (response, requiredFields = []) => {\n  if (!response || typeof response !== 'object') return false;\n  return requiredFields.every(field => {\n    const fieldPath = field.split('.');\n    let current = response;\n    for (const key of fieldPath) {\n      if (current && typeof current === 'object' && key in current) {\n        current = current[key];\n      } else {\n        return false;\n      }\n    }\n    return current !== null && current !== undefined;\n  });\n};\n\n/**\r\n * Safely extracts data from response with validation\r\n * @param {any} response - The response object\r\n * @param {string[]} requiredFields - Array of required field paths\r\n * @param {string} errorMessage - Error message if validation fails\r\n * @returns {Object} - { success: boolean, data: any, error: string }\r\n */\nexport const safeResponseHandler = (response, requiredFields = [], errorMessage = 'Invalid response from server') => {\n  // Check if response has the new standardized format\n  if (response && typeof response === 'object' && 'success' in response) {\n    if (response.success === true) {\n      // For success responses, validate required fields in the data\n      if (requiredFields.length > 0 && response.data) {\n        if (validateResponse(response.data, requiredFields)) {\n          return {\n            success: true,\n            data: response.data,\n            error: null\n          };\n        } else {\n          console.error('Response data validation failed:', response.data);\n          return {\n            success: false,\n            data: null,\n            error: errorMessage\n          };\n        }\n      }\n      return {\n        success: true,\n        data: response.data,\n        error: null\n      };\n    } else {\n      // For error responses, extract the error message\n      return {\n        success: false,\n        data: null,\n        error: response.message || response.error || errorMessage\n      };\n    }\n  }\n\n  // Fallback to old validation for backward compatibility\n  if (validateResponse(response, requiredFields)) {\n    return {\n      success: true,\n      data: response\n    };\n  } else {\n    console.error('Response validation failed:', response);\n    return {\n      success: false,\n      data: null,\n      error: errorMessage\n    };\n  }\n};\n\n/**\r\n * Wrapper for API calls with consistent error handling\r\n * @param {Function} apiCall - The API function to call\r\n * @param {string} fallbackMessage - Default error message\r\n * @returns {Promise<Object>} - { success: boolean, data: any, error: string }\r\n */\nexport const safeApiCall = async (apiCall, fallbackMessage = 'API call failed') => {\n  try {\n    const response = await apiCall();\n\n    // Check if response has the new standardized format\n    if (response && typeof response === 'object' && 'success' in response) {\n      if (response.success === true) {\n        return {\n          success: true,\n          data: response.data,\n          error: null\n        };\n      } else {\n        return {\n          success: false,\n          data: null,\n          error: response.message || response.error || fallbackMessage\n        };\n      }\n    }\n\n    // Fallback for old format\n    return {\n      success: true,\n      data: response,\n      error: null\n    };\n  } catch (error) {\n    const errorMessage = getErrorMessage(error, fallbackMessage);\n    console.error('API call failed:', error);\n    return {\n      success: false,\n      data: null,\n      error: errorMessage\n    };\n  }\n};\n\n/**\r\n * Wrapper for API calls with response validation\r\n * @param {Function} apiCall - The API function to call\r\n * @param {string[]} requiredFields - Array of required field paths\r\n * @param {string} fallbackMessage - Default error message\r\n * @returns {Promise<Object>} - { success: boolean, data: any, error: string }\r\n */\nexport const safeApiCallWithValidation = async (apiCall, requiredFields = [], fallbackMessage = 'API call failed') => {\n  try {\n    const response = await apiCall();\n\n    // Check if response has the new standardized format\n    if (response && typeof response === 'object' && 'success' in response) {\n      if (response.success === true) {\n        // For success responses, validate required fields in the data\n        if (requiredFields.length > 0 && response.data) {\n          if (validateResponse(response.data, requiredFields)) {\n            return {\n              success: true,\n              data: response.data,\n              error: null\n            };\n          } else {\n            console.error('Response data validation failed:', response.data);\n            return {\n              success: false,\n              data: null,\n              error: fallbackMessage\n            };\n          }\n        }\n        return {\n          success: true,\n          data: response.data,\n          error: null\n        };\n      } else {\n        // For error responses, extract the error message\n        return {\n          success: false,\n          data: null,\n          error: response.message || response.error || fallbackMessage\n        };\n      }\n    }\n\n    // Fallback to old validation for backward compatibility\n    return safeResponseHandler(response, requiredFields, fallbackMessage);\n  } catch (error) {\n    const errorMessage = getErrorMessage(error, fallbackMessage);\n    console.error('API call failed:', error);\n    return {\n      success: false,\n      data: null,\n      error: errorMessage\n    };\n  }\n};","map":{"version":3,"names":["getErrorMessage","error","fallbackMessage","_error$response","response","data","success","message","detail","errors","Array","isArray","join","validateResponse","requiredFields","every","field","fieldPath","split","current","key","undefined","safeResponseHandler","errorMessage","length","console","safeApiCall","apiCall","safeApiCallWithValidation"],"sources":["D:/ai_avatar/frontend/src/utils/errorHandler.js"],"sourcesContent":["/**\r\n * Utility functions for consistent error handling across the application\r\n */\r\n\r\n/**\r\n * Safely extracts error message from various error response formats\r\n * @param {Error} error - The error object from try/catch\r\n * @param {string} fallbackMessage - Default message if no error details found\r\n * @returns {string} - Safe error message to display to user\r\n */\r\nexport const getErrorMessage = (error, fallbackMessage = 'An unexpected error occurred') => {\r\n  if (!error) return fallbackMessage;\r\n  \r\n  // Check for Axios response error\r\n  if (error.response?.data) {\r\n    const data = error.response.data;\r\n    \r\n    // New standardized error format: { \"success\": false, \"message\": \"...\", \"error\": \"...\" }\r\n    if (data.success === false) {\r\n      return data.message || data.error || fallbackMessage;\r\n    }\r\n    \r\n    // FastAPI error format: { \"detail\": \"...\" }\r\n    if (data.detail) return data.detail;\r\n    \r\n    // Custom error format: { \"error\": \"...\" }\r\n    if (data.error) return data.error;\r\n    \r\n    // Multiple errors format: { \"errors\": [...] }\r\n    if (data.errors && Array.isArray(data.errors)) {\r\n      return data.errors.join(', ');\r\n    }\r\n    \r\n    // Message format: { \"message\": \"...\" }\r\n    if (data.message) return data.message;\r\n  }\r\n  \r\n  // Check for network error\r\n  if (error.message) return error.message;\r\n  \r\n  // Check for custom error properties\r\n  if (error.error) return error.error;\r\n  \r\n  return fallbackMessage;\r\n};\r\n\r\n/**\r\n * Safely checks if a response object has the expected structure\r\n * @param {any} response - The response object to validate\r\n * @param {string[]} requiredFields - Array of required field paths (e.g., ['candidate.id', 'session_id'])\r\n * @returns {boolean} - True if response has all required fields\r\n */\r\nexport const validateResponse = (response, requiredFields = []) => {\r\n  if (!response || typeof response !== 'object') return false;\r\n  \r\n  return requiredFields.every(field => {\r\n    const fieldPath = field.split('.');\r\n    let current = response;\r\n    \r\n    for (const key of fieldPath) {\r\n      if (current && typeof current === 'object' && key in current) {\r\n        current = current[key];\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    \r\n    return current !== null && current !== undefined;\r\n  });\r\n};\r\n\r\n/**\r\n * Safely extracts data from response with validation\r\n * @param {any} response - The response object\r\n * @param {string[]} requiredFields - Array of required field paths\r\n * @param {string} errorMessage - Error message if validation fails\r\n * @returns {Object} - { success: boolean, data: any, error: string }\r\n */\r\nexport const safeResponseHandler = (response, requiredFields = [], errorMessage = 'Invalid response from server') => {\r\n  // Check if response has the new standardized format\r\n  if (response && typeof response === 'object' && 'success' in response) {\r\n    if (response.success === true) {\r\n      // For success responses, validate required fields in the data\r\n      if (requiredFields.length > 0 && response.data) {\r\n        if (validateResponse(response.data, requiredFields)) {\r\n          return { success: true, data: response.data, error: null };\r\n        } else {\r\n          console.error('Response data validation failed:', response.data);\r\n          return { success: false, data: null, error: errorMessage };\r\n        }\r\n      }\r\n      return { success: true, data: response.data, error: null };\r\n    } else {\r\n      // For error responses, extract the error message\r\n      return { \r\n        success: false, \r\n        data: null, \r\n        error: response.message || response.error || errorMessage \r\n      };\r\n    }\r\n  }\r\n  \r\n  // Fallback to old validation for backward compatibility\r\n  if (validateResponse(response, requiredFields)) {\r\n    return { success: true, data: response };\r\n  } else {\r\n    console.error('Response validation failed:', response);\r\n    return { success: false, data: null, error: errorMessage };\r\n  }\r\n};\r\n\r\n/**\r\n * Wrapper for API calls with consistent error handling\r\n * @param {Function} apiCall - The API function to call\r\n * @param {string} fallbackMessage - Default error message\r\n * @returns {Promise<Object>} - { success: boolean, data: any, error: string }\r\n */\r\nexport const safeApiCall = async (apiCall, fallbackMessage = 'API call failed') => {\r\n  try {\r\n    const response = await apiCall();\r\n    \r\n    // Check if response has the new standardized format\r\n    if (response && typeof response === 'object' && 'success' in response) {\r\n      if (response.success === true) {\r\n        return { success: true, data: response.data, error: null };\r\n      } else {\r\n        return { \r\n          success: false, \r\n          data: null, \r\n          error: response.message || response.error || fallbackMessage \r\n        };\r\n      }\r\n    }\r\n    \r\n    // Fallback for old format\r\n    return { success: true, data: response, error: null };\r\n  } catch (error) {\r\n    const errorMessage = getErrorMessage(error, fallbackMessage);\r\n    console.error('API call failed:', error);\r\n    return { success: false, data: null, error: errorMessage };\r\n  }\r\n};\r\n\r\n/**\r\n * Wrapper for API calls with response validation\r\n * @param {Function} apiCall - The API function to call\r\n * @param {string[]} requiredFields - Array of required field paths\r\n * @param {string} fallbackMessage - Default error message\r\n * @returns {Promise<Object>} - { success: boolean, data: any, error: string }\r\n */\r\nexport const safeApiCallWithValidation = async (apiCall, requiredFields = [], fallbackMessage = 'API call failed') => {\r\n  try {\r\n    const response = await apiCall();\r\n    \r\n    // Check if response has the new standardized format\r\n    if (response && typeof response === 'object' && 'success' in response) {\r\n      if (response.success === true) {\r\n        // For success responses, validate required fields in the data\r\n        if (requiredFields.length > 0 && response.data) {\r\n          if (validateResponse(response.data, requiredFields)) {\r\n            return { success: true, data: response.data, error: null };\r\n          } else {\r\n            console.error('Response data validation failed:', response.data);\r\n            return { success: false, data: null, error: fallbackMessage };\r\n          }\r\n        }\r\n        return { success: true, data: response.data, error: null };\r\n      } else {\r\n        // For error responses, extract the error message\r\n        return { \r\n          success: false, \r\n          data: null, \r\n          error: response.message || response.error || fallbackMessage \r\n        };\r\n      }\r\n    }\r\n    \r\n    // Fallback to old validation for backward compatibility\r\n    return safeResponseHandler(response, requiredFields, fallbackMessage);\r\n  } catch (error) {\r\n    const errorMessage = getErrorMessage(error, fallbackMessage);\r\n    console.error('API call failed:', error);\r\n    return { success: false, data: null, error: errorMessage };\r\n  }\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}